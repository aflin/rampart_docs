

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Rampart Thread Functions &mdash; Rampart 0.2.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="_static/hacks.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Rampart 0.2.0 documentation" href="index.html"/>
        <link rel="next" title="The rampart-sql module" href="sqltoc.html"/>
        <link rel="prev" title="rampart.utils" href="rampart-utils.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Rampart
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="rampart-main.html">Rampart JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-utils.html">Rampart Utility Functions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Rampart Thread Functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#preface">Preface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#license">License</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-does-it-do">What does it do?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-does-it-work">How does it work?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#thread-functions">Thread Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#new-rampart-thread">new rampart.thread()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#thr-exec">thr.exec()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#thr-close">thr.close()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#thr-getid">thr.getId()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rampart-thread-put">rampart.thread.put()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rampart-thread-get">rampart.thread.get()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rampart-thread-del">rampart.thread.del()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rampart-thread-waitfor">rampart.thread.waitfor()</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#lock-functions">Lock Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#new-rampart-lock">new rampart.lock()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#thrlock-lock">thrlock.lock()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#thrlock-unlock">thrlock.unlock()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#thrlock-trylock">thrlock.trylock()</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lock-caveats">Lock Caveats</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sqltoc.html">The rampart-sql module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-server.html">The rampart-server module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-net.html">The rampart-net module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-html.html">The rampart-html module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-crypto.html">The rampart-crypto module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-curl.html">The rampart-curl module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-lmdb.html">The rampart-lmdb module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-redis.html">The rampart-redis module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-python.html">The rampart-python module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-robots.html">The rampart-robots module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-cmark.html">The rampart-cmark module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rampart-url.html">The rampart-url module</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorialtoc.html">Tutorials</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Rampart</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Rampart Thread Functions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/rampart-thread.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="rampart-thread-functions">
<h1>Rampart Thread Functions<a class="headerlink" href="#rampart-thread-functions" title="Permalink to this heading">¶</a></h1>
<section id="preface">
<h2>Preface<a class="headerlink" href="#preface" title="Permalink to this heading">¶</a></h2>
<section id="license">
<h3>License<a class="headerlink" href="#license" title="Permalink to this heading">¶</a></h3>
<p>The rampart.thread functions are built into the rampart executable
and as such are covered under the same MIT license.</p>
</section>
<section id="what-does-it-do">
<h3>What does it do?<a class="headerlink" href="#what-does-it-do" title="Permalink to this heading">¶</a></h3>
<p>The rampart.thread functions provides utility functions to create threads
from within JavaScript and run functions asynchronously in them, as well as
share variables between them.</p>
</section>
<section id="how-does-it-work">
<h3>How does it work?<a class="headerlink" href="#how-does-it-work" title="Permalink to this heading">¶</a></h3>
<p>The rampart.thread functions allow for the creation of native POSIX threads
which when created, are paired with a separate JavaScript interpreter and event
loop.  When created the event loop starts immediately and functions can be
passed into the thread’s event loop in a manner similar to the
<a class="reference internal" href="rampart-main.html#settimeout"><span class="std std-ref">setTimeout() function</span></a>.  Variables can
be provided directly or by putting and getting from an internally maintained
clipboard.  Global variables which are defined and set <strong>when the thread is
created</strong> will be copied to the stack of the newly created JavaScript
interpreter.</p>
</section>
</section>
<section id="thread-functions">
<h2>Thread Functions<a class="headerlink" href="#thread-functions" title="Permalink to this heading">¶</a></h2>
<section id="new-rampart-thread">
<h3>new rampart.thread()<a class="headerlink" href="#new-rampart-thread" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p>Calling <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">rampart.thread()</span></code> function creates the new thread.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">thr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">rampart</span><span class="p">.</span><span class="nx">thread</span><span class="p">();</span>
</pre></div>
</div>
<dl class="simple">
<dt>Return Value:</dt><dd><p>An <span class="green">Object</span> with two functions: <cite>exec</cite> and <cite>close</cite>.</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="thr-exec">
<h3>thr.exec()<a class="headerlink" href="#thr-exec" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p>Execute a function in a thread.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">thr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">rampart</span><span class="p">.</span><span class="nx">thread</span><span class="p">();</span>

<span class="nx">thr</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* or */</span>

<span class="nx">thr</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">threadFunc</span><span class="p">[,</span><span class="w"> </span><span class="nx">threadArg</span><span class="p">[,</span><span class="w"> </span><span class="nx">callbackFunc</span><span class="p">[,</span><span class="w"> </span><span class="nx">threadDelay</span><span class="p">]]]);</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">options</span></code> - an <span class="green">Object</span> with optional keys <code class="docutils literal notranslate"><span class="pre">threadFunc</span></code>,
<code class="docutils literal notranslate"><span class="pre">threadArg</span></code>, <code class="docutils literal notranslate"><span class="pre">callbackFunc</span></code> and/or <code class="docutils literal notranslate"><span class="pre">threadDelay</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">threadFunc</span></code> - a <span class="green">Function</span> that will be executed in the
thread.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">threadArg</span></code> - a single variable of any type that will be passed to
the <code class="docutils literal notranslate"><span class="pre">threadFunc</span></code> <span class="green">Function</span> as its sole parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">callbackFunc</span></code> - a <span class="green">Function</span> that will be executed in the
current event loop (in the thread in which <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">rampart.thread()</span></code>
was called).  It will be passed a single parameter, the return
value of <code class="docutils literal notranslate"><span class="pre">threadFunc</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">threadDelay</span></code> - a delay, similar to the <a class="reference internal" href="rampart-main.html#settimeout"><span class="std std-ref">setTimeout() function</span></a>,
measured in milliseconds.  If omitted, the <code class="docutils literal notranslate"><span class="pre">threadFunc</span></code> <span class="green">Function</span>
will execute immediately.</p></li>
</ul>
</div></blockquote>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">iscopied</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">thr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">rampart</span><span class="p">.</span><span class="nx">thread</span><span class="p">();</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">notcopied</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">thrfunc</span><span class="p">(</span><span class="nx">myarg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* var iscopied is available, var notcopied is not */</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;from inside the thread:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">myarg</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">myarg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">callback</span><span class="p">(</span><span class="nx">myarg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;back in the main thread:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">myarg</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">thr</span><span class="p">.</span><span class="nx">exec</span><span class="p">({</span>
<span class="w">    </span><span class="nx">threadFunc</span><span class="o">:</span><span class="w"> </span><span class="nx">thrfunc</span><span class="p">,</span>
<span class="w">    </span><span class="nx">threadArg</span><span class="o">:</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span>
<span class="w">    </span><span class="nx">callbackFunc</span><span class="o">:</span><span class="w"> </span><span class="nx">callback</span><span class="p">,</span>
<span class="w">    </span><span class="nx">threadDelay</span><span class="o">:</span><span class="w"> </span><span class="mf">1000</span>
<span class="p">});</span>

<span class="cm">/* or */</span>

<span class="c1">// thr.exec(thrfunc, 3, callback, 1000);</span>

<span class="cm">/*</span>
<span class="cm">    after one second, output will be:</span>
<span class="cm">        from inside the thread: 3</span>
<span class="cm">        back in the main thread: 4</span>
<span class="cm">*/</span>
</pre></div>
</div>
<dl class="simple">
<dt>Return Value:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">undefined</span></code>.</p>
</dd>
</dl>
<p>Caveats:</p>
<blockquote>
<div><ul class="simple">
<li><p>Threads may be created in inside threads, but they must be called
from within the thread in which they were created.</p></li>
<li><p>Only global variables are copied to threads at the time of
creation.  The variable <code class="docutils literal notranslate"><span class="pre">iscopied</span></code> in the example above will be copied and
available to the thread as a global variable.  The variable
<code class="docutils literal notranslate"><span class="pre">notcopied</span></code> will not be copied since it was set after the thread was
created.</p></li>
</ul>
</div></blockquote>
</div></blockquote>
</section>
<section id="thr-close">
<h3>thr.close()<a class="headerlink" href="#thr-close" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p>Close a thread, releasing its resources.</p>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">thr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">rampart</span><span class="p">.</span><span class="nx">thread</span><span class="p">();</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">thrfunc</span><span class="p">(</span><span class="nx">myarg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;from inside the thread:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">myarg</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">myarg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">callback</span><span class="p">(</span><span class="nx">myarg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;back in the main thread:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">myarg</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">thr</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">thrfunc</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">,</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm">    after one second, output will be:</span>
<span class="cm">        from inside the thread: 3</span>
<span class="cm">        back in the main thread: 4</span>
<span class="cm">*/</span>

<span class="nx">thr</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>

<span class="cm">/* in this case, the thread will stay open until its event loop</span>
<span class="cm">   is empty.  Thus there will be no difference in the output.</span>
<span class="cm">   However in a long lived script, closing a thread when no longer</span>
<span class="cm">   in use can free up significant resources                       */</span>
</pre></div>
</div>
<dl class="simple">
<dt>Return Value:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">undefined</span></code>.</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="thr-getid">
<h3>thr.getId()<a class="headerlink" href="#thr-getid" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p>Get a thread’s unique identification number.  This number is used to
identify a thread, and may be reused after the thread is closed.</p>
<dl class="simple">
<dt>Return Value:</dt><dd><p>A <span class="green">Number</span>, the positive integer for identifying the thread.</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="rampart-thread-put">
<h3>rampart.thread.put()<a class="headerlink" href="#rampart-thread-put" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p>Put a named variable to the clipboard.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">rampart</span><span class="p">.</span><span class="nx">thread</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">varName</span><span class="p">,</span><span class="w"> </span><span class="nx">varValue</span><span class="p">);</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">varName</span></code> is a <span class="green">String</span>, the key to later retrieve
<code class="docutils literal notranslate"><span class="pre">varValue</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">varValue</span></code> is any normal JavaScript variable.</p></li>
</ul>
</div></blockquote>
<dl class="simple">
<dt>Return Value:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">undefined</span></code>.</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="rampart-thread-get">
<h3>rampart.thread.get()<a class="headerlink" href="#rampart-thread-get" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p>Get a named variable from the clipboard.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">myval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rampart</span><span class="p">.</span><span class="nx">thread</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">varName</span><span class="p">[,</span><span class="w"> </span><span class="nx">timeOut</span><span class="p">]);</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">varName</span></code> is a <span class="green">String</span>, the key used in
<a class="reference internal" href="#rampart-thread-put">rampart.thread.put()</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timeOut</span></code> is a positive <span class="green">Number</span>.  If provided and the
return value would be <code class="docutils literal notranslate"><span class="pre">undefined</span></code>,  <a class="reference internal" href="#rampart-thread-waitfor">rampart.thread.waitfor()</a>
below will be called with <code class="docutils literal notranslate"><span class="pre">varName</span></code> and <code class="docutils literal notranslate"><span class="pre">timeOut</span></code>.</p></li>
</ul>
</div></blockquote>
<dl class="simple">
<dt>Return Value:</dt><dd><p>A <strong>copy</strong> of the variable stored with <a class="reference internal" href="#rampart-thread-put">rampart.thread.put()</a>.</p>
</dd>
<dt>Caveat:</dt><dd><p>The variable retrieved is a deep copy of the variable put.  If
the original variable that was put is altered, the changes will
not affect the retrieved version.</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">thr1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">rampart</span><span class="p">.</span><span class="nx">thread</span><span class="p">();</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">thr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">rampart</span><span class="p">.</span><span class="nx">thread</span><span class="p">();</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">thrfunc</span><span class="p">(</span><span class="nx">myarg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;from inside thread 1:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">myarg</span><span class="p">);</span>
<span class="w">    </span><span class="nx">rampart</span><span class="p">.</span><span class="nx">thread</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;mycopiedvar&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">myarg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">10</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">myarg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">callback</span><span class="p">(</span><span class="nx">myarg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;back in the main thread:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">myarg</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">thr1</span><span class="p">.</span><span class="nx">exec</span><span class="p">({</span>
<span class="w">    </span><span class="nx">threadFunc</span><span class="o">:</span><span class="w"> </span><span class="nx">thrfunc</span><span class="p">,</span>
<span class="w">    </span><span class="nx">threadArg</span><span class="o">:</span><span class="w"> </span><span class="mf">3</span><span class="p">,</span>
<span class="w">    </span><span class="nx">callbackFunc</span><span class="o">:</span><span class="w"> </span><span class="nx">callback</span><span class="p">,</span>
<span class="w">    </span><span class="nx">threadDelay</span><span class="o">:</span><span class="w"> </span><span class="mf">1000</span>
<span class="p">});</span>

<span class="nx">thr2</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

<span class="w">    </span><span class="c1">// wait a max of five seconds for &#39;mycopiedvar&#39; to be defined</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">retrieved_var</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rampart</span><span class="p">.</span><span class="nx">thread</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;mycopiedvar&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">5000</span><span class="p">);</span>

<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;from inside thread 2:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">retrieved_var</span><span class="p">);</span>
<span class="p">});</span>

<span class="cm">/* output:</span>
<span class="cm">    from inside thread 1: 3</span>
<span class="cm">    from inside thread 2: 13</span>
<span class="cm">    back in the main thread: 4</span>

<span class="cm">   Note that thr1&#39;s callbackFunc runs last.  The event loop</span>
<span class="cm">   of threads start immediately while the main event loop in</span>
<span class="cm">   which the callbackFunc runs starts at the end of the script.</span>
<span class="cm">*/</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="rampart-thread-del">
<h3>rampart.thread.del()<a class="headerlink" href="#rampart-thread-del" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p>Get a named variable and remove it from the clipboard.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">myval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rampart</span><span class="p">.</span><span class="nx">thread</span><span class="p">.</span><span class="nx">del</span><span class="p">(</span><span class="nx">varName</span><span class="p">[,</span><span class="w"> </span><span class="nx">timeOut</span><span class="p">]);</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">varName</span></code> is a <span class="green">String</span>, the key used in
<a class="reference internal" href="#rampart-thread-put">rampart.thread.put()</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timeOut</span></code> is a positive <span class="green">Number</span>.  If provided and the
return value would be <code class="docutils literal notranslate"><span class="pre">undefined</span></code>,  <a class="reference internal" href="#rampart-thread-waitfor">rampart.thread.waitfor()</a>
below will be called with <code class="docutils literal notranslate"><span class="pre">varName</span></code> and <code class="docutils literal notranslate"><span class="pre">timeOut</span></code>.</p></li>
</ul>
</div></blockquote>
<dl class="simple">
<dt>Return Value:</dt><dd><p>A <strong>copy</strong> of the variable stored with <a class="reference internal" href="#rampart-thread-put">rampart.thread.put()</a>.</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="rampart-thread-waitfor">
<h3>rampart.thread.waitfor()<a class="headerlink" href="#rampart-thread-waitfor" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p>Wait for the named variable to be updated by another thread and return
it.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">myval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rampart</span><span class="p">.</span><span class="nx">thread</span><span class="p">.</span><span class="nx">waitfor</span><span class="p">(</span><span class="nx">varName</span><span class="p">[,</span><span class="w"> </span><span class="nx">timeOut</span><span class="p">]);</span>
</pre></div>
</div>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">varName</span></code> is a <span class="green">String</span>, the key used in
<a class="reference internal" href="#rampart-thread-put">rampart.thread.put()</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timeOut</span></code> is a positive <span class="green">Number</span> in milliseconds.  If
provided, return <code class="docutils literal notranslate"><span class="pre">undefined</span></code> if the varable <code class="docutils literal notranslate"><span class="pre">varName</span></code> has not been
written to the clipboard within the given time return value would
be <code class="docutils literal notranslate"><span class="pre">undefined</span></code>, <a class="reference internal" href="#rampart-thread-waitfor">rampart.thread.waitfor()</a> below will be called
with <code class="docutils literal notranslate"><span class="pre">varName</span></code> and <code class="docutils literal notranslate"><span class="pre">timeOut</span></code>.  The default value is <code class="docutils literal notranslate"><span class="pre">-1</span></code>, or
wait indefinitely.</p></li>
</ul>
</div></blockquote>
<dl class="simple">
<dt>Return Value:</dt><dd><p>A <strong>copy</strong> of the variable stored with <a class="reference internal" href="#rampart-thread-put">rampart.thread.put()</a> or
<code class="docutils literal notranslate"><span class="pre">undefined</span></code> if the <code class="docutils literal notranslate"><span class="pre">timeOut</span></code> is reached.</p>
</dd>
<dt>Note:</dt><dd><p>Unlike <a class="reference internal" href="#rampart-thread-get">rampart.thread.get()</a> above, this function will wait even
if <code class="docutils literal notranslate"><span class="pre">varName</span></code> is defined and will return only when it changes or
the <code class="docutils literal notranslate"><span class="pre">timeOut</span></code> is reached.</p>
</dd>
</dl>
</div></blockquote>
</section>
</section>
<section id="lock-functions">
<h2>Lock Functions<a class="headerlink" href="#lock-functions" title="Permalink to this heading">¶</a></h2>
<section id="new-rampart-lock">
<h3>new rampart.lock()<a class="headerlink" href="#new-rampart-lock" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><blockquote>
<div><p>Calling <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">rampart.lock()</span></code> function creates a new
<a class="reference external" href="https://linux.die.net/man/3/pthread_mutex_lock">POSIX backed mutex</a>
which can be used to isolate critical sections of code running in
multiple threads.</p>
</div></blockquote>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">thrlock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">rampart</span><span class="p">.</span><span class="nx">lock</span><span class="p">();</span>
</pre></div>
</div>
<dl class="simple">
<dt>Return Value:</dt><dd><p>An <span class="green">Object</span> with two functions: <cite>lock</cite> and <cite>unlock</cite>.</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="thrlock-lock">
<h3>thrlock.lock()<a class="headerlink" href="#thrlock-lock" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p>Lock the mutex referenced by <code class="docutils literal notranslate"><span class="pre">thrlock</span></code>.  If the mutex is not locked,
a lock will be obtained.  If the mutex is locked in another thread,
execution in the current thread will be paused until the other thread
calls <a class="reference internal" href="#thrlock-unlock">thrlock.unlock()</a> and a lock will be obtained.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">thrlock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">rampart</span><span class="p">.</span><span class="nx">lock</span><span class="p">();</span>

<span class="c1">// ... while inside a threaded function</span>

<span class="nx">thrlock</span><span class="p">.</span><span class="nx">lock</span><span class="p">();</span>
</pre></div>
</div>
<dl class="simple">
<dt>Return Value:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">undefined</span></code>.</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="thrlock-unlock">
<h3>thrlock.unlock()<a class="headerlink" href="#thrlock-unlock" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p>Unlock the mutex referenced by <code class="docutils literal notranslate"><span class="pre">thrlock</span></code>.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">thrlock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">rampart</span><span class="p">.</span><span class="nx">lock</span><span class="p">();</span>

<span class="c1">// ... while inside a threaded function</span>

<span class="nx">thrlock</span><span class="p">.</span><span class="nx">lock</span><span class="p">();</span>
<span class="cm">/* critical section */</span>
<span class="nx">thrlock</span><span class="p">.</span><span class="nx">unlock</span><span class="p">();</span>
</pre></div>
</div>
<dl class="simple">
<dt>Return Value:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">undefined</span></code>.</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="thrlock-trylock">
<h3>thrlock.trylock()<a class="headerlink" href="#thrlock-trylock" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><p>Same as <cite>thrlock.lock()</cite> except it always returns immediatedly.</p>
<p>Usage:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">thrlock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">rampart</span><span class="p">.</span><span class="nx">lock</span><span class="p">();</span>

<span class="c1">// ... while inside a threaded function</span>

<span class="k">if</span><span class="p">(</span><span class="nx">thrlock</span><span class="p">.</span><span class="nx">trylock</span><span class="p">())</span>
<span class="p">{</span>
<span class="w">    </span><span class="cm">/* critical section */</span>
<span class="w">    </span><span class="nx">thrlock</span><span class="p">.</span><span class="nx">unlock</span><span class="p">();</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="cm">/* do something else */</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="simple">
<dt>Return Value:</dt><dd><p>A <span class="green">Boolean</span>: <code class="docutils literal notranslate"><span class="pre">true</span></code> if the lock was obtained and <code class="docutils literal notranslate"><span class="pre">false</span></code>
if not.</p>
</dd>
</dl>
</div></blockquote>
</section>
<section id="lock-caveats">
<h3>Lock Caveats<a class="headerlink" href="#lock-caveats" title="Permalink to this heading">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>A mutex locked in a thread must be unlocked in the same thread.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">rampart.lock</span></code> should be created before the threads in which it
will be used are created so that the <code class="docutils literal notranslate"><span class="pre">thrlock</span></code> variable is copied to
each thread.</p></li>
<li><p>Normal operations do not require explicit locking using
<code class="docutils literal notranslate"><span class="pre">rampart.lock</span></code>.  However updating variables on the clipboard might
require using a lock.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">thread</span><span class="o">=</span><span class="nx">rampart</span><span class="p">.</span><span class="nx">thread</span><span class="p">;</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">thrlock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">rampart</span><span class="p">.</span><span class="nx">lock</span><span class="p">();</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">thr1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">thread</span><span class="p">();</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">thr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">thread</span><span class="p">();</span>

<span class="nx">thread</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>

<span class="nx">thr1</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">j</span><span class="o">=</span><span class="mf">0</span><span class="p">;</span>

<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nx">j</span><span class="o">=</span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="o">&lt;</span><span class="mf">50</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nx">thrlock</span><span class="p">.</span><span class="nx">lock</span><span class="p">();</span>

<span class="w">        </span><span class="nx">i</span><span class="o">=</span><span class="nx">thread</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">i</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="nx">thread</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">);</span>

<span class="w">        </span><span class="nx">thrlock</span><span class="p">.</span><span class="nx">unlock</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>

<span class="nx">thr2</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">j</span><span class="o">=</span><span class="mf">0</span><span class="p">;</span>

<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nx">j</span><span class="o">=</span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="o">&lt;</span><span class="mf">50</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nx">thrlock</span><span class="p">.</span><span class="nx">lock</span><span class="p">();</span>

<span class="w">        </span><span class="nx">i</span><span class="o">=</span><span class="nx">thread</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">i</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="nx">thread</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">);</span>

<span class="w">        </span><span class="nx">thrlock</span><span class="p">.</span><span class="nx">unlock</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">);</span>
<span class="w">    </span><span class="nx">i</span><span class="o">=</span><span class="nx">thread</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;i =&quot;</span><span class="p">,</span><span class="nx">i</span><span class="p">);</span>
<span class="p">});</span>

<span class="cm">/* output:</span>
<span class="cm">    i = 100</span>
<span class="cm">*/</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sqltoc.html" class="btn btn-neutral float-right" title="The rampart-sql module" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="rampart-utils.html" class="btn btn-neutral" title="rampart.utils" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2023, Moat Crossing Systems.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> and ❤️  using a custom <a href="https://github.com/LinxiFan/Sphinx-theme">theme</a> based on <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script type="text/javascript" src="_static/documentation_options.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/sphinx_highlight.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>