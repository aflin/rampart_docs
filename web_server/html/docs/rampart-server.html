<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
  <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
      The rampart-server HTTP module — Rampart 0.1.0 documentation
    </title>
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css">
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css">
    <link rel="stylesheet" href="_static/hacks.css" type="text/css">
    <link rel="index" title="Index" href="genindex.html">
    <link rel="search" title="Search" href="search.html">
    <link rel="top" title="Rampart 0.1.0 documentation" href="index.html">
    <link rel="next" title="The rampart-html module" href="rampart-html.html">
    <link rel="prev" title="The rampart-sql Command Line Utilities" href="sql-utils.html">
    <script src="_static/js/modernizr.min.js"></script>
    <style>
            .wy-nav-top,.wy-side-nav-search { background-color:black;}
            body,h1,h2,h3,h4,h5,h6 {font-family: "Varela Round", Sans-Serif;}
            dl:not(.docutils) dt {font-family: "Varela Round", Sans-Serif !important; font-size: 90% !important;}
            .autocomplete-suggestions { border: 1px solid #999; background: #FFF; overflow: auto; width: auto !important; padding-right:5px;}
            .autocomplete-suggestion { padding: 2px 5px; white-space: nowrap; overflow: hidden; }
            .autocomplete-selected { background: #F0F0F0; }
            .autocomplete-suggestions strong { font-weight: normal; color: #3399FF; }
            .autocomplete-group { padding: 2px 5px; }
            .autocomplete-group strong { display: block; border-bottom: 1px solid #000; }
            .searchsect {max-height: 250px; overflow:hidden; padding-left:5px; padding-bottom: 15px; position: relative;}
            .linked { font-size: 1.1em; display: inline-block; position: relative; margin-top: 20px;}
            .slink { font-size: 1rem; margin-top:0px; margin-bottom:5px;}
            .fader {position: absolute;bottom: 0px;height: 2em; left:-5px; right:0px; background-color: #fcfcfc;}
            .expand {cursor:pointer; background-color: #eee; padding: 3px; font-family:monospace; position: absolute; right: 15px}
            .expandBottom { bottom: 18px }
            .expandTop { top: 3px }
            .expanded .fader { bottom : -15px }
            .expanded .expandBottom { bottom: 38px; }
            .wy-nav-content {max-width: 1600px;}
    </style>
  </head>
  <body class="wy-body-for-nav" role="document">
    <div class="wy-grid-for-nav">
      <nav data-toggle="wy-nav-shift" class="wy-nav-side">
        <div class="wy-side-scroll">
          <div class="wy-side-nav-search">
            <a href="/" class="icon icon-home">Rampart</a>
            <div role="search">
              <form id="rtd-search-form" class="wy-form" action="search.html" method="get" name="rtd-search-form">
                <input type="text" name="q" placeholder="Search docs"> <input type="hidden" name="check_keywords"
                value="yes"> <input type="hidden" name="area" value="default">
              </form>
            </div>
          </div>
          <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            <p class="caption">
              <span class="caption-text">Contents:</span>
            </p>
            <ul class="current">
              <li class="toctree-l1">
                <a class="reference internal" href="rampart-main.html">Rampart JavaScript</a>
              </li>
              <li class="toctree-l1">
                <a class="reference internal" href="rampart-utils.html">Rampart Utility Functions</a>
              </li>
              <li class="toctree-l1">
                <a class="reference internal" href="sqltoc.html">The rampart-sql module</a>
              </li>
              <li class="toctree-l1 current">
                <a class="current reference internal" href="#">The rampart-server module</a>
                <ul>
                  <li class="toctree-l2">
                    <a class="reference internal" href="#preface">Preface</a>
                    <ul>
                      <li class="toctree-l3">
                        <a class="reference internal" href="#acknowledgment">Acknowledgment</a>
                      </li>
                      <li class="toctree-l3">
                        <a class="reference internal" href="#license">License</a>
                      </li>
                      <li class="toctree-l3">
                        <a class="reference internal" href="#what-does-it-do">What does it do?</a>
                      </li>
                      <li class="toctree-l3">
                        <a class="reference internal" href="#how-does-it-work">How does it work?</a>
                      </li>
                    </ul>
                  </li>
                  <li class="toctree-l2">
                    <a class="reference internal" href="#loading-and-using-the-module">Loading and Using the Module</a>
                    <ul>
                      <li class="toctree-l3">
                        <a class="reference internal" href="#loading">Loading</a>
                      </li>
                      <li class="toctree-l3">
                        <a class="reference internal" href="#configuring-and-starting-the-server">Configuring and
                        Starting the Server</a>
                        <ul>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#start">start()</a>
                          </li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                  <li class="toctree-l2">
                    <a class="reference internal" href="#server-usage-details">Server Usage Details</a>
                    <ul>
                      <li class="toctree-l3">
                        <a class="reference internal" href="#path-mapping">Path Mapping</a>
                        <ul>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#mapped-functions">Mapped Functions</a>
                          </li>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#mapped-directories">Mapped Directories</a>
                          </li>
                        </ul>
                      </li>
                      <li class="toctree-l3">
                        <a class="reference internal" href="#the-request-object">The Request Object</a>
                        <ul>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#posting-form-data">Posting Form Data</a>
                          </li>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#posting-multipart-form-data">Posting Multipart Form
                            Data</a>
                          </li>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#posting-json-data">Posting JSON Data</a>
                          </li>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#posting-other-types">Posting Other Types</a>
                          </li>
                        </ul>
                      </li>
                      <li class="toctree-l3">
                        <a class="reference internal" href="#the-return-object">The Return Object</a>
                      </li>
                      <li class="toctree-l3">
                        <a class="reference internal" href="#built-in-directory-function">Built-in Directory
                        Function</a>
                      </li>
                      <li class="toctree-l3">
                        <a class="reference internal" href="#advanced-functions">Advanced Functions</a>
                        <ul>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#req-printf">req.printf()</a>
                          </li>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#req-put">req.put()</a>
                          </li>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#req-getpos">req.getpos()</a>
                          </li>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#req-rewind">req.rewind()</a>
                          </li>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#req-getbuffer">req.getBuffer()</a>
                          </li>
                        </ul>
                      </li>
                      <li class="toctree-l3">
                        <a class="reference internal" href="#full-server-example">Full Server Example</a>
                      </li>
                      <li class="toctree-l3">
                        <a class="reference internal" href="#chunking-replies">Chunking Replies</a>
                        <ul>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#the-basics">The Basics</a>
                          </li>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#req-chunksend">req.chunkSend()</a>
                          </li>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#req-chunkend">req.chunkEnd()</a>
                          </li>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#req-chunkindex">req.chunkIndex</a>
                          </li>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#chunking-examples">Chunking Examples</a>
                          </li>
                        </ul>
                      </li>
                      <li class="toctree-l3">
                        <a class="reference internal" href="#websockets">Websockets</a>
                        <ul>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#req-wssend-data">req.wsSend(data)</a>
                          </li>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#req-wsend-immediate">req.wsEnd([immediate])</a>
                          </li>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#req-wsondisconnect-func">req.wsOnDisconnect(func)</a>
                          </li>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#req-wsisbin">req.wsIsBin</a>
                          </li>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#req-count">req.count</a>
                          </li>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#req-websocketid">req.websocketId</a>
                          </li>
                          <li class="toctree-l4">
                            <a class="reference internal" href="#example-echo-chat-server">Example echo/chat server</a>
                          </li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                  <li class="toctree-l2">
                    <a class="reference internal" href="#technical-notes">Technical Notes</a>
                  </li>
                  <li class="toctree-l2">
                    <a class="reference internal" href="#key-to-mime-mappings">Key to Mime Mappings</a>
                  </li>
                </ul>
              </li>
              <li class="toctree-l1">
                <a class="reference internal" href="rampart-html.html">The rampart-html module</a>
              </li>
              <li class="toctree-l1">
                <a class="reference internal" href="rampart-crypto.html">The rampart-crypto module</a>
              </li>
              <li class="toctree-l1">
                <a class="reference internal" href="rampart-curl.html">The rampart-curl module</a>
              </li>
              <li class="toctree-l1">
                <a class="reference internal" href="rampart-lmdb.html">The rampart-lmdb module</a>
              </li>
              <li class="toctree-l1">
                <a class="reference internal" href="rampart-redis.html">The rampart-redis module</a>
              </li>
              <li class="toctree-l1">
                <a class="reference internal" href="rampart-robots.html">The rampart-robots module</a>
              </li>
              <li class="toctree-l1">
                <a class="reference internal" href="rampart-cmark.html">The rampart-cmark module</a>
              </li>
              <li class="toctree-l1">
                <a class="reference internal" href="rampart-url.html">The rampart-url module</a>
              </li>
              <li class="toctree-l1">
                <a class="reference internal" href="tutorialtoc.html">Tutorials</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
        <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i> <a href="index.html">Rampart</a>
        </nav>
        <div class="wy-nav-content">
          <div class="rst-content">
            <div role="navigation" aria-label="breadcrumbs navigation">
              <ul class="wy-breadcrumbs">
                <li>
                  <a href="/">Home</a> »
                </li>
                <li>
                  <a href="index.html">Docs</a> »
                </li>
                <li>The rampart-server HTTP module
                </li>
              </ul>
              <hr>
            </div>
            <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
              <div itemprop="articleBody">
                <div class="section" id="the-rampart-server-http-module">
                  <h1>
                    The rampart-server HTTP module<a class="headerlink" href="#the-rampart-server-http-module" title=
                    "Permalink to this headline">¶</a>
                  </h1>
                  <div class="section" id="preface">
                    <h2>
                      Preface<a class="headerlink" href="#preface" title="Permalink to this headline">¶</a>
                    </h2>
                    <div class="section" id="acknowledgment">
                      <h3>
                        Acknowledgment<a class="headerlink" href="#acknowledgment" title=
                        "Permalink to this headline">¶</a>
                      </h3>
                      <p>
                        The rampart-server module uses the <a class="reference external" href=
                        "https://github.com/aflin/libevhtp_ws">libevhtp_ws</a> library, a fast, embedded, event driven
                        http/https server which itself uses the <a class="reference external" href=
                        "https://libevent.org/">libevent2</a> library.
                      </p>
                      <p>
                        The developers of Rampart are extremely grateful for the excellent APIs and ease of use of
                        these libraries.
                      </p>
                    </div>
                    <div class="section" id="license">
                      <h3>
                        License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a>
                      </h3>
                      <p>
                        The rampart-server module is released under the MIT license. The <a class="reference external"
                        href="https://github.com/aflin/libevhtp_ws">libevhtp_ws</a> library and the <a class=
                        "reference external" href="https://libevent.org/">libevent2</a> library are both provided under
                        a <a class="reference external" href=
                        "https://github.com/aflin/libevhtp_ws/blob/main/LICENSE">BSD-3-Clause License</a>.
                      </p>
                    </div>
                    <div class="section" id="what-does-it-do">
                      <h3>
                        What does it do?<a class="headerlink" href="#what-does-it-do" title=
                        "Permalink to this headline">¶</a>
                      </h3>
                      <p>
                        The rampart-server module provides a multithreaded and flexible http/https webserver which is
                        started from, configured in and maps urls to Rampart JavaScript functions. It also can be
                        configured to serve files from the filesystem.
                      </p>
                    </div>
                    <div class="section" id="how-does-it-work">
                      <h3>
                        How does it work?<a class="headerlink" href="#how-does-it-work" title=
                        "Permalink to this headline">¶</a>
                      </h3>
                      <p>
                        Once the module is loaded and configuration parameters are passed to the <a class=
                        "reference internal" href="#start">start()</a> function, the server maps paths to the
                        filesystem, JavaScript functions, <a class="reference internal" href=
                        "rampart-main.html#using-the-require-function-to-import-modules"><span class=
                        "std std-ref">JavaScript Modules</span></a> and/or directories containing <a class=
                        "reference internal" href=
                        "rampart-main.html#using-the-require-function-to-import-modules"><span class=
                        "std std-ref">JavaScript Modules</span></a>. Modules allow scripts and functions to reside in
                        separate files. If changes are made to a module, the server does not need to be restarted for
                        the changes to take effect.
                      </p>
                      <p>
                        The server can operate from a pool of threads, taking advantage of systems with multiple CPUs.
                        As JavaScript is inherently single-threaded, when the server is started in multi-threaded mode,
                        a new JavaScript stack, heap and context is created for each thread. Global variables, global
                        functions and mapped functions passed to <a class="reference internal" href=
                        "#start">start()</a> are automatically copied to each context and each runs independently.
                        Modules are likewise loaded from within each thread and checked for changes upon each request.
                      </p>
                      <p>
                        It is worth noting that not all rampart-sql functions are thread safe. When SQL functions are
                        executed from within a function or module, rampart may create a fork, one per thread, in order
                        to handle such functions.
                      </p>
                      <p>
                        A timeout for script execution may also be set. Should the script timeout, the serving thread
                        will cancel the request and re-initialize the JavaScript context in order to serve new
                        requests.
                      </p>
                    </div>
                  </div>
                  <div class="section" id="loading-and-using-the-module">
                    <h2>
                      Loading and Using the Module<a class="headerlink" href="#loading-and-using-the-module" title=
                      "Permalink to this headline">¶</a>
                    </h2>
                    <div class="section" id="loading">
                      <h3>
                        Loading<a class="headerlink" href="#loading" title="Permalink to this headline">¶</a>
                      </h3>
                      <p>
                        Loading the server modules is a simple matter of using the require statement:
                      </p>
                      <div class="highlight-javascript notranslate">
                        <div class="highlight">
                          <pre><span></span><span class="kd">var</span> <span class="nx">server</span> <span class=
                          "o">=</span> <span class="nx">require</span><span class="p">(</span><span class=
                          "s2">"rampart-server"</span><span class="p">);</span>
</pre>
                        </div>
                      </div>
                      <p>
                        It returns an <span class="green">Object</span> with a single function:
                      </p>
                      <div class="highlight-default notranslate">
                        <div class="highlight">
                          <pre><span></span><span class="p">{</span>
   <span class="n">start</span><span class="p">:</span>    <span class="p">{</span><span class=
"n">_func</span><span class="p">:</span><span class="n">true</span><span class="p">}</span>
<span class="p">}</span>
</pre>
                        </div>
                      </div>
                    </div>
                    <div class="section" id="configuring-and-starting-the-server">
                      <h3>
                        Configuring and Starting the Server<a class="headerlink" href=
                        "#configuring-and-starting-the-server" title="Permalink to this headline">¶</a>
                      </h3>
                      <div class="section" id="start">
                        <h4>
                          start()<a class="headerlink" href="#start" title="Permalink to this headline">¶</a>
                        </h4>
                        <p>
                          The server is configured and started using the <code class=
                          "docutils literal notranslate"><span class="pre">start()</span></code> function. Options are
                          passed to the function in a single <span class="green">Object</span>.
                        </p>
                        <p>
                          Usage:
                        </p>
                        <div class="highlight-javascript notranslate">
                          <div class="highlight">
                            <pre><span></span><span class="kd">var</span> <span class="nx">server</span> <span class=
                            "o">=</span> <span class="nx">require</span><span class="p">(</span><span class=
                            "s2">"rampart-server"</span><span class="p">);</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class=
"nx">Options</span><span class="p">);</span>
</pre>
                          </div>
                        </div>
                        <dl>
                          <dt>
                            Where:
                          </dt>
                          <dd>
                            <p>
                              <code class="docutils literal notranslate"><span class="pre">Options</span></code> is an
                              <span class="green">Object</span> with the following properties:
                            </p>
                            <blockquote>
                              <div>
                                <ul>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class="pre">bind</span></code> -
                                      An <span class="green">Array</span> of <span class="green">Strings</span>, with
                                      each <span class="green">String</span> representing an ip address and port. If
                                      not specified, the server will bind to port 8088 on the loopback device (i.e.
                                      127.0.0.1, which is only accessible from the same machine), using the following
                                      default value:
                                    </p>
                                    <p>
                                      <code class="docutils literal notranslate"><span class="pre">[</span>
                                      <span class="pre">"[::1]:8088",</span> <span class="pre">"127.0.0.1:8088"</span>
                                      <span class="pre">]</span></code>.
                                    </p>
                                    <p>
                                      When specifying an Ipv6 address, bracket notation is required (e.g. <code class=
                                      "docutils literal notranslate"><span class=
                                      "pre">[2001:db8::1111:2222]:80</span></code>) while a dot-decimal notation is
                                      used for ipv4 (e.g. <code class="docutils literal notranslate"><span class=
                                      "pre">172.16.254.1:80</span></code>). To bind to all ip addresses using port 80,
                                      the following may be used:
                                    </p>
                                    <p>
                                      <code class="docutils literal notranslate"><span class="pre">[</span>
                                      <span class="pre">"[::]:80",</span> <span class="pre">"0.0.0.0:80"</span>
                                      <span class="pre">]</span></code>.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">scriptTimeout</span></code>: A <span class="green">Number</span>, amount of
                                      time in seconds (or fraction thereof) to wait for a script to run before
                                      canceling the request and returning a <code class=
                                      "docutils literal notranslate"><span class="pre">500</span> <span class=
                                      "pre">Internal</span> <span class="pre">Server</span> <span class=
                                      "pre">Error</span></code> timeout message to the connecting client. Default is no
                                      timeout/unlimited.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">connectTimeout</span></code>: A <span class="green">Number</span>, amount
                                      of time in seconds (or fraction thereof) to wait for a connected client to send a
                                      request. Default is no timeout/unlimited.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class="pre">log</span></code>: A
                                      <span class="green">Boolean</span>, whether to log each request. Access requests
                                      are logged to <code class="docutils literal notranslate"><span class=
                                      "pre">stdout</span></code> and errors are logged to <code class=
                                      "docutils literal notranslate"><span class="pre">stderr</span></code> unless
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">accessLog</span></code> and/or <code class=
                                      "docutils literal notranslate"><span class="pre">errorLog</span></code> below are
                                      set.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">accessLog</span></code>: A <span class="green">String</span>, the location
                                      of the access log. The default, if not specified is to log to <code class=
                                      "docutils literal notranslate"><span class="pre">stdout</span></code>. If given,
                                      the log file will be closed and re-opened upon sending the rampart executable a
                                      <code class="docutils literal notranslate"><span class="pre">USR1</span></code>
                                      signal, which allows log rotation.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">errorLog</span></code>: A <span class="green">String</span>, the location
                                      of the error log. The default, if not specified is to log to <code class=
                                      "docutils literal notranslate"><span class="pre">stderr</span></code>. If given,
                                      the log file will be closed and re-opened upon sending the rampart executable a
                                      <code class="docutils literal notranslate"><span class="pre">USR1</span></code>
                                      signal, which allows log rotation.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">daemon</span></code>: A <span class="green">Boolean</span>, whether to fork
                                      and detach from the controlling terminal. If <code class=
                                      "docutils literal notranslate"><span class="pre">true</span></code>, the
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">start()</span></code> function will return the pid of the server. Otherwise
                                      the pid of the current process is returned. The default is <code class=
                                      "docutils literal notranslate"><span class="pre">false</span></code>.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">useThreads</span></code>: A <span class="green">Boolean</span>, whether the
                                      server is multi-threaded. If <code class=
                                      "docutils literal notranslate"><span class="pre">true</span></code> and
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">threads</span></code> below is not set, the server will create a threadpool
                                      consisting of one thread per cpu core. If set <code class=
                                      "docutils literal notranslate"><span class="pre">false</span></code>, it is
                                      equivalent to setting <code class="docutils literal notranslate"><span class=
                                      "pre">useThreads</span></code> to <code class=
                                      "docutils literal notranslate"><span class="pre">true</span></code> and
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">threads</span></code> to <code class=
                                      "docutils literal notranslate"><span class="pre">1</span></code>. The default is
                                      <code class="docutils literal notranslate"><span class="pre">true</span></code>.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">threads</span></code>: A <span class="green">Number</span>, the number of
                                      threads to create for the server thread pool. The default, if <code class=
                                      "docutils literal notranslate"><span class="pre">useThreads</span></code> is
                                      <code class="docutils literal notranslate"><span class="pre">true</span></code>
                                      or is unset, is the number of cpu cores on the current system.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">secure</span></code>: A <span class="green">Boolean</span>, whether to use
                                      SSL/TLS layer for serving via the <code class=
                                      "docutils literal notranslate"><span class="pre">https</span></code> protocol.
                                      Default is <code class="docutils literal notranslate"><span class=
                                      "pre">false</span></code>. If <code class=
                                      "docutils literal notranslate"><span class="pre">true</span></code>, the
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">sslKeyFile</span></code> and <code class=
                                      "docutils literal notranslate"><span class="pre">sslCertFile</span></code>
                                      parameters must also be set.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">sslKeyFile</span></code>: A <span class="green">String</span>, the location
                                      of the ssl key file for serving via the <code class=
                                      "docutils literal notranslate"><span class="pre">https</span></code> protocol. An
                                      example, if using <a class="reference external" href=
                                      "https://letsencrypt.org/">letsencrypt</a> for “example.com” might be
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">"/etc/letsencrypt/live/example.com/privkey.pem"</span></code>. This setting
                                      has no effect unless <code class="docutils literal notranslate"><span class=
                                      "pre">secure</span></code> is <code class=
                                      "docutils literal notranslate"><span class="pre">true</span></code>.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">sslCertFile</span></code>: A <span class="green">String</span>, the
                                      location of the ssl cert file for serving via the <code class=
                                      "docutils literal notranslate"><span class="pre">https</span></code> protocol. An
                                      example, if using <a class="reference external" href=
                                      "https://letsencrypt.org/">letsencrypt</a> for “example.com” might be
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">"/etc/letsencrypt/live/example.com/fullchain.pem"</span></code>. This
                                      setting has no effect unless <code class=
                                      "docutils literal notranslate"><span class="pre">secure</span></code> is
                                      <code class="docutils literal notranslate"><span class="pre">true</span></code>.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">sslMinVersion</span></code>: A <span class="green">String</span>, the
                                      minimum SSL/TLS version to use. Possible values are <code class=
                                      "docutils literal notranslate"><span class="pre">ssl3</span></code>, <code class=
                                      "docutils literal notranslate"><span class="pre">tls1</span></code>, <code class=
                                      "docutils literal notranslate"><span class="pre">tls1.1</span></code> or
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">tls1.2</span></code>. The default is <code class=
                                      "docutils literal notranslate"><span class="pre">tls1.2</span></code>. This
                                      setting has no effect unless <code class=
                                      "docutils literal notranslate"><span class="pre">secure</span></code> is
                                      <code class="docutils literal notranslate"><span class="pre">true</span></code>.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">notFoundFunc</span></code>: A <span class="green">Function</span> to handle
                                      <code class="docutils literal notranslate"><span class="pre">404</span>
                                      <span class="pre">Not</span> <span class="pre">Found</span></code> responses. See
                                      <a class="reference internal" href="#mapped-functions">Mapped Functions</a>
                                      below.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">developerMode</span></code>: A <span class="green">Boolean</span>, whether
                                      to run the server in a developer mode. If <code class=
                                      "docutils literal notranslate"><span class="pre">true</span></code>, JavaScript
                                      and other errors will cause the server to return a <code class=
                                      "docutils literal notranslate"><span class="pre">500</span> <span class=
                                      "pre">Internal</span> <span class="pre">Error</span></code> message, with the
                                      error and error line numbers printed. If false, JavaScript errors will result in
                                      the generic <code class="docutils literal notranslate"><span class=
                                      "pre">404</span> <span class="pre">Not</span> <span class="pre">Found</span>
                                      <span class="pre">Page</span></code> or alternatively, if set <code class=
                                      "docutils literal notranslate"><span class="pre">notFoundFunc</span></code> will
                                      be called and the request object (<code class=
                                      "docutils literal notranslate"><span class="pre">req</span></code>) will contain
                                      the key <code class="docutils literal notranslate"><span class=
                                      "pre">errMsg</span></code> (<code class=
                                      "docutils literal notranslate"><span class="pre">req.errMsg</span></code>), with
                                      the error message.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">directoryFunc</span></code>: A <span class="green">Function</span> to
                                      handle directory listings from the filesystem, if no <code class=
                                      "docutils literal notranslate"><span class="pre">index.html</span></code> file
                                      exists in the requested directory. May also be set to <code class=
                                      "docutils literal notranslate"><span class="pre">true</span></code> to use the
                                      built-in function. If set <code class="docutils literal notranslate"><span class=
                                      "pre">false</span></code> (the default), a “404 Forbidden” response is sent where
                                      a directory listing is requested and no index.html file exists. See <a class=
                                      "reference internal" href="#built-in-directory-function">Built-in Directory
                                      Function</a> below for more information.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class="pre">user</span></code>:
                                      A <span class="green">String</span>, the user account which the server will
                                      switch to after binding to the specified ip address and port. Only valid if
                                      server is started as <code class="docutils literal notranslate"><span class=
                                      "pre">root</span></code>. This setting is used for binding to privileged ports as
                                      <code class="docutils literal notranslate"><span class="pre">root</span></code>
                                      and then dropping privileges. If the server is started as root, <code class=
                                      "docutils literal notranslate"><span class="pre">user</span></code> must be set.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">cacheControl</span></code>: A <span class="green">String</span> or a
                                      <span class="green">Boolean</span>. If a <span class="green">String</span> - the
                                      text to set the “Cache-Control” header when serving files off of the filesystem.
                                      The default is “max-age=84600, public”, if not set or set <code class=
                                      "docutils literal notranslate"><span class="pre">true</span></code>. If set
                                      <code class="docutils literal notranslate"><span class="pre">false</span></code>,
                                      no header is sent.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">compressFiles</span></code>: A <span class="green">Boolean</span> or
                                      <span class="green">Array</span>. Whether to use gzip compression for files
                                      served from the filesystem. Default is <code class=
                                      "docutils literal notranslate"><span class="pre">false</span></code>. If an
                                      <span class="green">Array</span>. is given, it is a list of file extension which
                                      will be compressed. If <code class="docutils literal notranslate"><span class=
                                      "pre">true</span></code> - the following default <span class="green">Array</span>
                                      of extensions will be used: <code class=
                                      "docutils literal notranslate"><span class="pre">["html",</span> <span class=
                                      "pre">"css",</span> <span class="pre">"js",</span> <span class=
                                      "pre">"json,</span> <span class="pre">"xml",</span> <span class=
                                      "pre">"txt",</span> <span class="pre">"text",</span> <span class=
                                      "pre">"htm"]</span></code>.
                                    </p>
                                    <p>
                                      Note that compressed files will be cached in a directory named “.gzipcache/” in
                                      the directory in which the files are located. Compressed cached files are updated
                                      based on the date of the original. The webserver’s <code class=
                                      "docutils literal notranslate"><span class="pre">user</span></code> must have
                                      write permissions in the directory in which the files are located in order for
                                      compressed files to be cached.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">compressScripts</span></code>: A <span class="green">Boolean</span>.
                                      Whether to compress the output from scripts by default. If not set, the default
                                      is <code class="docutils literal notranslate"><span class=
                                      "pre">false</span></code>. This can be overridden in the return value from a
                                      script using the key <code class="docutils literal notranslate"><span class=
                                      "pre">compress</span></code> set to a <span class="green">Boolean</span> or a
                                      compression level (1-10). See the last example in <a class="reference internal"
                                      href="#the-return-object">The Return Object</a> below.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">compressLevel</span></code>: A <span class="green">Number</span>. The
                                      default level of compression used for files and scripts. Must be an integer
                                      between 1 and 10. The default, if not specified, is <code class=
                                      "docutils literal notranslate"><span class="pre">1</span></code>.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">compressMinSize</span></code>: A <span class="green">Number</span>. The
                                      minimum size in bytes any file or script output must be in order for the content
                                      to be compressed. The default, if not specified, is <code class=
                                      "docutils literal notranslate"><span class="pre">1000</span></code>.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">mimeMap</span></code>: An <span class="green">Object</span>, additions or
                                      changes to the standard extension to mime mappings. Normally, if, e.g.,
                                      <code class="docutils literal notranslate"><span class="pre">return</span>
                                      <span class="pre">{</span> <span class="pre">"m4v":</span> <span class=
                                      "pre">mymovie</span> <span class="pre">};</span></code> is set as <a class=
                                      "reference internal" href="#the-return-object">The Return Object</a> to a mapped
                                      function, the header <code class="docutils literal notranslate"><span class=
                                      "pre">content-type:</span> <span class="pre">video/x-m4v</span></code> is sent.
                                      Though the <code class="docutils literal notranslate"><span class=
                                      "pre">content-type</span></code> header can be changed using the <code class=
                                      "docutils literal notranslate"><span class="pre">headers</span></code> object in
                                      <a class="reference internal" href="#the-return-object">The Return Object</a>, it
                                      does not affect files served from the filesystem. If it is necessary to change
                                      the default “content-type” for both <a class="reference internal" href=
                                      "#mapped-functions">Mapped Functions</a> and files served from <a class=
                                      "reference internal" href="#mapped-directories">Mapped Directories</a>,
                                      extension:mime-types mappings may be set or changed as follows:
                                    </p>
                                    <div class="highlight-javascript notranslate">
                                      <div class="highlight">
                                        <pre><span></span><span class="nx">server</span><span class=
                                        "p">.</span><span class="nx">start</span><span class="p">({</span>
    <span class="p">...,</span>
    <span class="nx">mimeMap</span><span class="o">:</span> <span class="p">{</span>
        <span class="cm">/* make these movies play as mp4s */</span>
        <span class="s2">"m4v"</span><span class="o">:</span> <span class="s2">"video/mp4"</span><span class=
"p">,</span>
        <span class="s2">"mov"</span><span class="o">:</span> <span class="s2">"video/mp4"</span>
    <span class="p">},</span>
    <span class="nx">map</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">"/"</span><span class="o">:</span> <span class="s2">"/var/www/html"</span><span class=
"p">,</span>
        <span class="p">...,</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre>
                                      </div>
                                    </div>
                                    <p>
                                      For a complete list of defaults, see <a class="reference internal" href=
                                      "#key-to-mime-mappings">Key to Mime Mappings</a> below.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class="pre">map</span></code>:
                                      An <span class="green">Object</span> of url to function or filesystem mapping.
                                      The keys of the object are exact paths, regular expressions, partial paths or
                                      globbed paths to be matched against incoming requests. For example, a key
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">/myscript.html</span></code> would match an incoming request for
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">http://example.com/myscript.html</span></code>. The value to which the key
                                      is set controls which function, module or filesystem path will be used.
                                    </p>
                                    <p>
                                      If the value is a <span class="green">Function</span>, that function is used as
                                      the callback function. If the value is an <span class="green">Object</span> with
                                      <code class="docutils literal notranslate"><span class="pre">module</span></code>
                                      or <code class="docutils literal notranslate"><span class=
                                      "pre">modulePath</span></code> key set, it is assumed to be a script name (the
                                      same as is used for <a class="reference internal" href=
                                      "rampart-main.html#using-the-require-function-to-import-modules"><span class=
                                      "std std-ref">require()</span></a>) or a path with scripts.
                                    </p>
                                    <p>
                                      If the value is a <span class="green">String</span>, or it is an <span class=
                                      "green">Object</span> with <code class=
                                      "docutils literal notranslate"><span class="pre">path</span></code> set, it is
                                      assumed to be a mapping to the filesystem. A mapping to a filesystem path may
                                      also include headers.
                                    </p>
                                    <p>
                                      Example:
                                    </p>
                                    <div class="highlight-javascript notranslate">
                                      <div class="highlight">
                                        <pre><span></span><span class="kd">var</span> <span class=
                                        "nx">server</span> <span class="o">=</span> <span class=
                                        "nx">require</span><span class="p">(</span><span class=
                                        "s2">"rampart-server"</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">pid</span> <span class="o">=</span> <span class=
"nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span>
    <span class="nx">bind</span><span class="o">:</span> <span class="p">[</span> <span class=
"s2">"[::]:8088"</span><span class="p">,</span> <span class="s2">"0.0.0.0:8088"</span> <span class=
"p">],</span> <span class="cm">/* bind to all */</span>
    <span class="nx">map</span> <span class="o">:</span>
    <span class="p">{</span>
        <span class="s2">"/"</span><span class="o">:</span>            <span class=
"s2">"/usr/local/etc/httpd/htdocs"</span>  <span class="cm">/* map all file requests */</span>
        <span class="s2">"/search.html"</span><span class="o">:</span> <span class="kd">function</span> <span class=
"p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span> <span class=
"p">...</span> <span class="p">},</span>         <span class="cm">/* search function */</span>
        <span class="s2">"/images/"</span><span class="o">:</span>     <span class="p">{</span>
                            <span class="nx">path</span><span class="o">:</span> <span class=
"s2">"/path/to/my/jpgs/"</span><span class="p">,</span>
                            <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
                                <span class="s2">"Content-Control"</span><span class="o">:</span> <span class=
"s2">"max-age=31556952, public"</span><span class="p">,</span>
                                <span class="s2">"X-Custom-Header"</span><span class="o">:</span> <span class=
"mi">1</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre>
                                      </div>
                                    </div>
                                    <p>
                                      In the above example, as the longer path, the <code class=
                                      "docutils literal notranslate"><span class="pre">"/search.html"</span></code> key
                                      will have priority over <code class="docutils literal notranslate"><span class=
                                      "pre">"/"</span></code> key, so that a request <code class=
                                      "docutils literal notranslate"><span class=
                                      "pre">http://localhost:8088/search.html</span></code> will cause the function to
                                      be executed while anything else will match <code class=
                                      "docutils literal notranslate"><span class="pre">"/"</span></code> (assuming
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">mapSort</span></code> is not set to <code class=
                                      "docutils literal notranslate"><span class="pre">false</span></code>).
                                    </p>
                                    <p>
                                      Keys/paths used for mapping a <span class="green">Function</span> may be given in
                                      one of three different formats, which are tested for a match in the following
                                      order:
                                    </p>
                                    <ul class="simple">
                                      <li>
                                        <p>
                                          Exact Paths - Paths starting with a “/” and having no unescaped <code class=
                                          "docutils literal notranslate"><span class="pre">*</span></code> characters
                                          will be matched exactly with the incoming request.
                                        </p>
                                      </li>
                                      <li>
                                        <p>
                                          Regular Expression paths - A path/key that starts with <code class=
                                          "docutils literal notranslate"><span class="pre">~</span></code> will match
                                          the Perl Regular Expression following the <code class=
                                          "docutils literal notranslate"><span class="pre">~</span></code>. Example:
                                          <code class="docutils literal notranslate"><span class="pre">map:</span>
                                          <span class="pre">{"~/.*/myfile.html":</span> <span class=
                                          "pre">myfunction</span> <span class="pre">}</span></code> will match any path
                                          ending in <code class="docutils literal notranslate"><span class=
                                          "pre">myfile.html</span></code> and run the named function <code class=
                                          "docutils literal notranslate"><span class="pre">myfunction</span></code>.
                                        </p>
                                      </li>
                                      <li>
                                        <p>
                                          Glob Paths - A glob path will have the last priority for matching the
                                          requested url. Example: <code class=
                                          "docutils literal notranslate"><span class="pre">map:</span> <span class=
                                          "pre">{"/*/myfile.html":</span> <span class="pre">myfunction2</span>
                                          <span class="pre">}</span></code> will match the same as the example above,
                                          but would have lower priority. If both these examples were present,
                                          <code class="docutils literal notranslate"><span class=
                                          "pre">myfunction2</span></code> would never match.
                                        </p>
                                      </li>
                                    </ul>
                                    <p>
                                      Keys/paths used for mapping to the <strong>filesystem</strong> are always taken
                                      as an Exact path. Regular expressions and globs are not allowed.
                                    </p>
                                  </li>
                                  <li>
                                    <p>
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">mapSort</span></code>: A <span class="green">Boolean</span>, whether to
                                      automatically sort the mapped paths given as keys to the <span class=
                                      "green">Object</span> passed to <code class=
                                      "docutils literal notranslate"><span class="pre">map</span></code> below. Default
                                      is <code class="docutils literal notranslate"><span class=
                                      "pre">true</span></code>. If <code class=
                                      "docutils literal notranslate"><span class="pre">false</span></code>, paths from
                                      the <code class="docutils literal notranslate"><span class=
                                      "pre">map</span></code> <span class="green">Object</span> will be matched in the
                                      order they are given.
                                    </p>
                                    <p>
                                      Note that regardless of this setting, paths are match by type of path (see below)
                                      with Exact paths tested first, then regular expression paths and lastly glob
                                      paths. However, it is usually desirable for longer paths to have priority over
                                      shorter ones. For example, if <code class=
                                      "docutils literal notranslate"><span class="pre">/</span></code> and <code class=
                                      "docutils literal notranslate"><span class="pre">/search.html</span></code> are
                                      both specified (both are “Exact” paths), <code class=
                                      "docutils literal notranslate"><span class="pre">/search.html</span></code>
                                      should be checked first, otherwise <code class=
                                      "docutils literal notranslate"><span class="pre">/</span></code> will match and
                                      <code class="docutils literal notranslate"><span class=
                                      "pre">/search.html</span></code> will never match. When <code class=
                                      "docutils literal notranslate"><span class="pre">mapSort</span></code> is
                                      <code class="docutils literal notranslate"><span class="pre">true</span></code>,
                                      key/paths are automatically sorted by length.
                                    </p>
                                  </li>
                                </ul>
                              </div>
                            </blockquote>
                          </dd>
                          <dt>
                            Return Value
                          </dt>
                          <dd>
                            <p>
                              A <span class="green">Number</span>, the pid of the current process, or if <code class=
                              "docutils literal notranslate"><span class="pre">daemon</span></code> is set to
                              <code class="docutils literal notranslate"><span class="pre">true</span></code>, the pid
                              of the forked server.
                            </p>
                          </dd>
                        </dl>
                      </div>
                    </div>
                  </div>
                  <div class="section" id="server-usage-details">
                    <h2>
                      Server Usage Details<a class="headerlink" href="#server-usage-details" title=
                      "Permalink to this headline">¶</a>
                    </h2>
                    <div class="section" id="path-mapping">
                      <h3>
                        Path Mapping<a class="headerlink" href="#path-mapping" title="Permalink to this headline">¶</a>
                      </h3>
                      <blockquote>
                        <div>
                          <p>
                            Path mapping using the <code class="docutils literal notranslate"><span class=
                            "pre">map</span></code> property in <a class="reference internal" href="#start">start()</a>
                            above may be used to map URL paths to both <span class="green">Functions</span> and to a
                            directories on the local filesystem.
                          </p>
                        </div>
                      </blockquote>
                      <div class="section" id="mapped-functions">
                        <h4>
                          Mapped Functions<a class="headerlink" href="#mapped-functions" title=
                          "Permalink to this headline">¶</a>
                        </h4>
                        <blockquote>
                          <div>
                            <p>
                              A mapped function may be expressed in one of several ways.
                            </p>
                            <ul class="simple">
                              <li>
                                <p>
                                  Inline function: <code class="docutils literal notranslate"><span class=
                                  "pre">map:</span> <span class="pre">{"/search.html":</span> <span class=
                                  "pre">function(res)</span> <span class="pre">{</span> <span class="pre">...</span>
                                  <span class="pre">}</span> <span class="pre">}</span></code>.
                                </p>
                              </li>
                              <li>
                                <p>
                                  A Global function: <code class="docutils literal notranslate"><span class=
                                  "pre">map:</span> <span class="pre">{"/search.html":</span> <span class=
                                  "pre">myfunc</span> <span class="pre">}</span></code> where <code class=
                                  "docutils literal notranslate"><span class="pre">myfunc</span></code> is a function
                                  declared <strong>globally</strong> in the current script.
                                </p>
                              </li>
                              <li>
                                <p>
                                  A module with <code class="docutils literal notranslate"><span class=
                                  "pre">module.exports</span></code> set to the desired function. Example: <code class=
                                  "docutils literal notranslate"><span class="pre">map:</span> <span class=
                                  "pre">{"/search.html"</span> <span class="pre">:</span> <span class=
                                  "pre">{module:"mysearchmod"}</span> <span class="pre">}</span></code> where
                                  mysearchmod.js is in a <a class="reference internal" href=
                                  "rampart-main.html#module-search-path"><span class="std std-ref">standard module
                                  search path</span></a>.
                                </p>
                              </li>
                              <li>
                                <p>
                                  A directory of modules where the directory contains one or more modules with
                                  <code class="docutils literal notranslate"><span class=
                                  "pre">module.exports</span></code> set to <span class="green">Functions</span> or an
                                  <span class="green">Object</span> containing <span class="green">Functions</span>.
                                  Example: <code class="docutils literal notranslate"><span class="pre">map:</span>
                                  <span class="pre">{"/scripts/":</span> <span class="pre">{modulePath:</span>
                                  <span class="pre">"/path/to/myscriptsdir/"}</span> <span class="pre">}</span></code>.
                                  In this case, if <code class="docutils literal notranslate"><span class=
                                  "pre">/path/to/myscriptsdir/mymod.js</span></code> script exists, it might be
                                  available from the URL <code class="docutils literal notranslate"><span class=
                                  "pre">http://localhost:8088/scripts/mymod.ext</span></code> where <code class=
                                  "docutils literal notranslate"><span class="pre">.ext</span></code> can be
                                  <code class="docutils literal notranslate"><span class="pre">.html</span></code>,
                                  <code class="docutils literal notranslate"><span class="pre">.txt</span></code> or
                                  any other extension desired. Note that regardless of the extension used, the
                                  mime-type is set in <a class="reference internal" href="#the-return-object">The
                                  Return Object</a>.
                                </p>
                              </li>
                              <li>
                                <p>
                                  A mapped function path/key must start with <code class=
                                  "docutils literal notranslate"><span class="pre">ws:</span></code> for websocket
                                  connections. See <a class="reference internal" href="#websockets">Websockets</a>
                                  below.
                                </p>
                              </li>
                            </ul>
                          </div>
                        </blockquote>
                        <dl>
                          <dt>
                            NOTE:
                          </dt>
                          <dd>
                            <p>
                              A module may also return its own mapped functions. The url will be a concatenation of the
                              <code class="docutils literal notranslate"><span class="pre">map</span></code> object key
                              and the return object keys.
                            </p>
                            <p>
                              Example:
                            </p>
                            <div class="highlight-javascript notranslate">
                              <div class="highlight">
                                <pre><span></span><span class="kd">var</span> <span class=
                                "nx">server</span> <span class="o">=</span> <span class="nx">require</span><span class=
                                "p">(</span><span class="s2">"rampart-server"</span><span class="p">);</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span>
  <span class="cm">/* requests to http://localhost:8088/multi/ will be handled by *</span>
<span class="cm">   * modules/multi_function.js                                   */</span>
  <span class="nx">map</span><span class="o">:</span> <span class="p">{</span>
     <span class="s2">"/multi/"</span><span class="o">:</span>            <span class="p">{</span><span class=
"nx">module</span><span class="o">:</span> <span class="s2">"modules/multi_function.js"</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* Here modules/multi_function.js is a module which sets exports *</span>
<span class="cm"> * to an Object with keys as paths set to functions. Example:    */</span>

        <span class="cm">/* functions indexpage, firstpage, etc not shown */</span>
        <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class=
"o">=</span><span class="p">{</span>
            <span class="s2">"/"</span>                  <span class="o">:</span> <span class=
"nx">indexpage</span><span class="p">,</span>   <span class="c1">// the indexpage function</span>
            <span class="s2">"/index.html"</span>        <span class="o">:</span> <span class=
"nx">indexpage</span><span class="p">,</span>   <span class="c1">// same</span>
            <span class="s2">"/page1.html"</span>        <span class="o">:</span> <span class=
"nx">firstpage</span><span class="p">,</span>   <span class="c1">// function handles page 1</span>
            <span class="s2">"/page2.html"</span>        <span class="o">:</span> <span class=
"nx">secondpage</span><span class="p">,</span>  <span class="c1">// function handles page 2</span>
            <span class="s2">"/virtdir/page3.html"</span><span class="o">:</span> <span class=
"nx">thirdpage</span>    <span class="c1">// function handles page 3</span>
        <span class="p">};</span>
<span class="cm">/*</span>
<span class="cm">        These would then map to:</span>
<span class="cm">            http://localhost:8088/multi/</span>
<span class="cm">            http://localhost:8088/multi/index.html</span>
<span class="cm">            http://localhost:8088/multi/page1.html</span>
<span class="cm">            http://localhost:8088/multi/page2.html</span>
<span class="cm">            http://localhost:8088/multi/virtdir/page3.html</span>
<span class="cm">*/</span>
</pre>
                              </div>
                            </div>
                            <p>
                              For normal use, it is always preferable to use modules. The advantage of using modules is
                              that they can be changed at any time without having to restart the server and that
                              variables declared in the module have their scopes appropriately set.
                            </p>
                            <p>
                              See <a class="reference internal" href=
                              "rampart-main.html#using-the-require-function-to-import-modules"><span class=
                              "std std-ref">Using the require Function to Import Modules</span></a> for details on
                              writing and using modules.
                            </p>
                            <p>
                              It is also important to note that only global variables and functions from the main
                              script, along with inline functions are copied to each JavaScript context for each server
                              thread. Any other variable or function that might otherwise appear to be in scope when
                              <code class="docutils literal notranslate"><span class="pre">server.start()</span></code>
                              is executed will not be available from within each server thread. This is true regardless
                              of the state of <code class="docutils literal notranslate"><span class=
                              "pre">useThreads</span></code> setting above. Any semantic confusion that might be caused
                              by this limitation can be mostly avoided by placing functions in separate scripts as
                              modules, since variables declared in the module will be available and properly scoped
                              (though separately and distinctly; variables are never shared between threads – though
                              note that when using <a class="reference internal" href=
                              "rampart-main.html#rampart-event"><span class="std std-ref">rampart.event</span></a>, the
                              triggering of events and the <code class="docutils literal notranslate"><span class=
                              "pre">callbackTriggerVar</span></code> do cross threads).
                            </p>
                            <p>
                              Example of a scoped variable that would not be available:
                            </p>
                            <div class="highlight-javascript notranslate">
                              <div class="highlight">
                                <pre><span></span><span class="kd">var</span> <span class=
                                "nx">server</span> <span class="o">=</span> <span class="nx">require</span><span class=
                                "p">(</span><span class="s2">"rampart-server"</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">startserver</span><span class="p">()</span> <span class="p">{</span>
   <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class=
"s2">"&lt;pre&gt;HELLO WORLD!&lt;/pre&gt;"</span><span class="p">;</span>

   <span class="k">return</span> <span class="nx">server</span><span class="p">.</span><span class=
"nx">start</span><span class="p">({</span>
       <span class="nx">map</span><span class="o">:</span> <span class="p">{</span>
           <span class="s2">"/myfunc.html"</span><span class="o">:</span> <span class="kd">function</span><span class=
"p">(){</span> <span class="k">return</span> <span class="p">{</span><span class="nx">html</span><span class=
"o">:</span><span class="nx">html</span><span class="p">};</span> <span class="p">}</span>
       <span class="p">}</span>
   <span class="p">});</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">pid</span><span class="o">=</span><span class=
"nx">startserver</span><span class="p">();</span>


<span class="cm">/* result from http://localhost:8088/myfunc.html:</span>
<span class="cm">      Internal Server Error</span>
<span class="cm">      ReferenceError: identifier 'html' undefined</span>
<span class="cm">        at [anon] (duk_js_var.c:1236) internal</span>
<span class="cm">        at [anon] (test-server.js:8) preventsyield</span>
<span class="cm">*/</span>
</pre>
                              </div>
                            </div>
                            <p>
                              Note that if <code class="docutils literal notranslate"><span class="pre">var</span>
                              <span class="pre">html</span></code> was declared globally (e.g. directly after
                              <code class="docutils literal notranslate"><span class="pre">var</span> <span class=
                              "pre">server</span></code> line), the function would not throw an error.
                            </p>
                            <p>
                              Example of local variables that are available in a module:
                            </p>
                            <div class="highlight-javascript notranslate">
                              <div class="highlight">
                                <pre><span></span><span class="cm">/* mymod.js */</span>

<span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class=
"s2">"&lt;pre&gt;HELLO WORLD!&lt;/pre&gt;"</span><span class="p">;</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class=
"o">=</span> <span class="kd">function</span><span class="p">(){</span> <span class="k">return</span> <span class=
"p">{</span><span class="nx">html</span><span class="o">:</span><span class="nx">html</span><span class=
"p">};</span> <span class="p">}</span>
</pre>
                              </div>
                            </div>
                            <p>
                              With the main script containing:
                            </p>
                            <div class="highlight-javascript notranslate">
                              <div class="highlight">
                                <pre><span></span><span class="cm">/* test-server.js */</span>

<span class="kd">var</span> <span class="nx">server</span><span class="o">=</span><span class=
"nx">require</span><span class="p">(</span><span class="s2">"rampart-server"</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">pid</span> <span class="o">=</span> <span class=
"nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span>
  <span class="nx">map</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">"/myfunc.html"</span><span class="o">:</span> <span class="p">{</span><span class=
"nx">module</span><span class="o">:</span><span class="s1">'mymod'</span><span class="p">}</span>
  <span class="p">}</span>

<span class="p">});</span>
</pre>
                              </div>
                            </div>
                            <p>
                              In the above example, <code class="docutils literal notranslate"><span class=
                              "pre">var</span> <span class="pre">html</span></code> would be set once when the module
                              is loaded. It is then accessible from the exported function and its scope is limited to
                              the <code class="docutils literal notranslate"><span class="pre">mymod.js</span></code>
                              file.
                            </p>
                          </dd>
                        </dl>
                      </div>
                      <div class="section" id="mapped-directories">
                        <h4>
                          Mapped Directories<a class="headerlink" href="#mapped-directories" title=
                          "Permalink to this headline">¶</a>
                        </h4>
                        <blockquote>
                          <div>
                            <p>
                              Mapped Directories are specified by setting the value of a path key to a <span class=
                              "green">String</span>, where the <span class="green">String</span> is the name of the
                              directory on the current filesystem to use:
                            </p>
                            <div class="highlight-javascript notranslate">
                              <div class="highlight">
                                <pre><span></span><span class="kd">var</span> <span class=
                                "nx">server</span> <span class="o">=</span> <span class="nx">require</span><span class=
                                "p">(</span><span class="s2">"rampart-server"</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">pid</span> <span class="o">=</span> <span class=
"nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span>
    <span class="nx">map</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">"/"</span>   <span class="o">:</span> <span class="s2">"/var/www/html"</span><span class=
"p">,</span>
      <span class="cm">/* trailing '/' in '/css' is implied */</span>
      <span class="s2">"/css"</span><span class="o">:</span> <span class="s2">"/usr/local/etc/httpd/css"</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre>
                              </div>
                            </div>
                            <p>
                              Mapped directories may also be mapped using the following syntax, which allows for custom
                              headers to be sent with each file served:
                            </p>
                            <div class="highlight-javascript notranslate">
                              <div class="highlight">
                                <pre><span></span><span class="kd">var</span> <span class=
                                "nx">server</span> <span class="o">=</span> <span class="nx">require</span><span class=
                                "p">(</span><span class="s2">"rampart-server"</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">pid</span> <span class="o">=</span> <span class=
"nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span>
    <span class="nx">map</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">"/"</span>   <span class="o">:</span> <span class="p">{</span>
          <span class="nx">path</span><span class="o">:</span> <span class="s2">"/var/www/html"</span><span class=
"p">,</span>
          <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
              <span class="s2">"X-Custom-Header-1"</span><span class="o">:</span> <span class=
"s2">"myval1"</span><span class="p">,</span>
              <span class="s2">"X-Custom-Header-2"</span><span class="o">:</span> <span class="s2">"myval2"</span>
          <span class="p">}</span>
      <span class="p">},</span>
      <span class="s2">"/css/"</span><span class="o">:</span> <span class="s2">"/usr/local/etc/httpd/css"</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre>
                              </div>
                            </div>
                            <p>
                              In the above example, all the files in <code class=
                              "docutils literal notranslate"><span class="pre">/var/www/html/*</span></code> would be
                              mapped to <code class="docutils literal notranslate"><span class=
                              "pre">http://localhost:8088/*</span></code> including any subdirectories. However,
                              <code class="docutils literal notranslate"><span class=
                              "pre">http://localhost:8088/css/*</span></code> is mapped from <code class=
                              "docutils literal notranslate"><span class="pre">/usr/local/etc/httpd/css/*</span></code>
                              even if a <code class="docutils literal notranslate"><span class=
                              "pre">/var/www/html/css/</span></code> directory exists.
                            </p>
                            <p>
                              Note that globs and regular expressions are not allowed for mapped directories. Note also
                              that keys for mapped directories are always treated as directories and have a trailing
                              <code class="docutils literal notranslate"><span class="pre">/</span></code> added if not
                              present. If, e.g., <code class="docutils literal notranslate"><span class=
                              "pre">map:{"/file.html":"/my/dir"}</span></code> was specified, <code class=
                              "docutils literal notranslate"><span class=
                              "pre">http://localhost:8088/file.html</span></code> would return “NOT FOUND” but URLs
                              beginning with <code class="docutils literal notranslate"><span class=
                              "pre">http://localhost:8088/file.html/</span></code> would return files from <code class=
                              "docutils literal notranslate"><span class="pre">/my/dir/</span></code>.
                            </p>
                          </div>
                        </blockquote>
                      </div>
                    </div>
                    <div class="section" id="the-request-object">
                      <h3>
                        The Request Object<a class="headerlink" href="#the-request-object" title=
                        "Permalink to this headline">¶</a>
                      </h3>
                      <blockquote>
                        <div>
                          <p>
                            Mapped <span class="green">Functions</span> are passed a single <span class=
                            "green">Object</span> which contains the details of the request. For example, if the url
                            <code class="docutils literal notranslate"><span class=
                            "pre">http://localhost:8088/showreq.html?q=search+terms</span></code> is requested (with a
                            cookie set), the <span class="green">Object</span> passed to the function might look
                            something like this:
                          </p>
                          <div class="highlight-javascript notranslate">
                            <div class="highlight">
                              <pre><span></span><span class="p">{</span>
   <span class="s2">"ip"</span><span class="o">:</span> <span class="s2">"::1"</span><span class="p">,</span>
   <span class="s2">"port"</span><span class="o">:</span> <span class="mi">33948</span><span class="p">,</span>
   <span class="s2">"method"</span><span class="o">:</span> <span class="s2">"GET"</span><span class="p">,</span>
   <span class="s2">"path"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">"file"</span><span class="o">:</span> <span class="s2">"showreq.html"</span><span class=
"p">,</span>
      <span class="s2">"path"</span><span class="o">:</span> <span class="s2">"/showreq.html"</span><span class=
"p">,</span>
      <span class="s2">"base"</span><span class="o">:</span> <span class="s2">"/"</span><span class="p">,</span>
      <span class="s2">"scheme"</span><span class="o">:</span> <span class="s2">"http://"</span><span class=
"p">,</span>
      <span class="s2">"host"</span><span class="o">:</span> <span class="s2">"localhost:8088"</span><span class=
"p">,</span>
      <span class="s2">"url"</span><span class="o">:</span> <span class=
"s2">"http://localhost:8088/showreq.html?q=search+terms"</span>
   <span class="p">},</span>
   <span class="s2">"query"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">"q"</span><span class="o">:</span> <span class="s2">"search terms"</span>
   <span class="p">},</span>
   <span class="s2">"body"</span><span class="o">:</span> <span class="p">{},</span>
   <span class="s2">"query_raw"</span><span class="o">:</span> <span class="s2">"q=search+terms"</span><span class=
"p">,</span>
   <span class="s2">"cookies"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">"mycookie"</span><span class="o">:</span> <span class="s2">"cookietext"</span><span class=
"p">,</span>
   <span class="p">},</span>
   <span class="s2">"headers"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">"Host"</span><span class="o">:</span> <span class="s2">"localhost:8088"</span><span class=
"p">,</span>
      <span class="s2">"Connection"</span><span class="o">:</span> <span class="s2">"keep-alive"</span><span class=
"p">,</span>
      <span class="s2">"DNT"</span><span class="o">:</span> <span class="s2">"1"</span><span class="p">,</span>
      <span class="s2">"Upgrade-Insecure-Requests"</span><span class="o">:</span> <span class=
"s2">"1"</span><span class="p">,</span>
      <span class="s2">"User-Agent"</span><span class="o">:</span> <span class=
"s2">"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.121 Safari/537.36"</span><span class="p">,</span>
      <span class="s2">"Accept"</span><span class="o">:</span> <span class=
"s2">"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"</span><span class="p">,</span>
      <span class="s2">"Sec-Fetch-Site"</span><span class="o">:</span> <span class="s2">"none"</span><span class=
"p">,</span>
      <span class="s2">"Sec-Fetch-Mode"</span><span class="o">:</span> <span class="s2">"navigate"</span><span class=
"p">,</span>
      <span class="s2">"Sec-Fetch-User"</span><span class="o">:</span> <span class="s2">"?1"</span><span class=
"p">,</span>
      <span class="s2">"Sec-Fetch-Dest"</span><span class="o">:</span> <span class="s2">"document"</span><span class=
"p">,</span>
      <span class="s2">"Accept-Encoding"</span><span class="o">:</span> <span class=
"s2">"gzip, deflate, br"</span><span class="p">,</span>
      <span class="s2">"Accept-Language"</span><span class="o">:</span> <span class=
"s2">"en-US,en;q=0.9"</span><span class="p">,</span>
      <span class="s2">"Cookie"</span><span class="o">:</span> <span class="s2">"mycookie=cookietext"</span>
   <span class="p">},</span>
   <span class="s2">"params"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">"q"</span><span class="o">:</span> <span class="s2">"search terms"</span><span class=
"p">,</span>
      <span class="s2">"mycookie"</span><span class="o">:</span> <span class="s2">"cookietext"</span><span class=
"p">,</span>
      <span class="s2">"Host"</span><span class="o">:</span> <span class="s2">"localhost:8088"</span><span class=
"p">,</span>
      <span class="s2">"Connection"</span><span class="o">:</span> <span class="s2">"keep-alive"</span><span class=
"p">,</span>
      <span class="s2">"DNT"</span><span class="o">:</span> <span class="s2">"1"</span><span class="p">,</span>
      <span class="s2">"Upgrade-Insecure-Requests"</span><span class="o">:</span> <span class=
"s2">"1"</span><span class="p">,</span>
      <span class="s2">"User-Agent"</span><span class="o">:</span> <span class=
"s2">"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.121 Safari/537.36"</span><span class="p">,</span>
      <span class="s2">"Accept"</span><span class="o">:</span> <span class=
"s2">"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"</span><span class="p">,</span>
      <span class="s2">"Sec-Fetch-Site"</span><span class="o">:</span> <span class="s2">"none"</span><span class=
"p">,</span>
      <span class="s2">"Sec-Fetch-Mode"</span><span class="o">:</span> <span class="s2">"navigate"</span><span class=
"p">,</span>
      <span class="s2">"Sec-Fetch-User"</span><span class="o">:</span> <span class="s2">"?1"</span><span class=
"p">,</span>
      <span class="s2">"Sec-Fetch-Dest"</span><span class="o">:</span> <span class="s2">"document"</span><span class=
"p">,</span>
      <span class="s2">"Accept-Encoding"</span><span class="o">:</span> <span class=
"s2">"gzip, deflate, br"</span><span class="p">,</span>
      <span class="s2">"Accept-Language"</span><span class="o">:</span> <span class=
"s2">"en-US,en;q=0.9"</span><span class="p">,</span>
      <span class="s2">"Cookie"</span><span class="o">:</span> <span class="s2">"mycookie=cookietext"</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre>
                            </div>
                          </div>
                          <p>
                            The above example could be printed out to the web client using the following function:
                          </p>
                          <div class="highlight-javascript notranslate">
                            <div class="highlight">
                              <pre><span></span><span class="nx">server</span><span class="p">.</span><span class=
                              "nx">start</span><span class="p">(</span>
<span class="p">{</span>
    <span class="p">...,</span>
    <span class="nx">map</span> <span class="o">:</span> <span class="p">{</span>
        <span class="s2">"/showreq.txt"</span> <span class="o">:</span> <span class="kd">function</span><span class=
"p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">(</span> <span class="p">{</span> <span class=
"nx">txt</span><span class="o">:</span> <span class="nx">rampart</span><span class="p">.</span><span class=
"nx">utils</span><span class="p">.</span><span class="nx">sprintf</span><span class="p">(</span><span class=
"s2">"%3J"</span><span class="p">,</span><span class="nx">req</span><span class="p">)</span> <span class=
"p">}</span> <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre>
                            </div>
                          </div>
                          <p>
                            Note that the <code class="docutils literal notranslate"><span class=
                            "pre">params</span></code> key is an <span class="green">Object</span> with properties set
                            to an amalgam of all the useful variables sent from the client. It includes variables from
                            headers, cookies, GET query parameters and POST data, prioritize in that order. If, e.g., a
                            query parameter has the same name as a cookie, the cookie value will override the the query
                            parameter.
                          </p>
                        </div>
                      </blockquote>
                      <div class="section" id="posting-form-data">
                        <h4>
                          Posting Form Data<a class="headerlink" href="#posting-form-data" title=
                          "Permalink to this headline">¶</a>
                        </h4>
                        <blockquote>
                          <div>
                            <p>
                              When posting form data, the request object will include an additional property
                              <code class="docutils literal notranslate"><span class="pre">postData</span></code>,
                              which will contain the parsed content of the posted form as well as the <code class=
                              "docutils literal notranslate"><span class="pre">Content-Type</span></code> which will be
                              set to <code class="docutils literal notranslate"><span class=
                              "pre">"application/x-www-form-urlencoded"</span></code>. The <code class=
                              "docutils literal notranslate"><span class="pre">postData</span></code> <code class=
                              "docutils literal notranslate"><span class="pre">content</span></code> will also be
                              copied to <code class="docutils literal notranslate"><span class=
                              "pre">params</span></code>, so long as there are no name collisions between those keys
                              and variables set from cookies, headers or query parameters. The raw posted content will
                              be returned in the property <code class="docutils literal notranslate"><span class=
                              "pre">body</span></code> as a <span class="green">Buffer</span>. Example:
                            </p>
                            <div class="highlight-javascript notranslate">
                              <div class="highlight">
                                <pre><span></span><span class="nx">server</span><span class="p">.</span><span class=
                                "nx">start</span><span class="p">(</span>
<span class="p">{</span>
    <span class="p">...,</span>
    <span class="nx">map</span> <span class="o">:</span> <span class="p">{</span>

        <span class="s2">"post.html"</span><span class="o">:</span> <span class="kd">function</span><span class=
"p">(){</span>
            <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class=
"s1">'&lt;html&gt;&lt;body&gt;&lt;form action="/showreq.txt" method="POST"&gt;'</span><span class="o">+</span>
                <span class="s1">'&lt;label for="fname"&gt;First name:&lt;/label&gt;&lt;br&gt;'</span> <span class=
"o">+</span>
                <span class="s1">'&lt;input type="text" id="fname" name="fname"&gt;&lt;br&gt;'</span> <span class=
"o">+</span>
                <span class="s1">'&lt;label for="lname"&gt;Last name:&lt;/label&gt;&lt;br&gt;'</span> <span class=
"o">+</span>
                <span class="s1">'&lt;input type="text" id="lname" name="lname"&gt;'</span><span class="o">+</span>
                <span class="s1">'&lt;input type="submit" name="go"&gt;'</span><span class="o">+</span>
            <span class="s1">'&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;'</span><span class="p">;</span>

             <span class="k">return</span> <span class="p">{</span><span class="nx">html</span><span class=
"o">:</span><span class="nx">html</span><span class="p">};</span>
        <span class="p">},</span>

        <span class="s2">"/showreq.txt"</span> <span class="o">:</span> <span class="kd">function</span><span class=
"p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>

            <span class="cm">/* convert "body" to text so we can print it out */</span>
            <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class=
"o">=</span><span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class=
"p">.</span><span class="nx">bufferToString</span><span class="p">(</span><span class="nx">req</span><span class=
"p">.</span><span class="nx">body</span><span class="p">);</span>

            <span class="k">return</span><span class="p">(</span> <span class="p">{</span> <span class=
"nx">txt</span><span class="o">:</span> <span class="nx">rampart</span><span class="p">.</span><span class=
"nx">utils</span><span class="p">.</span><span class="nx">sprintf</span><span class="p">(</span><span class=
"s2">"%3J"</span><span class="p">,</span><span class="nx">req</span><span class="p">)</span> <span class=
"p">}</span> <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="cm">/* response from posting form at http://localhost:8088/post.html</span>
<span class="cm">   might include:</span>

<span class="cm">    {</span>
<span class="cm">       "ip": "127.0.0.1",</span>
<span class="cm">       "port": 38680,</span>
<span class="cm">       "method": "POST",</span>
<span class="cm">       "path": {</span>
<span class="cm">          "file": "showreq.html",</span>
<span class="cm">          "path": "/showreq.html",</span>
<span class="cm">          "base": "/",</span>
<span class="cm">          "scheme": "http://",</span>
<span class="cm">          "host": "localhost:8088",</span>
<span class="cm">          "url": "http://localhost:8088/showreq.html"</span>
<span class="cm">       },</span>
<span class="cm">       "query": {},</span>
<span class="cm">       "body": "fname=Joe&amp;lname=Public&amp;go=Submit",</span>
<span class="cm">       "query_raw": "",</span>

<span class="cm">        ...,</span>

<span class="cm">       "postData": {</span>
<span class="cm">          "Content-Type": "application/x-www-form-urlencoded",</span>
<span class="cm">          "content": {</span>
<span class="cm">               "fname": "Joe",</span>
<span class="cm">               "lname": "Public",</span>
<span class="cm">               "go": "Submit"</span>
<span class="cm">          }</span>
<span class="cm">       },</span>
<span class="cm">       "params": {</span>
<span class="cm">          "fname": "Joe",</span>
<span class="cm">          "lname": "Public",</span>
<span class="cm">          "go": "Submit",</span>

<span class="cm">          ...,</span>

<span class="cm">       }</span>
<span class="cm">    }</span>
<span class="cm">*/</span>
</pre>
                              </div>
                            </div>
                          </div>
                        </blockquote>
                      </div>
                      <div class="section" id="posting-multipart-form-data">
                        <h4>
                          Posting Multipart Form Data<a class="headerlink" href="#posting-multipart-form-data" title=
                          "Permalink to this headline">¶</a>
                        </h4>
                        <blockquote>
                          <div>
                            <p>
                              Multipart form data will also be returned in the property <code class=
                              "docutils literal notranslate"><span class="pre">formData</span></code> and will have the
                              <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code>
                              property set to <code class="docutils literal notranslate"><span class=
                              "pre">"multipart/form-data"</span></code>. The <code class=
                              "docutils literal notranslate"><span class="pre">content</span></code> property will
                              contain an array of objects, one object for each “part” of the form data. The key and
                              values of an object provides details and the content for each part.
                            </p>
                            <p>
                              Example:
                            </p>
                            <div class="highlight-javascript notranslate">
                              <div class="highlight">
                                <pre><span></span><span class="nx">server</span><span class="p">.</span><span class=
                                "nx">start</span><span class="p">(</span>
<span class="p">{</span>
    <span class="p">...,</span>
    <span class="nx">map</span> <span class="o">:</span> <span class="p">{</span>

        <span class="s2">"postfile.html"</span><span class="o">:</span> <span class="kd">function</span><span class=
"p">(){</span>
            <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class=
"s1">'&lt;html&gt;&lt;body&gt;&lt;form action="/showreq.txt" enctype="multipart/form-data" method="POST"&gt;'</span><span class="o">+</span>
                <span class="s1">'File: &lt;input type="FILE" name="file"/&gt;'</span> <span class="o">+</span>
                <span class="s1">'&lt;input type="submit" name="Upload" value="Upload" /&gt;'</span> <span class=
"o">+</span>
            <span class="s1">'&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;'</span><span class="p">;</span>

            <span class="k">return</span> <span class="p">{</span><span class="nx">html</span><span class=
"o">:</span> <span class="nx">html</span><span class="p">};</span>
        <span class="p">},</span>

        <span class="s2">"/showreq.txt"</span> <span class="o">:</span> <span class="kd">function</span><span class=
"p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>

            <span class="cm">/* convert "body" to text so we can print it out */</span>
            <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class=
"o">=</span><span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class=
"p">.</span><span class="nx">bufferToString</span><span class="p">(</span><span class="nx">req</span><span class=
"p">.</span><span class="nx">body</span><span class="p">);</span>

            <span class="k">return</span><span class="p">(</span> <span class="p">{</span> <span class=
"nx">txt</span><span class="o">:</span> <span class="nx">rampart</span><span class="p">.</span><span class=
"nx">utils</span><span class="p">.</span><span class="nx">sprintf</span><span class="p">(</span><span class=
"s2">"%3J"</span><span class="p">,</span><span class="nx">req</span><span class="p">)</span> <span class=
"p">}</span> <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="cm">/* posting a small file called "helloWorld.txt with the contents "Hello World!"</span>

<span class="cm">{</span>
<span class="cm">   "ip": "::1",</span>
<span class="cm">   "port": 39004,</span>
<span class="cm">   "method": "POST",</span>
<span class="cm">   "path": {</span>
<span class="cm">      "file": "showreq.html",</span>
<span class="cm">      "path": "/showreq.html",</span>
<span class="cm">      "base": "/",</span>
<span class="cm">      "scheme": "http://",</span>
<span class="cm">      "host": "localhost:8088",</span>
<span class="cm">      "url": "http://localhost:8088/showreq.html"</span>
<span class="cm">   },</span>
<span class="cm">   "query": {},</span>
<span class=
"cm">   "body": "------WebKitFormBoundaryB4UZ3AZ5kFBUZpR6\r\nContent-Disposition: form-data; name=\"file\"; filename=\"helloWorld.txt\"\r\nContent-Type: text/plain\r\n\r\nHello World!\r\n------WebKitFormBoundaryB4UZ3AZ5kFBUZpR6\r\nContent-Disposition: form-data; name=\"Upload\"\r\n\r\nUpload\r\n------WebKitFormBoundaryB4UZ3AZ5kFBUZpR6--\r\n",</span>
<span class="cm">   "query_raw": "",</span>
<span class="cm">   "cookies": {</span>
<span class="cm">      "mycookie": "cookietext",</span>
<span class="cm">   },</span>
<span class="cm">   "headers": {</span>
<span class="cm">      "Host": "localhost:8088",</span>
<span class="cm">      "Content-Length": "299",</span>
<span class="cm">      ...,</span>
<span class="cm">   },</span>
<span class="cm">   "postData": {</span>
<span class="cm">      "Content-Type": "multipart/form-data",</span>
<span class="cm">      "content": [</span>
<span class="cm">         {</span>
<span class="cm">            "Content-Disposition": "form-data",</span>
<span class="cm">            "name": "file",</span>
<span class="cm">            "filename": "helloWorld.txt",</span>
<span class="cm">            "Content-Type": "text/plain",</span>
<span class="cm">            "content": {</span>
<span class="cm">               "0": 72,</span>
<span class="cm">               "1": 101,</span>
<span class="cm">               "2": 108,</span>
<span class="cm">               "3": 108,</span>
<span class="cm">               "4": 111,</span>
<span class="cm">               "5": 32,</span>
<span class="cm">               "6": 87,</span>
<span class="cm">               "7": 111,</span>
<span class="cm">               "8": 114,</span>
<span class="cm">               "9": 108,</span>
<span class="cm">               "10": 100,</span>
<span class="cm">               "11": 33</span>
<span class="cm">            }</span>
<span class="cm">         },</span>
<span class="cm">         {</span>
<span class="cm">            "Content-Disposition": "form-data",</span>
<span class="cm">            "name": "Upload",</span>
<span class="cm">            "content": {</span>
<span class="cm">               "0": 85,</span>
<span class="cm">               "1": 112,</span>
<span class="cm">               "2": 108,</span>
<span class="cm">               "3": 111,</span>
<span class="cm">               "4": 97,</span>
<span class="cm">               "5": 100</span>
<span class="cm">            }</span>
<span class="cm">         }</span>
<span class="cm">      ]</span>
<span class="cm">   },</span>
<span class="cm">   "params": {</span>
<span class="cm">      "helloWorld.txt": {</span>
<span class="cm">         "0": 72,</span>
<span class="cm">         "1": 101,</span>
<span class="cm">         "2": 108,</span>
<span class="cm">         "3": 108,</span>
<span class="cm">         "4": 111,</span>
<span class="cm">         "5": 32,</span>
<span class="cm">         "6": 87,</span>
<span class="cm">         "7": 111,</span>
<span class="cm">         "8": 114,</span>
<span class="cm">         "9": 108,</span>
<span class="cm">         "10": 100,</span>
<span class="cm">         "11": 33</span>
<span class="cm">      },</span>
<span class="cm">      "Upload": {</span>
<span class="cm">         "0": 85,</span>
<span class="cm">         "1": 112,</span>
<span class="cm">         "2": 108,</span>
<span class="cm">         "3": 111,</span>
<span class="cm">         "4": 97,</span>
<span class="cm">         "5": 100</span>
<span class="cm">      },</span>
<span class="cm">      "Host": "localhost:8088",</span>
<span class="cm">      "Connection": "keep-alive",</span>
<span class="cm">      "Content-Length": "299",</span>
<span class="cm">      "Cache-Control": "max-age=0",</span>
<span class="cm">      ...,</span>
<span class="cm">   }</span>
<span class="cm">}</span>
<span class="cm">*/</span>
</pre>
                              </div>
                            </div>
                            <p>
                              Note that like <code class="docutils literal notranslate"><span class=
                              "pre">body</span></code>, the <code class="docutils literal notranslate"><span class=
                              "pre">contents</span></code> property of each uploaded part is a <span class=
                              "green">Buffer</span>.
                            </p>
                          </div>
                        </blockquote>
                      </div>
                      <div class="section" id="posting-json-data">
                        <h4>
                          Posting JSON Data<a class="headerlink" href="#posting-json-data" title=
                          "Permalink to this headline">¶</a>
                        </h4>
                        <blockquote>
                          <div>
                            <p>
                              JSON data, sent with <code class="docutils literal notranslate"><span class=
                              "pre">Content-Type</span></code> set to <code class=
                              "docutils literal notranslate"><span class="pre">"application/json"</span></code> will
                              also be parsed in a manner similar to <a class="reference internal" href=
                              "#posting-form-data">Posting Form Data</a>.
                            </p>
                            <div class="highlight-javascript notranslate">
                              <div class="highlight">
                                <pre><span></span><span class="kd">var</span> <span class="nx">server</span><span class=
                                "o">=</span><span class="nx">require</span><span class="p">(</span><span class=
                                "s2">"rampart-server"</span><span class="p">);</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span>
<span class="p">{</span>
    <span class="nx">user</span><span class="o">:</span><span class="s2">"nobody"</span><span class="p">,</span>
    <span class="nx">map</span> <span class="o">:</span> <span class="p">{</span>
        <span class="s2">"post.html"</span><span class="o">:</span> <span class="kd">function</span><span class=
"p">(){</span>
            <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class=
"s1">'&lt;html&gt;&lt;head&gt;&lt;script&gt;\n'</span><span class="o">+</span>
                   <span class="s1">'function senddata(){\n'</span> <span class="o">+</span>
                     <span class="s1">'var first= document.querySelector("#fname");\n'</span> <span class="o">+</span>
                     <span class="s1">'var last = document.querySelector("#lname");\n'</span> <span class="o">+</span>
                     <span class="s1">'var res  = document.querySelector("#res");\n'</span> <span class="o">+</span>
                     <span class="s1">'var xhr = new XMLHttpRequest();\n'</span> <span class="o">+</span>
                     <span class="s1">'xhr.open("POST", "/showreq.json");\n'</span> <span class="o">+</span>
                     <span class="s1">'xhr.setRequestHeader("Content-Type", "application/json");\n'</span> <span class=
"o">+</span>
                     <span class="s1">'xhr.onreadystatechange = function () { \n'</span> <span class="o">+</span>
                       <span class="s1">'if (xhr.readyState === 4 &amp;& xhr.status === 200) {\n'</span> <span class=
"o">+</span>
                          <span class=
"s1">'res.innerHTML = "&lt;pre&gt;"+ this.responseText +"&lt;/pre&gt;";\n'</span> <span class="o">+</span>
                       <span class="s1">'} \n'</span> <span class="o">+</span>
                     <span class="s1">'};\n'</span> <span class="o">+</span>
                     <span class=
"s1">'xhr.send( JSON.stringify({first:first.value, last:last.value}) );\n'</span><span class="o">+</span>
                     <span class="s1">'return false;'</span><span class="o">+</span>
                   <span class="s1">'}\n'</span><span class="o">+</span>
                <span class="s1">'&lt;/script&gt;&lt;/head&gt;&lt;body&gt;'</span><span class="o">+</span>
                <span class="s1">'&lt;label for="fname"&gt;First name:&lt;/label&gt;&lt;br&gt;'</span> <span class=
"o">+</span>
                <span class="s1">'&lt;input type="text" id="fname" name="fname"&gt;&lt;br&gt;'</span> <span class=
"o">+</span>
                <span class="s1">'&lt;label for="lname"&gt;Last name:&lt;/label&gt;&lt;br&gt;'</span> <span class=
"o">+</span>
                <span class="s1">'&lt;input type="text" id="lname" name="lname"&gt;'</span><span class="o">+</span>
                <span class="s1">'&lt;button onclick="return senddata()"&gt;Submit&lt;/button&gt;'</span><span class=
"o">+</span>
            <span class="s1">'&lt;div id="res"&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;'</span><span class=
"p">;</span>

             <span class="k">return</span> <span class="p">{</span><span class="nx">html</span><span class=
"o">:</span><span class="nx">html</span><span class="p">};</span>
        <span class="p">},</span>

        <span class="s2">"/showreq.json"</span> <span class="o">:</span> <span class="kd">function</span><span class=
"p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
            <span class="cm">/* convert "body" to text so we can send */</span>
            <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class=
"o">=</span><span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class=
"p">.</span><span class="nx">bufferToString</span><span class="p">(</span><span class="nx">req</span><span class=
"p">.</span><span class="nx">body</span><span class="p">);</span>

            <span class="k">return</span><span class="p">(</span> <span class="p">{</span> <span class=
"nx">json</span><span class="o">:</span> <span class="nx">rampart</span><span class="p">.</span><span class=
"nx">utils</span><span class="p">.</span><span class="nx">sprintf</span><span class="p">(</span><span class=
"s2">"%3J"</span><span class="p">,</span><span class="nx">req</span><span class="p">)</span> <span class=
"p">}</span> <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="cm">/* results might be:</span>
<span class="cm">{</span>
<span class="cm">   "ip": "::1",</span>
<span class="cm">   "port": 46586,</span>
<span class="cm">   "method": "POST",</span>
<span class="cm">   "path": {</span>
<span class="cm">      "file": "showreq.json",</span>
<span class="cm">      "path": "/showreq.json",</span>
<span class="cm">      "base": "/",</span>
<span class="cm">      "scheme": "http://",</span>
<span class="cm">      "host": "localhost:8088",</span>
<span class="cm">      "url": "http://localhost:8088/showreq.json"</span>
<span class="cm">   },</span>
<span class="cm">   "query": {},</span>
<span class="cm">   "body": "{\"first\":\"Joe\",\"last\":\"Public\"}",</span>
<span class="cm">   "query_raw": "",</span>
<span class="cm">   "headers": {</span>
<span class="cm">      "Host": "localhost:8088",</span>
<span class="cm">      "Connection": "keep-alive",</span>
<span class="cm">      "Content-Length": "31",</span>
<span class="cm">      "Content-Type": "application/json",</span>
<span class="cm">      ...,</span>
<span class="cm">   },</span>
<span class="cm">   "postData": {</span>
<span class="cm">      "Content-Type": "application/json",</span>
<span class="cm">      "content": {</span>
<span class="cm">         "first": "Joe",</span>
<span class="cm">         "last": "Public"</span>
<span class="cm">      }</span>
<span class="cm">   },</span>
<span class="cm">   "params": {</span>
<span class="cm">      "first": "Joe",</span>
<span class="cm">      "last": "Public",</span>
<span class="cm">      "Content-Length": "31",</span>
<span class="cm">      "Content-Type": "application/json",</span>
<span class="cm">      "Referer": "http://localhost:8088/post.html",</span>
<span class="cm">      ...,</span>
<span class="cm">   }</span>
<span class="cm">}</span>
<span class="cm">*/</span>
</pre>
                              </div>
                            </div>
                          </div>
                        </blockquote>
                      </div>
                      <div class="section" id="posting-other-types">
                        <h4>
                          Posting Other Types<a class="headerlink" href="#posting-other-types" title=
                          "Permalink to this headline">¶</a>
                        </h4>
                        <blockquote>
                          <div>
                            <p>
                              Posting with a <code class="docutils literal notranslate"><span class=
                              "pre">Content-Type</span></code> other than the three above will return <code class=
                              "docutils literal notranslate"><span class="pre">postData</span></code> with the provided
                              <code class="docutils literal notranslate"><span class="pre">Content-Type</span></code>
                              set, and <code class="docutils literal notranslate"><span class=
                              "pre">contents</span></code> will be the same as the unparsed <span class=
                              "green">Buffer</span> <code class="docutils literal notranslate"><span class=
                              "pre">body</span></code>.
                            </p>
                          </div>
                        </blockquote>
                      </div>
                    </div>
                    <div class="section" id="the-return-object">
                      <h3>
                        The Return Object<a class="headerlink" href="#the-return-object" title=
                        "Permalink to this headline">¶</a>
                      </h3>
                      <blockquote>
                        <div>
                          <p>
                            The return value from a mapped <span class="green">Function</span> contains the contents of
                            the text or data (a <span class="green">String</span> or <span class="green">Buffer</span>)
                            that will be returned to the client. The name of the key (which usually matches the well
                            known file extension) determines the mime-type that is returned. For example: to return an
                            HTML (<code class="docutils literal notranslate"><span class="pre">text/html</span></code>
                            mime type) document to the client, <code class="docutils literal notranslate"><span class=
                            "pre">{</span> <span class="pre">html:</span> <span class=
                            "pre">myhtmlcontent}</span></code> would be specified where the variable <code class=
                            "docutils literal notranslate"><span class="pre">myhtmlcontent</span></code> contains the
                            HTML text to be sent to the client. The name of the key (<code class=
                            "docutils literal notranslate"><span class="pre">html</span></code>) controls which
                            mime-type will be sent to the connecting client. Supported key-names to mime-types are
                            listed <a class="reference internal" href="#key-to-mime-mappings"><span class=
                            "std std-ref">below</span></a>.
                          </p>
                          <p>
                            The return object can optionally contain header parameters to be sent to the client.
                          </p>
                          <div class="highlight-javascript notranslate">
                            <div class="highlight">
                              <pre><span></span><span class="k">return</span> <span class="p">{</span>
   <span class="nx">html</span><span class="o">:</span> <span class="nx">myhtmltext</span><span class="p">,</span>
   <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span> <span class=
"s2">"X-Custom-Header"</span><span class="o">:</span> <span class="s2">"custom value"</span><span class="p">}</span>
<span class="p">}</span>
</pre>
                            </div>
                          </div>
                          <p>
                            To set more than one header with the same name, the value must be an <span class=
                            "green">Array</span>.
                          </p>
                          <div class="highlight-javascript notranslate">
                            <div class="highlight">
                              <pre><span></span><span class="k">return</span> <span class="p">{</span>
   <span class="nx">html</span><span class="o">:</span> <span class="nx">myhtmltext</span><span class="p">,</span>
   <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
       <span class="s2">"X-Custom-Header"</span><span class="o">:</span> <span class=
"s2">"custom value"</span><span class="p">,</span>
       <span class="s2">"Set-Cookie"</span><span class="o">:</span> <span class="p">[</span>
           <span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class=
"p">.</span><span class="nx">sprintf</span><span class="p">(</span><span class=
"s2">"id=%U; Expires=Wed, 15 Oct 2025 10:28:00 GMT"</span><span class="p">,</span> <span class=
"nx">id</span><span class="p">),</span>
           <span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class=
"p">.</span><span class="nx">sprintf</span><span class="p">(</span><span class=
"s2">"session=%U; Max-Age=86400"</span><span class="p">,</span> <span class="nx">session_id</span><span class=
"p">)</span>
       <span class="p">]</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre>
                            </div>
                          </div>
                          <p>
                            A Status Code may also be specified. For example, to redirect a url to a new one:
                          </p>
                          <div class="highlight-javascript notranslate">
                            <div class="highlight">
                              <pre><span></span><span class="kd">var</span> <span class="nx">newurl</span> <span class=
                              "o">=</span> <span class="s2">"https://example.com/myNewLocation.html"</span><span class=
                              "p">;</span>
<span class="k">return</span> <span class="p">{</span>
   <span class="nx">html</span><span class="o">:</span><span class="nx">rampart</span><span class=
"p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">sprintf</span><span class=
"p">(</span>
        <span class="s2">"&lt;html&gt;&lt;body&gt;&lt;h1&gt;302 Moved Temporarily&lt;/h1&gt;"</span><span class=
"o">+</span>
        <span class=
"s1">'&lt;p&gt;Document moved &lt;a href="%s"&gt;here&lt;/a&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;'</span><span class=
"p">,</span>
        <span class="nx">newurl</span>
   <span class="p">),</span>
   <span class="nx">status</span><span class="o">:</span><span class="mi">302</span><span class="p">,</span>
   <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span> <span class=
"s2">"location"</span><span class="o">:</span> <span class="nx">newurl</span><span class="p">}</span>
<span class="p">}</span>
</pre>
                            </div>
                          </div>
                          <p>
                            The specified mime-type can also be overwritten using the <code class=
                            "docutils literal notranslate"><span class="pre">content-type</span></code> header. This
                            way, any arbitrary mime-type can be set regardless of the name of the key (though the name
                            of the key must be a known extension):
                          </p>
                          <div class="highlight-javascript notranslate">
                            <div class="highlight">
                              <pre><span></span><span class="kd">var</span> <span class="nx">jpg</span> <span class=
                              "o">=</span> <span class="nx">rampart</span><span class="p">.</span><span class=
                              "nx">utils</span><span class="p">.</span><span class="nx">readFile</span><span class=
                              "p">(</span><span class="s2">"/path/to/my/jpeg.jpg"</span><span class="p">);</span>
<span class="cm">/* overwrite the bin -&gt; "application/octet-stream" header */</span>
<span class="k">return</span> <span class="p">{</span>
   <span class="nx">bin</span><span class="o">:</span><span class="nx">jpg</span><span class="p">,</span>
   <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span><span class=
"s2">"content-type"</span><span class="o">:</span> <span class="s2">"image/jpeg"</span><span class="p">}</span>
<span class="p">};</span>
</pre>
                            </div>
                          </div>
                          <p>
                            See also <code class="docutils literal notranslate"><span class="pre">mimeMap</span></code>
                            in <a class="reference internal" href="#start">start()</a> above.
                          </p>
                          <p>
                            The content of a file may be sent by returning the file name prepended with an <code class=
                            "docutils literal notranslate"><span class="pre">@</span></code> character.
                          </p>
                          <div class="highlight-javascript notranslate">
                            <div class="highlight">
                              <pre><span></span><span class="k">return</span> <span class="p">{</span>
   <span class="nx">jpg</span><span class="o">:</span> <span class="s2">"@/path/to/my/jpeg.jpg"</span>
<span class="p">};</span>
</pre>
                            </div>
                          </div>
                          <p>
                            This will be more efficient than reading the file and returing its content as shown in the
                            previous example.
                          </p>
                          <p>
                            Note that in order to send a string whose first character is <code class=
                            "docutils literal notranslate"><span class="pre">@</span></code>, it must be escaped.
                          </p>
                          <div class="highlight-javascript notranslate">
                            <div class="highlight">
                              <pre><span></span><span class="k">return</span> <span class="p">{</span>
   <span class="nx">txt</span><span class="o">:</span> <span class="s2">"\\@home is a defunct internet service"</span>
<span class="p">};</span>
</pre>
                            </div>
                          </div>
                          <p>
                            The <code class="docutils literal notranslate"><span class=
                            "pre">compressScripts</span></code> setting in server.<a class="reference internal" href=
                            "#start">start()</a> above can be overridden with the key <code class=
                            "docutils literal notranslate"><span class="pre">compress</span></code>. It may be set to
                            <code class="docutils literal notranslate"><span class=
                            "pre">true</span></code>/<code class="docutils literal notranslate"><span class=
                            "pre">false</span></code> or to a compression level (1-10).
                          </p>
                          <div class="highlight-javascript notranslate">
                            <div class="highlight">
                              <pre><span></span><span class="k">return</span> <span class="p">{</span>
   <span class="nx">html</span><span class="o">:</span> <span class="nx">myhtmltext</span><span class="p">,</span>
   <span class="nx">compress</span><span class="o">:</span> <span class="mi">5</span> <span class=
"c1">// gzip compress output at medium level</span>
<span class="p">}</span>
</pre>
                            </div>
                          </div>
                        </div>
                      </blockquote>
                    </div>
                    <div class="section" id="built-in-directory-function">
                      <h3>
                        Built-in Directory Function<a class="headerlink" href="#built-in-directory-function" title=
                        "Permalink to this headline">¶</a>
                      </h3>
                      <blockquote>
                        <div>
                          <p>
                            If <code class="docutils literal notranslate"><span class="pre">directoryFunc</span></code>
                            in <a class="reference internal" href="#start">start()</a> above is set to <code class=
                            "docutils literal notranslate"><span class="pre">true</span></code>, the following script
                            will be used to return an HTML formatted a directory listing, where an <code class=
                            "docutils literal notranslate"><span class="pre">index.html</span></code> file is not
                            present in the requested directory. It is shown below so that if modifications to the
                            default are desired, it can be used as a starting point for a custom function that can be
                            set using the <code class="docutils literal notranslate"><span class=
                            "pre">directoryFunc</span></code> property.
                          </p>
                          <p>
                            Note that the <code class="docutils literal notranslate"><span class=
                            "pre">req</span></code> variable passed to the function contains an extra property
                            <code class="docutils literal notranslate"><span class="pre">fsPath</span></code>, which is
                            the path on the filesystem being requested.
                          </p>
                          <div class="highlight-javascript notranslate">
                            <div class="highlight">
                              <pre><span></span><span class="kd">function</span> <span class=
                              "nx">dirlist</span><span class="p">(</span><span class="nx">req</span><span class=
                              "p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">html</span><span class="o">=</span><span class=
"s2">"&lt;!DOCTYPE html&gt;\n"</span><span class="o">+</span>
        <span class=
"s1">'&lt;html&gt;&lt;head&gt;&lt;meta charset="UTF-8"&gt;&lt;title&gt;Index of '</span> <span class="o">+</span>
        <span class="nx">req</span><span class="p">.</span><span class="nx">path</span><span class=
"p">.</span><span class="nx">path</span><span class="o">+</span>
        <span class=
"s2">"&lt;/title&gt;&lt;style&gt;td{padding-right:22px;}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;"</span><span class="o">+</span>
        <span class="nx">req</span><span class="p">.</span><span class="nx">path</span><span class=
"p">.</span><span class="nx">path</span><span class="o">+</span>
        <span class="s1">'&lt;/h1&gt;&lt;hr&gt;&lt;table&gt;'</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">hsize</span><span class="p">(</span><span class=
"nx">size</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span><span class="o">=</span><span class=
"nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class=
"nx">sprintf</span><span class="p">(</span><span class="s2">"%d"</span><span class="p">,</span><span class=
"nx">size</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">size</span> <span class=
"o">&gt;=</span> <span class="mi">1073741824</span><span class="p">)</span>
            <span class="nx">ret</span><span class="o">=</span><span class="nx">rampart</span><span class=
"p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">sprintf</span><span class=
"p">(</span><span class="s2">"%.1fG"</span><span class="p">,</span> <span class="nx">size</span><span class=
"o">/</span><span class="mi">1073741824</span><span class="p">);</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class=
"nx">size</span> <span class="o">&gt;=</span> <span class="mi">1048576</span><span class="p">)</span>
            <span class="nx">ret</span><span class="o">=</span><span class="nx">rampart</span><span class=
"p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">sprintf</span><span class=
"p">(</span><span class="s2">"%.1fM"</span><span class="p">,</span> <span class="nx">size</span><span class=
"o">/</span><span class="mi">1048576</span><span class="p">);</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class=
"nx">size</span> <span class="o">&gt;=</span><span class="mi">1024</span><span class="p">)</span>
            <span class="nx">ret</span><span class="o">=</span><span class="nx">rampart</span><span class=
"p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">sprintf</span><span class=
"p">(</span><span class="s2">"%.1fk"</span><span class="p">,</span> <span class="nx">size</span><span class=
"o">/</span><span class="mi">1024</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class=
"nx">path</span><span class="p">.</span><span class="nx">path</span> <span class="o">!=</span> <span class=
"s1">'/'</span><span class="p">)</span>
        <span class="nx">html</span><span class="o">+=</span> <span class=
"s1">'&lt;tr&gt;&lt;td&gt;&lt;a href="../"&gt;Parent Directory&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;-&lt;/td&gt;&lt;/tr&gt;'</span><span class="p">;</span>
    <span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class=
"p">.</span><span class="nx">readdir</span><span class="p">(</span><span class="nx">req</span><span class=
"p">.</span><span class="nx">fsPath</span><span class="p">).</span><span class="nx">sort</span><span class=
"p">().</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class=
"p">(</span><span class="nx">d</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">st</span><span class="o">=</span><span class=
"nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class=
"nx">stat</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class=
"nx">fsPath</span><span class="o">+</span><span class="s1">'/'</span><span class="o">+</span><span class=
"nx">d</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">st</span><span class=
"p">.</span><span class="nx">isDirectory</span><span class="p">())</span>
            <span class="nx">d</span><span class="o">+=</span><span class="s1">'/'</span><span class="p">;</span>
        <span class="nx">html</span><span class="o">=</span><span class="nx">rampart</span><span class=
"p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">sprintf</span><span class=
"p">(</span><span class=
"s1">'%s&lt;tr&gt;&lt;td&gt;&lt;a href="%s"&gt;%s&lt;/a&gt;&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;'</span><span class="p">,</span>
            <span class="nx">html</span><span class="p">,</span> <span class="nx">d</span><span class=
"p">,</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">st</span><span class=
"p">.</span><span class="nx">mtime</span><span class="p">.</span><span class="nx">toLocaleString</span><span class=
"p">()</span> <span class="p">,</span><span class="nx">hsize</span><span class="p">(</span><span class=
"nx">st</span><span class="p">.</span><span class="nx">size</span><span class="p">));</span>
    <span class="p">});</span>

    <span class="nx">html</span><span class="o">+=</span><span class=
"s2">"&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;"</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">{</span><span class="nx">html</span><span class=
"o">:</span><span class="nx">html</span><span class="p">};</span>
<span class="p">}</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span>
    <span class="p">...,</span>
    <span class="nx">directoryFunc</span><span class="o">:</span> <span class="nx">dirlist</span>
<span class="p">});</span>
</pre>
                            </div>
                          </div>
                        </div>
                      </blockquote>
                    </div>
                    <div class="section" id="advanced-functions">
                      <h3>
                        Advanced Functions<a class="headerlink" href="#advanced-functions" title=
                        "Permalink to this headline">¶</a>
                      </h3>
                      <p>
                        The <code class="docutils literal notranslate"><span class="pre">rampart-server</span></code>
                        module creates a buffer to efficiently store data that will be returned to the client by the
                        webserver. There is one buffer per thread and it is used from within each thread.
                      </p>
                      <p>
                        The request object contains the functions to manipulate and print to the server buffer, which
                        will be directly sent to the client without extra copying.
                      </p>
                      <div class="section" id="req-printf">
                        <h4>
                          req.printf()<a class="headerlink" href="#req-printf" title="Permalink to this headline">¶</a>
                        </h4>
                        <p>
                          The request object to a callback function includes the <code class=
                          "docutils literal notranslate"><span class="pre">printf</span></code> function which will
                          print directly to the server buffer that will be sent to the client. It uses the same formats
                          as <a class="reference internal" href="rampart-utils.html#printf"><span class=
                          "std std-ref">rampart.utils.printf</span></a>. The advantages of using <code class=
                          "docutils literal notranslate"><span class="pre">req.printf</span></code> rather than
                          returning a string is that content is not copied, but instead placed directly in the server
                          buffer to be returned to the client.
                        </p>
                        <p>
                          Example from a normal server callback function:
                        </p>
                        <div class="highlight-javascript notranslate">
                          <div class="highlight">
                            <pre><span></span><span class="kd">function</span> <span class=
                            "nx">mycallback</span><span class="p">(</span><span class="nx">req</span><span class=
                            "p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">html</span><span class="p">;</span>
    <span class="p">...</span> <span class="nx">add</span> <span class="nx">content</span> <span class=
"nx">to</span> <span class="nx">html</span> <span class="p">...</span>
    <span class="k">return</span> <span class="p">{</span><span class="nx">html</span><span class=
"o">:</span> <span class="nx">html</span><span class="p">};</span>
<span class="p">}</span>
</pre>
                          </div>
                        </div>
                        <p>
                          Example using <code class="docutils literal notranslate"><span class=
                          "pre">req.printf</span></code> from a server callback function:
                        </p>
                        <div class="highlight-javascript notranslate">
                          <div class="highlight">
                            <pre><span></span><span class="kd">function</span> <span class=
                            "nx">mycallback</span><span class="p">(</span><span class="nx">req</span><span class=
                            "p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">content</span><span class="o">=</span><span class=
"s2">"&lt;html&gt;&lt;body&gt;"</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">end_cont</span> <span class="o">=</span> <span class=
"s2">"&lt;/body&gt;&lt;/html&gt;"</span><span class="p">;</span>
    <span class="c1">// add more html to content variable ...</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">printf</span><span class=
"p">(</span><span class="s2">"%s"</span><span class="p">,</span> <span class="nx">content</span><span class=
"p">);</span>
    <span class="k">return</span> <span class="p">{</span><span class="nx">html</span><span class=
"o">:</span> <span class="nx">end_cont</span><span class="p">};</span>
<span class="p">}</span>
</pre>
                          </div>
                        </div>
                        <dl>
                          <dt>
                            Return Value:
                          </dt>
                          <dd>
                            <p>
                              The number of bytes written to the server buffer.
                            </p>
                          </dd>
                          <dt>
                            Note:
                          </dt>
                          <dd>
                            <p>
                              If <code class="docutils literal notranslate"><span class="pre">content</span></code> is
                              large, it is more efficiently handled using <code class=
                              "docutils literal notranslate"><span class="pre">req.printf</span></code> and/or
                              <code class="docutils literal notranslate"><span class="pre">req.put</span></code> below
                              than concatenating strings in JavaScript.
                            </p>
                            <p>
                              The one exception to this is if <code class="docutils literal notranslate"><span class=
                              "pre">content</span></code> is a <span class="green">Buffer</span> and is the total
                              content to be returned to the client without concatenation or manipulation, doing
                              <code class="docutils literal notranslate"><span class="pre">return</span> <span class=
                              "pre">{html:content}</span></code> is the most efficient method.
                            </p>
                            <p>
                              However, in nearly all cases, if a function needs to print many strings that make up the
                              totality of the data sent to the client, using <code class=
                              "docutils literal notranslate"><span class="pre">req.printf</span></code> or <code class=
                              "docutils literal notranslate"><span class="pre">req.put</span></code> is preferable.
                            </p>
                          </dd>
                        </dl>
                      </div>
                      <div class="section" id="req-put">
                        <h4>
                          req.put()<a class="headerlink" href="#req-put" title="Permalink to this headline">¶</a>
                        </h4>
                        <p>
                          Put a <span class="green">String</span> or a <span class="green">Buffer</span> into the
                          server buffer to be returned to the client.
                        </p>
                        <p>
                          Example:
                        </p>
                        <div class="highlight-javascript notranslate">
                          <div class="highlight">
                            <pre><span></span><span class="kd">function</span> <span class=
                            "nx">mycallback</span><span class="p">(</span><span class="nx">req</span><span class=
                            "p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">content</span><span class="o">=</span><span class=
"s2">"&lt;html&gt;&lt;body&gt;"</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">end_cont</span> <span class="o">=</span> <span class=
"s2">"&lt;/body&gt;&lt;/html&gt;"</span><span class="p">;</span>
    <span class="c1">// add more html to content variable ...</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class=
"nx">content</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">{</span><span class="nx">html</span><span class=
"o">:</span> <span class="nx">end_cont</span><span class="p">};</span>
<span class="p">}</span>
</pre>
                          </div>
                        </div>
                        <dl class="simple">
                          <dt>
                            Return Value:
                          </dt>
                          <dd>
                            <p>
                              The number of bytes written to the server buffer.
                            </p>
                          </dd>
                        </dl>
                      </div>
                      <div class="section" id="req-getpos">
                        <h4>
                          req.getpos()<a class="headerlink" href="#req-getpos" title="Permalink to this headline">¶</a>
                        </h4>
                        <p>
                          Get the current end position in the server buffer.
                        </p>
                        <dl class="simple">
                          <dt>
                            Return Value
                          </dt>
                          <dd>
                            <p>
                              A <span class="green">Number</span> - the end position of the server buffer.
                            </p>
                          </dd>
                        </dl>
                      </div>
                      <div class="section" id="req-rewind">
                        <h4>
                          req.rewind()<a class="headerlink" href="#req-rewind" title="Permalink to this headline">¶</a>
                        </h4>
                        <p>
                          Rewind the current end position of the server buffer.
                        </p>
                        <p>
                          Usage:
                        </p>
                        <div class="highlight-javascript notranslate">
                          <div class="highlight">
                            <pre><span></span><span class="kd">function</span> <span class=
                            "nx">mycallback</span><span class="p">(</span><span class="nx">req</span><span class=
                            "p">)</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class=
"nx">req</span><span class="p">.</span><span class="nx">rewind</span><span class="p">(</span><span class=
"nx">pos</span><span class="p">);</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre>
                          </div>
                        </div>
                        <p>
                          Where <code class="docutils literal notranslate"><span class="pre">pos</span></code> is the
                          offset to position the end pointer in the server buffer.
                        </p>
                        <p>
                          Note: <code class="docutils literal notranslate"><span class="pre">pos</span></code> must be
                          equal or less than the current end position as reported by <a class="reference internal"
                          href="#req-getpos">req.getpos()</a>.
                        </p>
                        <dl class="simple">
                          <dt>
                            Return Value
                          </dt>
                          <dd>
                            <p>
                              <code class="docutils literal notranslate"><span class="pre">undefined</span></code>.
                            </p>
                          </dd>
                        </dl>
                      </div>
                      <div class="section" id="req-getbuffer">
                        <h4>
                          req.getBuffer()<a class="headerlink" href="#req-getbuffer" title=
                          "Permalink to this headline">¶</a>
                        </h4>
                        <p>
                          Get a copy of the contents of the server buffer and return it in a JavaScript buffer.
                        </p>
                        <dl class="simple">
                          <dt>
                            Return Value:
                          </dt>
                          <dd>
                            <p>
                              A <span class="green">Buffer</span> - the contents of the server buffer.
                            </p>
                          </dd>
                        </dl>
                      </div>
                    </div>
                    <div class="section" id="full-server-example">
                      <h3>
                        Full Server Example<a class="headerlink" href="#full-server-example" title=
                        "Permalink to this headline">¶</a>
                      </h3>
                      <p>
                        Below is a full example:
                      </p>
                      <div class="highlight-javascript notranslate">
                        <div class="highlight">
                          <pre><span></span><span class="kd">var</span> <span class="nx">pid</span><span class=
                          "o">=</span><span class="nx">server</span><span class="p">.</span><span class=
                          "nx">start</span><span class="p">(</span>
<span class="p">{</span>
    <span class="cm">/* bind: string|[array,of,strings]</span>
<span class="cm">       default: [ "[::1]:8088", "127.0.0.1:8088" ]</span>
<span class="cm">        ipv6 format: [2001:db8::1111:2222]:80</span>
<span class="cm">        ipv4 format: 127.0.0.1:80</span>
<span class="cm">        spaces are ignored (i.e. " [ 2001:db8::1111:2222 ] : 80" is ok)</span>
<span class="cm">    */</span>
    <span class="cm">/* bind to all */</span>
    <span class="nx">bind</span><span class="o">:</span> <span class="p">[</span> <span class=
"s2">"[::]:8088"</span><span class="p">,</span> <span class="s2">"0.0.0.0:8088"</span> <span class="p">],</span>

    <span class="cm">/* if started as root, set user here.</span>
<span class="cm">       If not root, option "user" is ignored. */</span>
    <span class="nx">user</span><span class="o">:</span> <span class="s2">"nobody"</span><span class="p">,</span>

    <span class="cm">/* max time to spend in scripts */</span>
    <span class="nx">scriptTimeout</span><span class="o">:</span> <span class="mf">10.0</span><span class="p">,</span>

    <span class="cm">/* how long to wait before client sends</span>
<span class="cm">       a req or server can send a response */</span>
    <span class="nx">connectTimeout</span><span class="o">:</span><span class="mf">20.0</span><span class="p">,</span>

    <span class="cm">/*** logging ***/</span>
    <span class="nx">log</span><span class="o">:</span> <span class="kc">true</span><span class=
"p">,</span>           <span class="c1">//turn logging on, by default goes to stdout/stderr</span>
    <span class="nx">accessLog</span><span class="o">:</span> <span class="s2">"./access.log"</span><span class=
"p">,</span>    <span class="c1">//access log location, instead of stdout. Can be set if daemon==true</span>
    <span class="nx">errorLog</span><span class="o">:</span> <span class="s2">"./error.log"</span><span class=
"p">,</span>     <span class="c1">//error log location, instead of stderr. Can be set if daemon==true</span>

    <span class="cm">/*  fork and return pid server start (see end of the script) */</span>
    <span class="nx">daemon</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>

    <span class="cm">/* make server singe-threaded. */</span>
    <span class="c1">//useThreads: false,</span>

    <span class="cm">/*  By default, number of threads is set to cpu core count.</span>
<span class="cm">        "threads" has no effect unless useThreads is set true.</span>
<span class="cm">        The number can be changed here:</span>
<span class="cm">    */</span>
    <span class="c1">//threads: 8, /* for a 4 core, 8 virtual core hyper-threaded processor. */</span>

    <span class="cm">/*</span>
<span class="cm">        for https support, these three are the minimum number of options needed:</span>
<span class="cm">    */</span>
    <span class="nx">secure</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span>
    <span class="nx">sslKeyFile</span><span class="o">:</span>  <span class=
"s2">"/etc/letsencrypt/live/mydom.com/privkey.pem"</span><span class="p">,</span>
    <span class="nx">sslCertFile</span><span class="o">:</span> <span class=
"s2">"/etc/letsencrypt/live/mydom.com/fullchain.pem"</span><span class="p">,</span>

    <span class="cm">/* sslMinVersion (ssl3|tls1|tls1.1|tls1.2). "tls1.2" is default*/</span>
    <span class="nx">sslMinVersion</span><span class="o">:</span> <span class="s2">"tls1.2"</span><span class=
"p">,</span>

    <span class="cm">/* a custom 404 page */</span>
    <span class="nx">notFoundFunc</span><span class="o">:</span> <span class="kd">function</span><span class=
"p">(</span><span class="nx">req</span><span class="p">){</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="nx">status</span><span class="o">:</span><span class="mi">404</span><span class="p">,</span>
            <span class="nx">html</span><span class="o">:</span> <span class=
"s1">'&lt;html&gt;&lt;head&gt;&lt;title&gt;404 Not Found&lt;/title&gt;&lt;/head&gt;'</span><span class="o">+</span>
                  <span class="s1">'&lt;body style="background: url(/img/page-background.png);"&gt;'</span><span class=
"o">+</span>
                  <span class=
"s1">'&lt;center&gt;&lt;h1&gt;Not Found&lt;/h1&gt;&lt;p&gt;The requested URL '</span><span class="o">+</span>
                    <span class="nx">req</span><span class="p">.</span><span class="nx">path</span><span class=
"p">.</span><span class="nx">path</span><span class="o">+</span>
                  <span class="s1">' was not found on this server.&lt;/p&gt;'</span><span class="o">+</span>
                  <span class="s1">'&lt;/center&gt;&lt;/body&gt;&lt;/html&gt;'</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="cm">/* if a function is given, directoryFunc will be called each time a url</span>
<span class="cm">        which corresponds to a directory is called if there is no index.htm(l)</span>
<span class="cm">        present in the directory.  Added to the normal request object</span>
<span class="cm">        will be the property (string) "fsPath" (req.fsPath), which can be used</span>
<span class="cm">        to create a directory listing.  See function dirlist() above.</span>
<span class="cm">        It is substantially equivelant to the built-in server.defaultDirList function.</span>

<span class="cm">        If directoryFunc is not set, a url pointing to a directory without an index.htm(l)</span>
<span class="cm">        will return a 403 Forbidden error.</span>
<span class="cm">    */</span>

    <span class="nx">directoryFunc</span><span class="o">:</span> <span class="kc">true</span><span class=
"p">,</span> <span class="c1">//use default directory list function</span>

            <span class="cm">/* remap a few extensions -&gt; mimetypes */</span>
    <span class="nx">mimeMap</span><span class="o">:</span> <span class="p">{</span>
              <span class="s2">"m4v"</span><span class="o">:</span> <span class="s2">"video/mp4"</span><span class=
"p">,</span>
              <span class="s2">"mov"</span><span class="o">:</span> <span class="s2">"video/mp4"</span>
    <span class="p">},</span>

    <span class="cm">/* **********************************************************</span>
<span class="cm">       map urls to functions or paths on the filesystem</span>
<span class="cm">       If it ends in a '/' then matches everything in that path</span>
<span class="cm">       except a more specific ('/something.html') path</span>

<span class="cm">       priority is given to Exact Paths (Begins with '/' and no '*' in path), then</span>
<span class="cm">         regular expressions, then globs.</span>

<span class="cm">       If mapSort: false, then in each of these groups</span>
<span class="cm">         is left unsorted.</span>
<span class="cm">       Otherwise, within these groups, they are then ordered by length,</span>
<span class="cm">         with longest having priority.</span>

<span class="cm">       If you wish to specify your own priority, set:</span>

<span class="cm">    mapSort: false,</span>

<span class="cm">       and then put them in your prefered order below.</span>
<span class="cm">       ********************************************************** */</span>
    <span class="nx">map</span><span class="o">:</span>
    <span class="p">{</span>
        <span class="s2">"/helloWorld.html"</span> <span class="o">:</span> <span class=
"kd">function</span><span class="p">(){</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="nx">html</span><span class="o">:</span><span class=
"s2">"&lt;pre&gt;Hello World!&lt;/pre&gt;"</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="cm">/* directory for scripts */</span>
        <span class="s2">"/scripts/"</span><span class="o">:</span> <span class="p">{</span> <span class=
"s2">"modulePath"</span> <span class="o">:</span> <span class="s2">"/var/www/scripts"</span> <span class="p">}</span>

        <span class="cm">/* static content */</span>
        <span class="s2">"/"</span> <span class="o">:</span> <span class="s2">"/var/www/html"</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class=
"s2">"server started with pid: "</span><span class="o">+</span><span class="nx">pid</span><span class="p">);</span>
</pre>
                        </div>
                      </div>
                    </div>
                    <div class="section" id="chunking-replies">
                      <h3>
                        Chunking Replies<a class="headerlink" href="#chunking-replies" title=
                        "Permalink to this headline">¶</a>
                      </h3>
                      <div class="section" id="the-basics">
                        <h4>
                          The Basics<a class="headerlink" href="#the-basics" title="Permalink to this headline">¶</a>
                        </h4>
                        <p>
                          The server can also send back content with <code class=
                          "docutils literal notranslate"><span class="pre">Transfer-Encoding:</span> <span class=
                          "pre">Chunked</span></code>. This allows the server to assemble a response in sections and
                          write back to the client one section at a time. The client web browser will reassemble the
                          document as it is being sent. This is useful, in particular when sending a large file, or
                          when sending an <a class="reference external" href=
                          "https://en.wikipedia.org/wiki/Motion_JPEG">mjpeg</a>.
                        </p>
                        <p>
                          For a large file, sending in chunks allows the current server thread to service other
                          requests in between each sent chunk.
                        </p>
                        <p>
                          For mjpegs, it allow a continuous stream of JPEGs to be sent, also allowing for other
                          requests to be serviced between each frame.
                        </p>
                        <p>
                          A chunked document is specified by setting <code class=
                          "docutils literal notranslate"><span class="pre">chunk:true</span></code> in <a class=
                          "reference internal" href="#the-return-object">The Return Object</a>. A delay between chunks
                          can be set in milliseconds with the following: <code class=
                          "docutils literal notranslate"><span class="pre">chunkDelay:delay_in_ms</span></code>. This
                          delay works in the same manner as <a class="reference internal" href=
                          "rampart-main.html#setmetronome"><span class="std std-ref">setMetronome()</span></a>.
                        </p>
                        <p>
                          In addition, the extension/mime property of <a class="reference internal" href=
                          "#the-return-object">The Return Object</a> may be a <span class="green">Function</span>
                          (<cite>The Chunk Callback</cite>), which will be called for every chunk to be written.
                        </p>
                        <p>
                          Example Callback Return Object:
                        </p>
                        <div class="highlight-javascript notranslate">
                          <div class="highlight">
                            <pre><span></span><span class="kd">function</span> <span class=
                            "nx">send_mp4_chunk</span><span class="p">(</span><span class="nx">req</span><span class=
                            "p">)</span>
<span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">mycallback</span><span class="p">(</span><span class=
"nx">req</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="nx">chunk</span><span class="o">:</span>      <span class="kc">true</span>
        <span class="nx">chunkDelay</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="nx">mp4</span><span class="o">:</span>        <span class="nx">send_mp4</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
                          </div>
                        </div>
                      </div>
                      <div class="section" id="req-chunksend">
                        <h4>
                          req.chunkSend()<a class="headerlink" href="#req-chunksend" title=
                          "Permalink to this headline">¶</a>
                        </h4>
                        <p>
                          The <code class="docutils literal notranslate"><span class=
                          "pre">req.chunkSend()</span></code> function is available only from within <cite>The Chunk
                          Callback</cite> and is used to send a chunk to the client.
                        </p>
                        <p>
                          Usage:
                        </p>
                        <div class="highlight-javascript notranslate">
                          <div class="highlight">
                            <pre><span></span><span class="nx">req</span><span class="p">.</span><span class=
                            "nx">chunkSend</span><span class="p">(</span><span class="nx">data</span><span class=
                            "p">);</span>
</pre>
                          </div>
                        </div>
                        <p>
                          Where <code class="docutils literal notranslate"><span class="pre">data</span></code> is a
                          <span class="green">String</span>, <span class="green">Buffer</span> (or optionally a
                          <span class="green">Number</span>, <span class="green">Boolean</span> or <span class=
                          "green">Object</span>, in which case it is converted to a <span class="green">String</span>)
                          - The data to send back to the client.
                        </p>
                        <p>
                          A string starting with <cite>@</cite> is used to send the contents of the file specified (see
                          <a class="reference internal" href="#the-return-object">The Return Object</a> for details).
                        </p>
                        <p>
                          In addition <code class="docutils literal notranslate"><span class="pre">data</span></code>
                          may be <code class="docutils literal notranslate"><span class="pre">null</span></code> or
                          <code class="docutils literal notranslate"><span class="pre">undefined</span></code>, in
                          which case, any data in the server buffer (e.g., when using <cite>req.printf()</cite> or
                          <cite>req.put()</cite> above) will be sent to the client. Note that the server buffer is
                          reset between invocations of <cite>The Chunk Callback</cite>.
                        </p>
                      </div>
                      <div class="section" id="req-chunkend">
                        <h4>
                          req.chunkEnd()<a class="headerlink" href="#req-chunkend" title=
                          "Permalink to this headline">¶</a>
                        </h4>
                        <p>
                          The <code class="docutils literal notranslate"><span class="pre">req.chunkEnd()</span></code>
                          function is available only from within <cite>The Chunk Callback</cite> and is used to
                          terminate the file being sent and the repetition of the callback.
                        </p>
                        <p>
                          Usage:
                        </p>
                        <div class="highlight-javascript notranslate">
                          <div class="highlight">
                            <pre><span></span><span class="nx">req</span><span class="p">.</span><span class=
                            "nx">chunkEnd</span><span class="p">([</span><span class="nx">data</span><span class=
                            "p">]);</span>
</pre>
                          </div>
                        </div>
                        <p>
                          Where <code class="docutils literal notranslate"><span class="pre">data</span></code> is
                          optionally a final chunk of data to send (same as in chunkSend).
                        </p>
                      </div>
                      <div class="section" id="req-chunkindex">
                        <h4>
                          req.chunkIndex<a class="headerlink" href="#req-chunkindex" title=
                          "Permalink to this headline">¶</a>
                        </h4>
                        <p>
                          The <code class="docutils literal notranslate"><span class="pre">req.chunkIndex</span></code>
                          variable is available only from within <cite>The Chunk Callback</cite> and is set to the
                          current 0 based chunk index.
                        </p>
                      </div>
                      <div class="section" id="chunking-examples">
                        <h4>
                          Chunking Examples<a class="headerlink" href="#chunking-examples" title=
                          "Permalink to this headline">¶</a>
                        </h4>
                        <p>
                          Sending a large file in chunks:
                        </p>
                        <div class="highlight-javascript notranslate">
                          <div class="highlight">
                            <pre><span></span><span class="kd">var</span> <span class="nx">server</span><span class=
                            "o">=</span><span class="nx">require</span><span class="p">(</span><span class=
                            "s2">"rampart-server"</span><span class="p">);</span>
<span class="nx">rampart</span><span class="p">.</span><span class="nx">globalize</span><span class=
"p">(</span><span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class=
"p">);</span>

<span class="kd">function</span> <span class="nx">sendchunk</span><span class="p">(</span><span class=
"nx">req</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">chunk</span> <span class="o">=</span> <span class=
"nx">readFile</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class=
"nx">file</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class=
"nx">chunkIndex</span> <span class="o">*</span> <span class="nx">req</span><span class="p">.</span><span class=
"nx">chunkSize</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class=
"nx">chunkSize</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class=
"nx">stat</span><span class="p">.</span><span class="nx">size</span> <span class="o">&gt;</span> <span class=
"p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">chunkIndex</span><span class=
"o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class=
"nx">req</span><span class="p">.</span><span class="nx">chunkSize</span><span class="p">)</span>
        <span class="nx">req</span><span class="p">.</span><span class="nx">chunkSend</span><span class=
"p">(</span><span class="nx">chunk</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="nx">req</span><span class="p">.</span><span class="nx">chunkEnd</span><span class=
"p">(</span><span class="nx">chunk</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">sendfile</span><span class="p">(</span><span class=
"nx">req</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">req</span><span class="p">.</span><span class="nx">chunkSize</span> <span class=
"o">=</span> <span class="mi">4096</span><span class="p">;</span> <span class=
"c1">//for convenience and available in sendchunk above</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">file</span><span class="o">=</span><span class=
"s2">"/path/to/myfile.mp4"</span><span class="p">;</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">stat</span><span class=
"o">=</span> <span class="nx">stat</span><span class="p">(</span><span class="nx">req</span><span class=
"p">.</span><span class="nx">file</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">"mp4"</span><span class="o">:</span> <span class="nx">sendchunk</span><span class="p">,</span>
        <span class="nx">chunk</span><span class="o">:</span>  <span class="kc">true</span><span class="p">,</span>
        <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
            <span class="s1">'Content-Disposition'</span><span class="o">:</span> <span class=
"s1">'attachment; filename="myfile.mp4"'</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="cm">/****** START SERVER *******/</span>
<span class="nx">printf</span><span class="p">(</span><span class=
"s2">"Starting https server\nmp4 is at http://localhost:8088/myfile.mp4\n\n"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">serverpid</span><span class="o">=</span><span class=
"nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span>
<span class="p">{</span>
    <span class="nx">map</span><span class="o">:</span>
    <span class="p">{</span>
        <span class="s2">"/"</span><span class="o">:</span>            <span class="kd">function</span><span class=
"p">(</span><span class="nx">req</span><span class="p">){</span>
                            <span class="k">return</span> <span class="p">{</span>
                                <span class="nx">status</span><span class="o">:</span><span class=
"mi">302</span><span class="p">,</span>
                                <span class="nx">headers</span><span class="o">:</span><span class=
"p">{</span><span class="nx">location</span><span class="o">:</span><span class="s1">'/myfile.mp4'</span><span class=
"p">}</span>
                            <span class="p">}</span>
                        <span class="p">},</span>
        <span class="s2">"/myfile.mp4"</span><span class="o">:</span>  <span class="nx">sendfile</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre>
                          </div>
                        </div>
                        <p>
                          Sending mjpeg, simple:
                        </p>
                        <div class="highlight-javascript notranslate">
                          <div class="highlight">
                            <pre><span></span><span class="kd">var</span> <span class="nx">server</span><span class=
                            "o">=</span><span class="nx">require</span><span class="p">(</span><span class=
                            "s2">"rampart-server"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">curl</span> <span class="o">=</span> <span class=
"nx">require</span><span class="p">(</span><span class="s2">"rampart-curl"</span><span class="p">);</span>
<span class="nx">rampart</span><span class="p">.</span><span class="nx">globalize</span><span class=
"p">(</span><span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class=
"p">);</span>

<span class="kd">function</span> <span class="nx">sendpic</span><span class="p">(</span><span class=
"nx">req</span><span class="p">){</span>

    <span class="nx">msg</span><span class="o">=</span><span class="nx">curl</span><span class="p">.</span><span class=
"nx">fetch</span><span class="p">(</span><span class="s1">'https://jpg.nyctmc.org/5'</span><span class=
"p">,{</span><span class="nx">insecure</span><span class="o">:</span><span class="kc">true</span><span class=
"p">});</span>

    <span class="nx">req</span><span class="p">.</span><span class="nx">chunkSend</span><span class="p">(</span>
        <span class="nx">sprintf</span><span class="p">(</span><span class=
"s2">"--myboundary\r\nContent-Type: image/jpeg\r\nContent-Length: %d\r\n\r\n%s"</span><span class="p">,</span>
            <span class="nx">msg</span><span class="p">.</span><span class="nx">body</span><span class=
"p">.</span><span class="nx">length</span><span class="p">,</span><span class="nx">msg</span><span class=
"p">.</span><span class="nx">body</span><span class="p">)</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* we don't need a chunk delay, the fetch takes a bit of time. */</span>
<span class="kd">function</span> <span class="nx">mjpeg</span><span class="p">(</span><span class=
"nx">req</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">"data"</span><span class=
"o">:</span><span class="nx">sendpic</span><span class="p">,</span> <span class="nx">chunk</span><span class=
"o">:</span><span class="kc">true</span><span class="p">,</span> <span class="nx">headers</span><span class=
"o">:</span>
        <span class="p">{</span><span class="s2">"Content-Type"</span><span class="o">:</span> <span class=
"s2">"multipart/x-mixed-replace;boundary=myboundary"</span><span class="p">}</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="cm">/****** START SERVER *******/</span>
<span class="nx">printf</span><span class="p">(</span><span class=
"s2">"Starting https server\nmjpeg is at http://localhost:8088/mjpeg.jpg\n\n"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">serverpid</span><span class="o">=</span><span class=
"nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span>
<span class="p">{</span>
    <span class="nx">map</span><span class="o">:</span>
    <span class="p">{</span>
        <span class="s2">"/"</span><span class="o">:</span>  <span class="kd">function</span><span class=
"p">(</span><span class="nx">req</span><span class="p">){</span>
                    <span class="k">return</span> <span class="p">{</span>
                        <span class="nx">status</span><span class="o">:</span><span class="mi">302</span><span class=
"p">,</span>
                        <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
                            <span class="nx">location</span><span class="o">:</span><span class=
"s1">'/mjpeg.jpg'</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
              <span class="p">},</span>
        <span class="s2">"/mjpeg.jpg"</span><span class="o">:</span> <span class="nx">mjpeg</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre>
                          </div>
                        </div>
                        <p>
                          Sending mjpeg, using ffmpeg and a webcam on Linux:
                        </p>
                        <div class="highlight-javascript notranslate">
                          <div class="highlight">
                            <pre><span></span><span class="kd">var</span> <span class="nx">server</span><span class=
                            "o">=</span><span class="nx">require</span><span class="p">(</span><span class=
                            "s2">"rampart-server"</span><span class="p">);</span>
<span class="nx">rampart</span><span class="p">.</span><span class="nx">globalize</span><span class=
"p">(</span><span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class=
"p">);</span>


<span class="kd">function</span> <span class="nx">sendpic_wcam</span><span class="p">(</span><span class=
"nx">req</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">file</span><span class="p">;</span>

    <span class="c1">//skip the first callback if first jpeg is not ready.</span>
    <span class="k">try</span> <span class="p">{</span> <span class="nx">file</span> <span class=
"o">=</span> <span class="nx">trim</span><span class="p">(</span><span class="nx">readFile</span><span class=
"p">(</span><span class="s2">"test.list"</span><span class="p">,</span><span class="mi">0</span> <span class=
"p">,</span><span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class=
"p">));</span> <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class=
"nx">e</span><span class="p">){}</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">req</span><span class="p">.</span><span class="nx">printf</span><span class=
"p">(</span><span class="s2">"--myboundary\r\nContent-Type: image/jpeg\r\n\r\n"</span><span class=
"p">);</span> <span class="c1">//write header</span>
        <span class="nx">req</span><span class="p">.</span><span class="nx">chunkSend</span><span class=
"p">(</span><span class="s1">'@'</span><span class="o">+</span><span class="nx">file</span><span class=
"p">);</span> <span class="c1">//send jpeg directly from file</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="kd">function</span> <span class="nx">start_ffmpeg</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">pid</span><span class="o">=</span><span class=
"mi">0</span><span class="p">;</span>
    <span class="k">try</span><span class="p">{</span>
        <span class="nx">pid</span><span class="o">=</span><span class="nb">parseInt</span><span class=
"p">(</span><span class="nx">readFile</span><span class="p">(</span><span class="s2">"./ffmpeg.pid"</span><span class=
"p">));</span>
    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class=
"p">){}</span>

    <span class="k">if</span><span class="p">(</span> <span class="nx">pid</span> <span class=
"o">&amp;&</span> <span class="nx">kill</span><span class="p">(</span><span class="nx">pid</span><span class=
"p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">return</span><span class="p">;</span> <span class="c1">//it's running</span>

    <span class="cm">/* save video from webcam at 10 fps*/</span>
    <span class="nx">ret</span> <span class="o">=</span> <span class="nx">exec</span><span class="p">(</span>
        <span class="s2">"ffmpeg"</span><span class="p">,</span> <span class="p">{</span><span class=
"nx">background</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span>
        <span class="s1">'-hide_banner'</span><span class="p">,</span>
        <span class="s1">'-loglevel'</span><span class="p">,</span>           <span class=
"s1">'error'</span><span class="p">,</span>
        <span class="s1">'-f'</span><span class="p">,</span>                  <span class=
"s1">'video4linux2'</span><span class="p">,</span>
        <span class="s1">'-i'</span><span class="p">,</span>                  <span class=
"s1">'/dev/video0'</span><span class="p">,</span>
        <span class="s1">'-vf'</span><span class="p">,</span>                 <span class=
"s1">'fps=10'</span><span class="p">,</span>
        <span class="s1">'-q:v'</span><span class="p">,</span>                <span class="s1">'8'</span><span class=
"p">,</span>
        <span class="s1">'-f'</span><span class="p">,</span>                  <span class=
"s1">'segment'</span><span class="p">,</span>
        <span class="s1">'-segment_time'</span><span class="p">,</span>       <span class=
"s1">'0.0001'</span><span class="p">,</span>
        <span class="s1">'-segment_format'</span><span class="p">,</span>     <span class=
"s1">'singlejpeg'</span><span class="p">,</span>
        <span class="s1">'-segment_wrap'</span><span class="p">,</span>       <span class="s1">'4'</span><span class=
"p">,</span>
        <span class="s1">'-segment_list'</span><span class="p">,</span>       <span class=
"s1">'test.list'</span><span class="p">,</span>
        <span class="s1">'-segment_list_size'</span><span class="p">,</span>  <span class="s1">'1'</span><span class=
"p">,</span>
        <span class="s1">'test%02d.jpg'</span><span class="p">,</span>
        <span class="s1">'-y'</span>
    <span class="p">);</span>
    <span class="nx">fprintf</span><span class="p">(</span><span class="s2">"./ffmpeg.pid"</span><span class=
"p">,</span> <span class="s2">"%d"</span><span class="p">,</span> <span class="nx">ret</span><span class=
"p">.</span><span class="nx">pid</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">mjpeg</span><span class="p">(</span><span class=
"nx">req</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">start_ffmpeg</span><span class="p">();</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">"data"</span><span class=
"o">:</span><span class="nx">sendpic_wcam</span><span class="p">,</span> <span class="nx">chunk</span><span class=
"o">:</span><span class="kc">true</span><span class="p">,</span> <span class="nx">chunkDelay</span><span class=
"o">:</span> <span class="mi">100</span><span class="p">,</span> <span class="nx">headers</span><span class=
"o">:</span>
        <span class="p">{</span><span class="s2">"Content-Type"</span><span class="o">:</span> <span class=
"s2">"multipart/x-mixed-replace;boundary=myboundary"</span><span class="p">}</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="cm">/****** START SERVER *******/</span>
<span class="nx">printf</span><span class="p">(</span><span class=
"s2">"Starting https server\nmjpeg is at http://localhost:8088/mjpeg.jpg\n\n"</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">serverpid</span><span class="o">=</span><span class=
"nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span>
<span class="p">{</span>
    <span class="nx">user</span><span class="o">:</span><span class="s1">'nobody'</span><span class="p">,</span>
    <span class="nx">map</span><span class="o">:</span>
    <span class="p">{</span>
        <span class="s2">"/"</span><span class="o">:</span>  <span class="kd">function</span><span class=
"p">(</span><span class="nx">req</span><span class="p">){</span>
                    <span class="k">return</span> <span class="p">{</span>
                        <span class="nx">status</span><span class="o">:</span><span class="mi">302</span><span class=
"p">,</span>
                        <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
                            <span class="nx">location</span><span class="o">:</span><span class=
"s1">'/mjpeg.jpg'</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
              <span class="p">},</span>
        <span class="s2">"/mjpeg.jpg"</span><span class="o">:</span> <span class="nx">mjpeg</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="section" id="websockets">
                      <h3>
                        Websockets<a class="headerlink" href="#websockets" title="Permalink to this headline">¶</a>
                      </h3>
                      <p>
                        The server also serves websocket connections. The server callback function for a websocket
                        connection operates much the same as a normal http callback, with a few exceptions:
                      </p>
                      <ul class="simple">
                        <li>
                          <p>
                            A websocket callback is specified by prepending the path in the <code class=
                            "docutils literal notranslate"><span class="pre">map</span></code> object with <code class=
                            "docutils literal notranslate"><span class="pre">ws:</span></code>. See <a class=
                            "reference internal" href="#mapped-functions">Mapped Functions</a> above.
                          </p>
                        </li>
                        <li>
                          <p>
                            The mapped callback is run every time the client sends data over the websocket.
                          </p>
                        </li>
                        <li>
                          <p>
                            Headers and any GET/POST variables are set once in the <code class=
                            "docutils literal notranslate"><span class="pre">req</span></code> object and are provided
                            in the callback when the client first connects. Subsequent callbacks are supplied with the
                            same <code class="docutils literal notranslate"><span class="pre">req</span></code> object
                            every time new data from the client is received.
                          </p>
                        </li>
                        <li>
                          <p>
                            Replies to the connected client may be returned asynchronously using <a class=
                            "reference internal" href="rampart-main.html#rampart-event"><span class=
                            "std std-ref">rampart.event</span></a> functions or <a class="reference internal" href=
                            "rampart-main.html#settimeout"><span class="std std-ref">setTimeout</span></a>.
                          </p>
                        </li>
                        <li>
                          <p>
                            The <code class="docutils literal notranslate"><span class="pre">req.wsSend()</span></code>
                            function is used to send replies at any time, and as many times as desired. In addition,
                            returning a value from the callback performs the same function as <code class=
                            "docutils literal notranslate"><span class="pre">req.wsSend()</span></code>.
                          </p>
                        </li>
                        <li>
                          <p>
                            Since the <code class="docutils literal notranslate"><span class="pre">req</span></code>
                            object is recycled, variables may be attached to it that will be available on subsequent
                            callbacks. Example: setting <code class="docutils literal notranslate"><span class=
                            "pre">req.userName=getUserName()</span></code> would allow the return value from the
                            hypothetical <code class="docutils literal notranslate"><span class=
                            "pre">getUserName</span></code> function to be accessed on subsequent calls.
                          </p>
                        </li>
                        <li>
                          <p>
                            <code class="docutils literal notranslate"><span class="pre">req.body</span></code> is
                            empty upon first connecting. In subsequent calls of the callback function, <code class=
                            "docutils literal notranslate"><span class="pre">req.body</span></code> contains the text
                            or binary data sent by the client.
                          </p>
                        </li>
                        <li>
                          <p>
                            When returning from the callback function, the value <code class=
                            "docutils literal notranslate"><span class="pre">undefined</span></code> or <code class=
                            "docutils literal notranslate"><span class="pre">null</span></code> can be specified, if
                            the callback has no data to send, or if the data has been stored in the server buffer using
                            <code class="docutils literal notranslate"><span class="pre">req.printf</span></code> or
                            <code class="docutils literal notranslate"><span class="pre">req.put</span></code> above.
                            Data is sent by returning the values in the same format that is used in <code class=
                            "docutils literal notranslate"><span class="pre">req.wsSend</span></code> below.
                          </p>
                        </li>
                      </ul>
                      <p>
                        In addition to the above, several variables and functions are available only when using
                        websockets:
                      </p>
                      <div class="section" id="req-wssend-data">
                        <h4>
                          req.wsSend(data)<a class="headerlink" href="#req-wssend-data" title=
                          "Permalink to this headline">¶</a>
                        </h4>
                        <p>
                          Send data to the client. How it is sent depends on the type of <code class=
                          "docutils literal notranslate"><span class="pre">data</span></code> being sent (the type of
                          the variable given to wsSend as a parameter):
                        </p>
                        <blockquote>
                          <div>
                            <ul class="simple">
                              <li>
                                <p>
                                  <span class="green">String</span> - The string is sent as text.
                                </p>
                              </li>
                              <li>
                                <p>
                                  <span class="green">Object</span> - The object is converted to JSON and send as a
                                  string.
                                </p>
                              </li>
                              <li>
                                <p>
                                  <span class="green">Buffer</span> - The object is send as binary data.
                                </p>
                              </li>
                            </ul>
                          </div>
                        </blockquote>
                        <p>
                          In addition to sending the data given as a parameter to <code class=
                          "docutils literal notranslate"><span class="pre">req.wsSend()</span></code>, any data which
                          was added via <code class="docutils literal notranslate"><span class=
                          "pre">req.printf</span></code> or <code class="docutils literal notranslate"><span class=
                          "pre">req.put</span></code> is prepended to the outgoing data.
                        </p>
                        <p>
                          If all the necessary data has been stored in the server buffer using <code class=
                          "docutils literal notranslate"><span class="pre">req.printf</span></code> or <code class=
                          "docutils literal notranslate"><span class="pre">req.put</span></code>, that data can be sent
                          to the client by calling <code class="docutils literal notranslate"><span class=
                          "pre">req.wsSend(null)</span></code>.
                        </p>
                      </div>
                      <div class="section" id="req-wsend-immediate">
                        <h4>
                          req.wsEnd([immediate])<a class="headerlink" href="#req-wsend-immediate" title=
                          "Permalink to this headline">¶</a>
                        </h4>
                        <p>
                          Close the websocket connection. By default <code class=
                          "docutils literal notranslate"><span class="pre">wsEnd()</span></code> closes the connection
                          after pending messages have been written. The optional <code class=
                          "docutils literal notranslate"><span class="pre">immediate</span></code> is a <span class=
                          "green">Boolean</span>. If <code class="docutils literal notranslate"><span class=
                          "pre">true</span></code> the connection will be closed immediately regardless of whether any
                          pending data (such as messages sent with <code class=
                          "docutils literal notranslate"><span class="pre">req.wsSend()</span></code>) have been
                          flushed to the client.
                        </p>
                      </div>
                      <div class="section" id="req-wsondisconnect-func">
                        <h4>
                          req.wsOnDisconnect(func)<a class="headerlink" href="#req-wsondisconnect-func" title=
                          "Permalink to this headline">¶</a>
                        </h4>
                        <p>
                          Takes a <span class="green">Function</span> as its sole parameter, which is a function to run
                          when either the client disconnects or req.wsEnd() is called.
                        </p>
                      </div>
                      <div class="section" id="req-wsisbin">
                        <h4>
                          req.wsIsBin<a class="headerlink" href="#req-wsisbin" title="Permalink to this headline">¶</a>
                        </h4>
                        <p>
                          This variable is set <code class="docutils literal notranslate"><span class=
                          "pre">true</span></code> when the incoming data in <code class=
                          "docutils literal notranslate"><span class="pre">req.body</span></code> is sent from the
                          client as binary data. Otherwise this is <code class=
                          "docutils literal notranslate"><span class="pre">false</span></code>.
                        </p>
                      </div>
                      <div class="section" id="req-count">
                        <h4>
                          req.count<a class="headerlink" href="#req-count" title="Permalink to this headline">¶</a>
                        </h4>
                        <p>
                          This variable is set to the number of times the client has sent data. On first run of the
                          callback, it is set to <code class="docutils literal notranslate"><span class=
                          "pre">0</span></code> and is incremented on each subsequent callback.
                        </p>
                      </div>
                      <div class="section" id="req-websocketid">
                        <h4>
                          req.websocketId<a class="headerlink" href="#req-websocketid" title=
                          "Permalink to this headline">¶</a>
                        </h4>
                        <p>
                          This variable is set to a unique number which may be used to identify the connection to the
                          client.
                        </p>
                      </div>
                      <div class="section" id="example-echo-chat-server">
                        <h4>
                          Example echo/chat server<a class="headerlink" href="#example-echo-chat-server" title=
                          "Permalink to this headline">¶</a>
                        </h4>
                        <p>
                          Below is a simplified version of an echo/chat server using websockets and <a class=
                          "reference internal" href="rampart-main.html#rampart-event"><span class=
                          "std std-ref">rampart.event</span></a> functions.
                        </p>
                        <div class="highlight-javascript notranslate">
                          <div class="highlight">
                            <pre><span></span><span class="cm">/* load the http server module */</span>
<span class="kd">var</span> <span class="nx">server</span><span class="o">=</span><span class=
"nx">require</span><span class="p">(</span><span class="s2">"rampart-server"</span><span class="p">);</span>

<span class="cm">/* this function just returns html */</span>
<span class="kd">function</span> <span class="nx">frontpage</span><span class="p">(</span><span class=
"nx">req</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span><span class="nx">html</span><span class="o">:</span>
    <span class="sb">`&lt;html&gt;&lt;body&gt;</span>
<span class="sb">        &lt;div id="chatbox"&gt;&lt;/div&gt;</span>
<span class="sb">        &lt;input id="chatin" type=text style="width:50%"&gt;</span>
<span class="sb">        &lt;button id="send"&gt;send&lt;/button&gt;</span>
<span class="sb">        &lt;script&gt;</span>
<span class="sb">            var chatbox = document.getElementById('chatbox');</span>
<span class="sb">            var chatin = document.getElementById('chatin');</span>
<span class="sb">            var send = document.getElementById('send');</span>
<span class="sb">            var socket = new WebSocket("ws://localhost:8088/ws");</span>

<span class="sb">            function showmsg(msg){</span>
<span class="sb">                var node = document.createElement('p');</span>
<span class="sb">                var textnode = document.createTextNode(msg.data);</span>
<span class="sb">                node.appendChild(textnode);</span>
<span class="sb">                chatbox.appendChild(node);</span>
<span class="sb">            }</span>

<span class="sb">            socket.addEventListener('open', function(e){</span>
<span class="sb">                socket.onmessage = showmsg;</span>
<span class="sb">            });</span>

<span class="sb">            send.onclick = function(){</span>
<span class="sb">                if(socket.readyState === socket.OPEN) {</span>
<span class="sb">                    socket.send(chatin.value);</span>
<span class="sb">                    chatin.value="";</span>
<span class="sb">                }</span>
<span class="sb">            };</span>

<span class="sb">        &lt;/script&gt;</span>
<span class="sb">    &lt;/body&gt;&lt;/html&gt;`</span><span class="p">};</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">ws_handler</span><span class="p">(</span><span class=
"nx">req</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/* the setup upon first connecting */</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class=
"nx">count</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="cm">/* make a name for our event callback function</span>
<span class="cm">           which is unique for this connection and that we can</span>
<span class="cm">           use to insert and remove the event callback         */</span>
        <span class="kd">var</span> <span class="nx">func_name</span> <span class="o">=</span> <span class=
"s2">"myfunc_"</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class=
"nx">websocketId</span><span class="p">;</span>

        <span class="cm">/* what to do if client disconnects */</span>
        <span class="nx">req</span><span class="p">.</span><span class="nx">wsOnDisconnect</span><span class=
"p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="c1">//remove our event callback function */</span>
            <span class="nx">rampart</span><span class="p">.</span><span class="nx">event</span><span class=
"p">.</span><span class="nx">off</span><span class="p">(</span><span class="s2">"myev"</span><span class=
"p">,</span> <span class="nx">func_name</span><span class="p">);</span>
            <span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class=
"p">.</span><span class="nx">printf</span><span class="p">(</span><span class=
"s2">"disconnected...\n"</span><span class="p">);</span>
        <span class="p">});</span>

        <span class="cm">/* insert the callback */</span>
        <span class="nx">rampart</span><span class="p">.</span><span class="nx">event</span><span class=
"p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"myev"</span><span class=
"p">,</span> <span class="nx">func_name</span><span class="p">,</span> <span class="kd">function</span><span class=
"p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// only send if from someone else</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class=
"p">.</span><span class="nx">id</span> <span class="o">!=</span> <span class="nx">req</span><span class=
"p">.</span><span class="nx">websocketId</span><span class="p">)</span>
                <span class="nx">req</span><span class="p">.</span><span class="nx">wsSend</span><span class=
"p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">msg</span><span class="p">);</span>
        <span class="p">},</span> <span class="nx">req</span><span class="p">);</span>

        <span class="cm">/* first connect message */</span>
        <span class="k">return</span> <span class="s2">"Greetings, I'm an example echo/chat server"</span><span class=
"p">;</span>
    <span class="p">}</span>

    <span class="cm">/* second and subsequent runs of this callback start here: */</span>

    <span class="c1">//convert body from a buffer to a string</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">body</span> <span class=
"o">=</span> <span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class=
"p">.</span><span class="nx">bufferToString</span><span class="p">(</span><span class="nx">req</span><span class=
"p">.</span><span class="nx">body</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class=
"nx">body</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="cm">/* send message to any other client that is connected */</span>
        <span class="nx">rampart</span><span class="p">.</span><span class="nx">event</span><span class=
"p">.</span><span class="nx">trigger</span><span class="p">(</span>
            <span class="s2">"myev"</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="nx">id</span><span class="o">:</span> <span class="nx">req</span><span class=
"p">.</span><span class="nx">websocketId</span><span class="p">,</span>
                <span class="nx">msg</span><span class="o">:</span> <span class=
"s2">"a message from "</span><span class="o">+</span><span class="nx">req</span><span class="p">.</span><span class=
"nx">websocketId</span> <span class="o">+</span> <span class="s2">": "</span> <span class="o">+</span> <span class=
"nx">req</span><span class="p">.</span><span class="nx">body</span>
            <span class="p">}</span>
        <span class="p">);</span>

        <span class="cm">/* echo message to this client */</span>
        <span class="k">return</span> <span class="nx">req</span><span class="p">.</span><span class=
"nx">body</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">//do nothing if we get to here.</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">pid</span><span class="o">=</span><span class=
"nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span>
<span class="p">{</span>
    <span class="nx">map</span><span class="o">:</span>
    <span class="p">{</span>
        <span class="s2">"/"</span> <span class="o">:</span> <span class="nx">frontpage</span><span class="p">,</span>
        <span class="s2">"ws:/ws"</span><span class="o">:</span> <span class="nx">ws_handler</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">rampart</span><span class="p">.</span><span class="nx">utils</span><span class=
"p">.</span><span class="nx">printf</span><span class="p">(</span><span class=
"s2">"\nWebchat is available here:\nhttp://127.0.0.1:8088/\n"</span><span class="p">);</span>
</pre>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="section" id="technical-notes">
                    <h2>
                      Technical Notes<a class="headerlink" href="#technical-notes" title=
                      "Permalink to this headline">¶</a>
                    </h2>
                    <p>
                      A rampart server script is broken into 3 stages:
                    </p>
                    <div class="highlight-javascript notranslate">
                      <div class="highlight">
                        <pre><span></span><span class="nx">begin</span> <span class="nx">code</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">()</span>

<span class="nx">end</span> <span class="k">of</span> <span class="nx">script</span>
</pre>
                      </div>
                    </div>
                    <p>
                      At “begin code”, code is run in the main thread. Global functions and variables declared here
                      will be copied to server threads when the server starts.
                    </p>
                    <p>
                      At “server.start” new threads are created, each beginning its own event loop.
                    </p>
                    <p>
                      At “end of script” the main thread’s event loop starts and “server.start” is initialized from
                      within the main thread’s event loop. The main thread accepts requests and forwards them to the
                      least busy server thread.
                    </p>
                    <p>
                      Server.start creates the configured number of threads (as specified or equal to the number of cpu
                      cores on the system). Upon creation several things happen:
                    </p>
                    <blockquote>
                      <div>
                        <ul class="simple">
                          <li>
                            <p>
                              Two JavaScript contexts are created for each thread. One for HTTP requests and one for
                              websockets conversations.
                            </p>
                          </li>
                          <li>
                            <p>
                              Each JavaScript context is a separate JavaScript interpreter. In general, no data is
                              shared between them.
                            </p>
                          </li>
                          <li>
                            <p>
                              An event loop is created for each thread.
                            </p>
                          </li>
                          <li>
                            <p>
                              Global variables and functions from “begin code” are copied from the main thread’s
                              Duktape context to all the Duktape thread contexts. Local variables are lost.
                            </p>
                          </li>
                          <li>
                            <p>
                              The main thread listens for HTTP connections in its event loop and assigns them to the
                              least busy server thread’s event loops.
                            </p>
                          </li>
                          <li>
                            <p>
                              The thread event loops accept the http connections and pass the http request data to the
                              appropriate Duktape context for that thread. That context runs the matching callback and
                              returns data which is passed on to the client.
                            </p>
                          </li>
                          <li>
                            <p>
                              Each thread may be handling http requests and multiple websocket connections at the same
                              time from within its event loop.
                            </p>
                          </li>
                          <li>
                            <p>
                              The Duktape context for http requests may be destroyed and recreated upon timeout. In
                              contrast, the websocket Duktape context will always persist.
                            </p>
                          </li>
                          <li>
                            <p>
                              Any events or setTimeouts set from within server callbacks are run within that thread’s
                              event loop. Events and setTimeouts run outside the server (in “begin code” or before “end
                              of script”) are run in the main event loop. Certain event data is stored in the main
                              thread so events can be triggered regardless on which thread they reside.
                            </p>
                          </li>
                          <li>
                            <p>
                              HTTP requests which have a timeout are run from a new thread which can be interrupted. If
                              the timeout is reached before the callback function finishes, the thread is canceled and
                              the threads Duktape context is destroyed and recreated in order to serve the next
                              request.
                            </p>
                          </li>
                          <li>
                            <p>
                              Since websockets do not timeout, destroying their contexts would interrupt its
                              conversation with the client. So a second, separate context per thread which will never
                              be destroyed is used for websockets.
                            </p>
                          </li>
                        </ul>
                      </div>
                    </blockquote>
                    <p>
                      Modules vs Global callback functions:
                    </p>
                    <blockquote>
                      <div>
                        <ul class="simple">
                          <li>
                            <p>
                              a server callback function may be called from a function defined in the main script or by
                              loading a module.
                            </p>
                          </li>
                          <li>
                            <p>
                              Global functions and variables are set once when the server script is first loaded and
                              cannot be changed without restarting the server.
                            </p>
                          </li>
                          <li>
                            <p>
                              Modules are loaded in each thread and are checked upon each execution. If the source
                              script of a module is changed while the server is running, it is reloaded.
                            </p>
                          </li>
                        </ul>
                      </div>
                    </blockquote>
                    <p>
                      Return values from server callback function.
                    </p>
                    <blockquote>
                      <div>
                        <ul class="simple">
                          <li>
                            <p>
                              Strings are copied from Duktape to the buffer that will be returned to the client.
                            </p>
                          </li>
                          <li>
                            <p>
                              Wherever possible, buffers are passed by reference without copy to be returned to the
                              client.
                            </p>
                          </li>
                          <li>
                            <p>
                              req.put and req.printf data is copied to a buffer which will be passed by reference to
                              the client.
                            </p>
                          </li>
                        </ul>
                      </div>
                    </blockquote>
                  </div>
                  <div class="section" id="key-to-mime-mappings">
                    <h2>
                      Key to Mime Mappings<a class="headerlink" href="#key-to-mime-mappings" title=
                      "Permalink to this headline">¶</a>
                    </h2>
                    <p>
                      Key/extension to mime-type mappings are shown below. They apply to both the return value of
                      <a class="reference internal" href="#mapped-functions">Mapped Functions</a> as well as the
                      extension of files served from <a class="reference internal" href="#mapped-directories">Mapped
                      Directories</a>. This list of defaults can be appended or modified using the <code class=
                      "docutils literal notranslate"><span class="pre">mimeMap</span></code> property in the
                      <span class="green">Object</span> passed to <a class="reference internal" href=
                      "#start">start()</a> .
                    </p>
                    <p>
                      An example: If the variable <code class="docutils literal notranslate"><span class=
                      "pre">jpg</span></code> is set (e.g. <code class="docutils literal notranslate"><span class=
                      "pre">var</span> <span class="pre">jpg</span> <span class="pre">=</span> <span class=
                      "pre">rampart.utils.readFile("/path/to/my/jpeg.jpg");</span></code>), then <code class=
                      "docutils literal notranslate"><span class="pre">return</span> <span class=
                      "pre">{jpeg:jpg};</span></code> at the end of a mapped function would send the contents of the
                      file <code class="docutils literal notranslate"><span class=
                      "pre">/path/to/my/jpeg.jpg</span></code> with the mime-type <code class=
                      "docutils literal notranslate"><span class="pre">image/jpeg</span></code> to the client. The same
                      applies to files served from the filesystem which end in <code class=
                      "docutils literal notranslate"><span class="pre">.jpeg</span></code> or <code class=
                      "docutils literal notranslate"><span class="pre">.jpg</span></code>.
                    </p>
                    <div class="highlight-default notranslate">
                      <div class="highlight">
                        <pre><span></span><span class="s2">"3dm"</span>       <span class=
                        "o">-&gt;</span>      <span class="s2">"x-world/x-3dmf"</span>
<span class="s2">"3dmf"</span>      <span class="o">-&gt;</span>      <span class="s2">"x-world/x-3dmf"</span>
<span class="s2">"3gp"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/3gpp"</span>
<span class="s2">"3gpp"</span>      <span class="o">-&gt;</span>      <span class="s2">"video/3gpp"</span>
<span class="s2">"7z"</span>        <span class="o">-&gt;</span>      <span class=
"s2">"application/x-7z-compressed"</span>
<span class="s2">"a"</span>         <span class="o">-&gt;</span>      <span class=
"s2">"application/octet-stream"</span>
<span class="s2">"aab"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-authorware-bin"</span>
<span class="s2">"aam"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-authorware-map"</span>
<span class="s2">"aas"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-authorware-seg"</span>
<span class="s2">"abc"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/vnd.abc"</span>
<span class="s2">"acgi"</span>      <span class="o">-&gt;</span>      <span class="s2">"text/html"</span>
<span class="s2">"afl"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/animaflex"</span>
<span class="s2">"ai"</span>        <span class="o">-&gt;</span>      <span class="s2">"application/postscript"</span>
<span class="s2">"aif"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/aiff"</span>
<span class="s2">"aifc"</span>      <span class="o">-&gt;</span>      <span class="s2">"audio/aiff"</span>
<span class="s2">"aiff"</span>      <span class="o">-&gt;</span>      <span class="s2">"audio/aiff"</span>
<span class="s2">"aim"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-aim"</span>
<span class="s2">"aip"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/x-audiosoft-intra"</span>
<span class="s2">"ani"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-navi-animation"</span>
<span class="s2">"aos"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-nokia-9000-communicator-add-on-software"</span>
<span class="s2">"aps"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/mime"</span>
<span class="s2">"arc"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/octet-stream"</span>
<span class="s2">"arj"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/arj"</span>
<span class="s2">"art"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/x-jg"</span>
<span class="s2">"asf"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/x-ms-asf"</span>
<span class="s2">"asm"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/x-asm"</span>
<span class="s2">"asp"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/asp"</span>
<span class="s2">"asx"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/x-ms-asf"</span>
<span class="s2">"atom"</span>      <span class="o">-&gt;</span>      <span class="s2">"application/atom+xml"</span>
<span class="s2">"au"</span>        <span class="o">-&gt;</span>      <span class="s2">"audio/x-au"</span>
<span class="s2">"avi"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/x-msvideo"</span>
<span class="s2">"avs"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/avs-video"</span>
<span class="s2">"bcpio"</span>     <span class="o">-&gt;</span>      <span class="s2">"application/x-bcpio"</span>
<span class="s2">"bin"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/octet-stream"</span>
<span class="s2">"bm"</span>        <span class="o">-&gt;</span>      <span class="s2">"image/bmp"</span>
<span class="s2">"bmp"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/x-ms-bmp"</span>
<span class="s2">"boo"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/book"</span>
<span class="s2">"book"</span>      <span class="o">-&gt;</span>      <span class="s2">"application/book"</span>
<span class="s2">"boz"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-bzip2"</span>
<span class="s2">"bsh"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-bsh"</span>
<span class="s2">"bz"</span>        <span class="o">-&gt;</span>      <span class="s2">"application/x-bzip"</span>
<span class="s2">"bz2"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-bzip2"</span>
<span class="s2">"c"</span>         <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"c++"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"cat"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.ms-pki.seccat"</span>
<span class="s2">"cc"</span>        <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"ccad"</span>      <span class="o">-&gt;</span>      <span class="s2">"application/clariscad"</span>
<span class="s2">"cco"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-cocoa"</span>
<span class="s2">"cdf"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-cdf"</span>
<span class="s2">"cer"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-x509-ca-cert"</span>
<span class="s2">"cha"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-chat"</span>
<span class="s2">"chat"</span>      <span class="o">-&gt;</span>      <span class="s2">"application/x-chat"</span>
<span class="s2">"class"</span>     <span class="o">-&gt;</span>      <span class=
"s2">"application/x-java-class"</span>
<span class="s2">"com"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/octet-stream"</span>
<span class="s2">"conf"</span>      <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"cpio"</span>      <span class="o">-&gt;</span>      <span class="s2">"application/x-cpio"</span>
<span class="s2">"cpp"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/x-c"</span>
<span class="s2">"cpt"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-cpt"</span>
<span class="s2">"crl"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/pkix-crl"</span>
<span class="s2">"crt"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-x509-ca-cert"</span>
<span class="s2">"csh"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/x-script.csh"</span>
<span class="s2">"css"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/css"</span>
<span class="s2">"cxx"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"data"</span>      <span class="o">-&gt;</span>      <span class=
"s2">"application/octet-stream"</span>
<span class="s2">"dcr"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-director"</span>
<span class="s2">"deb"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/octet-stream"</span>
<span class="s2">"deepv"</span>     <span class="o">-&gt;</span>      <span class="s2">"application/x-deepv"</span>
<span class="s2">"def"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"der"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-x509-ca-cert"</span>
<span class="s2">"dif"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/x-dv"</span>
<span class="s2">"dir"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-director"</span>
<span class="s2">"dl"</span>        <span class="o">-&gt;</span>      <span class="s2">"video/x-dl"</span>
<span class="s2">"dll"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/octet-stream"</span>
<span class="s2">"dmg"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/octet-stream"</span>
<span class="s2">"doc"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/msword"</span>
<span class="s2">"docx"</span>      <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.openxmlformats-officedocument.wordprocessingml.document"</span>
<span class="s2">"dot"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/msword"</span>
<span class="s2">"dp"</span>        <span class="o">-&gt;</span>      <span class=
"s2">"application/commonground"</span>
<span class="s2">"drw"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/drafting"</span>
<span class="s2">"dump"</span>      <span class="o">-&gt;</span>      <span class=
"s2">"application/octet-stream"</span>
<span class="s2">"dv"</span>        <span class="o">-&gt;</span>      <span class="s2">"video/x-dv"</span>
<span class="s2">"dvi"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-dvi"</span>
<span class="s2">"dwf"</span>       <span class="o">-&gt;</span>      <span class="s2">"model/vnd.dwf"</span>
<span class="s2">"dwg"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/x-dwg"</span>
<span class="s2">"dxf"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/x-dwg"</span>
<span class="s2">"dxr"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-director"</span>
<span class="s2">"ear"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/java-archive"</span>
<span class="s2">"el"</span>        <span class="o">-&gt;</span>      <span class="s2">"text/x-script.elisp"</span>
<span class="s2">"elc"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-elc"</span>
<span class="s2">"env"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-envoy"</span>
<span class="s2">"eot"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.ms-fontobject"</span>
<span class="s2">"eps"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/postscript"</span>
<span class="s2">"es"</span>        <span class="o">-&gt;</span>      <span class="s2">"application/x-esrehber"</span>
<span class="s2">"etx"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/x-setext"</span>
<span class="s2">"evy"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-envoy"</span>
<span class="s2">"exe"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/octet-stream"</span>
<span class="s2">"f"</span>         <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"f77"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"f90"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"fdf"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/vnd.fdf"</span>
<span class="s2">"fif"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/fif"</span>
<span class="s2">"fli"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/x-fli"</span>
<span class="s2">"flo"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/florian"</span>
<span class="s2">"flv"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/x-flv"</span>
<span class="s2">"flx"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/vnd.fmi.flexstor"</span>
<span class="s2">"fmf"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"video/x-atomic3d-feature"</span>
<span class="s2">"for"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"fpx"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/vnd.fpx"</span>
<span class="s2">"frl"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/freeloader"</span>
<span class="s2">"funk"</span>      <span class="o">-&gt;</span>      <span class="s2">"audio/make"</span>
<span class="s2">"g"</span>         <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"g3"</span>        <span class="o">-&gt;</span>      <span class="s2">"image/g3fax"</span>
<span class="s2">"gif"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/gif"</span>
<span class="s2">"gl"</span>        <span class="o">-&gt;</span>      <span class="s2">"video/x-gl"</span>
<span class="s2">"gsd"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/x-gsm"</span>
<span class="s2">"gsm"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/x-gsm"</span>
<span class="s2">"gsp"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-gsp"</span>
<span class="s2">"gss"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-gss"</span>
<span class="s2">"gtar"</span>      <span class="o">-&gt;</span>      <span class="s2">"application/x-gtar"</span>
<span class="s2">"gz"</span>        <span class="o">-&gt;</span>      <span class="s2">"application/x-gzip"</span>
<span class="s2">"gzip"</span>      <span class="o">-&gt;</span>      <span class="s2">"application/x-gzip"</span>
<span class="s2">"h"</span>         <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"hdf"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-hdf"</span>
<span class="s2">"help"</span>      <span class="o">-&gt;</span>      <span class="s2">"application/x-helpfile"</span>
<span class="s2">"hgl"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/vnd.hp-hpgl"</span>
<span class="s2">"hh"</span>        <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"hlb"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/x-script"</span>
<span class="s2">"hlp"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-helpfile"</span>
<span class="s2">"hpg"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/vnd.hp-hpgl"</span>
<span class="s2">"hpgl"</span>      <span class="o">-&gt;</span>      <span class="s2">"application/vnd.hp-hpgl"</span>
<span class="s2">"hqx"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/mac-binhex40"</span>
<span class="s2">"hta"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/hta"</span>
<span class="s2">"htc"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/x-component"</span>
<span class="s2">"htm"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/html"</span>
<span class="s2">"html"</span>      <span class="o">-&gt;</span>      <span class="s2">"text/html"</span>
<span class="s2">"htmls"</span>     <span class="o">-&gt;</span>      <span class="s2">"text/html"</span>
<span class="s2">"htt"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/webviewhtml"</span>
<span class="s2">"htx"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/html"</span>
<span class="s2">"ice"</span>       <span class="o">-&gt;</span>      <span class="s2">"x-conference/x-cooltalk"</span>
<span class="s2">"ico"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/x-icon"</span>
<span class="s2">"idc"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"ief"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/ief"</span>
<span class="s2">"iefs"</span>      <span class="o">-&gt;</span>      <span class="s2">"image/ief"</span>
<span class="s2">"iges"</span>      <span class="o">-&gt;</span>      <span class="s2">"application/iges"</span>
<span class="s2">"igs"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/iges"</span>
<span class="s2">"ima"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-ima"</span>
<span class="s2">"imap"</span>      <span class="o">-&gt;</span>      <span class=
"s2">"application/x-httpd-imap"</span>
<span class="s2">"img"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/octet-stream"</span>
<span class="s2">"inf"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/inf"</span>
<span class="s2">"ins"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-internett-signup"</span>
<span class="s2">"ip"</span>        <span class="o">-&gt;</span>      <span class="s2">"application/x-ip2"</span>
<span class="s2">"iso"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/octet-stream"</span>
<span class="s2">"isu"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/x-isvideo"</span>
<span class="s2">"it"</span>        <span class="o">-&gt;</span>      <span class="s2">"audio/it"</span>
<span class="s2">"iv"</span>        <span class="o">-&gt;</span>      <span class="s2">"application/x-inventor"</span>
<span class="s2">"ivr"</span>       <span class="o">-&gt;</span>      <span class="s2">"i-world/i-vrml"</span>
<span class="s2">"ivy"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-livescreen"</span>
<span class="s2">"jad"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"text/vnd.sun.j2me.app-descriptor"</span>
<span class="s2">"jam"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/x-jam"</span>
<span class="s2">"jar"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/java-archive"</span>
<span class="s2">"jardiff"</span>   <span class="o">-&gt;</span>      <span class=
"s2">"application/x-java-archive-diff"</span>
<span class="s2">"jav"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"java"</span>      <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"jcm"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-java-commerce"</span>
<span class="s2">"jfif"</span>      <span class="o">-&gt;</span>      <span class="s2">"image/jpeg"</span>
<span class="s2">"jfif-tbnl"</span> <span class="o">-&gt;</span>      <span class="s2">"image/jpeg"</span>
<span class="s2">"jng"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/x-jng"</span>
<span class="s2">"jnlp"</span>      <span class="o">-&gt;</span>      <span class=
"s2">"application/x-java-jnlp-file"</span>
<span class="s2">"jpe"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/jpeg"</span>
<span class="s2">"jpeg"</span>      <span class="o">-&gt;</span>      <span class="s2">"image/jpeg"</span>
<span class="s2">"jpg"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/jpeg"</span>
<span class="s2">"jps"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/x-jps"</span>
<span class="s2">"js"</span>        <span class="o">-&gt;</span>      <span class="s2">"application/javascript"</span>
<span class="s2">"json"</span>      <span class="o">-&gt;</span>      <span class="s2">"application/json"</span>
<span class="s2">"jut"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/jutvision"</span>
<span class="s2">"kar"</span>       <span class="o">-&gt;</span>      <span class="s2">"music/x-karaoke"</span>
<span class="s2">"kml"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.google-earth.kml+xml"</span>
<span class="s2">"kmz"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.google-earth.kmz"</span>
<span class="s2">"ksh"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-ksh"</span>
<span class="s2">"la"</span>        <span class="o">-&gt;</span>      <span class="s2">"audio/x-nspaudio"</span>
<span class="s2">"lam"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/x-liveaudio"</span>
<span class="s2">"latex"</span>     <span class="o">-&gt;</span>      <span class="s2">"application/x-latex"</span>
<span class="s2">"lha"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-lha"</span>
<span class="s2">"lhx"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/octet-stream"</span>
<span class="s2">"list"</span>      <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"lma"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/nspaudio"</span>
<span class="s2">"log"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"lst"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"lsx"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/x-la-asf"</span>
<span class="s2">"ltx"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-latex"</span>
<span class="s2">"lzh"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-lzh"</span>
<span class="s2">"lzx"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-lzx"</span>
<span class="s2">"m"</span>         <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"m1v"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/mpeg"</span>
<span class="s2">"m2a"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/mpeg"</span>
<span class="s2">"m2v"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/mpeg"</span>
<span class="s2">"m3u"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/x-mpequrl"</span>
<span class="s2">"m3u8"</span>      <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.apple.mpegurl"</span>
<span class="s2">"m4a"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/x-m4a"</span>
<span class="s2">"m4v"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/x-m4v"</span>
<span class="s2">"man"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-troff-man"</span>
<span class="s2">"map"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-navimap"</span>
<span class="s2">"mar"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"mbd"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/mbedlet"</span>
<span class="s2">"mc$"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-magic-cap-package-1.0"</span>
<span class="s2">"mcd"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-mathcad"</span>
<span class="s2">"mcf"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/mcf"</span>
<span class="s2">"mcp"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/netmc"</span>
<span class="s2">"me"</span>        <span class="o">-&gt;</span>      <span class="s2">"application/x-troff-me"</span>
<span class="s2">"mht"</span>       <span class="o">-&gt;</span>      <span class="s2">"message/rfc822"</span>
<span class="s2">"mhtml"</span>     <span class="o">-&gt;</span>      <span class="s2">"message/rfc822"</span>
<span class="s2">"mid"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/midi"</span>
<span class="s2">"midi"</span>      <span class="o">-&gt;</span>      <span class="s2">"audio/midi"</span>
<span class="s2">"mif"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-frame"</span>
<span class="s2">"mime"</span>      <span class="o">-&gt;</span>      <span class="s2">"message/rfc822"</span>
<span class="s2">"mjf"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"audio/x-vnd.audioexplosion.mjuicemediafile"</span>
<span class="s2">"mjpg"</span>      <span class="o">-&gt;</span>      <span class="s2">"video/x-motion-jpeg"</span>
<span class="s2">"mm"</span>        <span class="o">-&gt;</span>      <span class="s2">"application/x-meme"</span>
<span class="s2">"mme"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/base64"</span>
<span class="s2">"mml"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/mathml"</span>
<span class="s2">"mng"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/x-mng"</span>
<span class="s2">"mod"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/x-mod"</span>
<span class="s2">"moov"</span>      <span class="o">-&gt;</span>      <span class="s2">"video/quicktime"</span>
<span class="s2">"mov"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/quicktime"</span>
<span class="s2">"movie"</span>     <span class="o">-&gt;</span>      <span class="s2">"video/x-sgi-movie"</span>
<span class="s2">"mp2"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/mpeg"</span>
<span class="s2">"mp3"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/mpeg"</span>
<span class="s2">"mp4"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/mp4"</span>
<span class="s2">"mpa"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/mpeg"</span>
<span class="s2">"mpc"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-project"</span>
<span class="s2">"mpe"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/mpeg"</span>
<span class="s2">"mpeg"</span>      <span class="o">-&gt;</span>      <span class="s2">"video/mpeg"</span>
<span class="s2">"mpg"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/mpeg"</span>
<span class="s2">"mpga"</span>      <span class="o">-&gt;</span>      <span class="s2">"audio/mpeg"</span>
<span class="s2">"mpp"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.ms-project"</span>
<span class="s2">"mpt"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-project"</span>
<span class="s2">"mpv"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-project"</span>
<span class="s2">"mpx"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-project"</span>
<span class="s2">"mrc"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/marc"</span>
<span class="s2">"ms"</span>        <span class="o">-&gt;</span>      <span class="s2">"application/x-troff-ms"</span>
<span class="s2">"msi"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/octet-stream"</span>
<span class="s2">"msm"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/octet-stream"</span>
<span class="s2">"msp"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/octet-stream"</span>
<span class="s2">"mv"</span>        <span class="o">-&gt;</span>      <span class="s2">"video/x-sgi-movie"</span>
<span class="s2">"my"</span>        <span class="o">-&gt;</span>      <span class="s2">"audio/make"</span>
<span class="s2">"mzz"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-vnd.audioexplosion.mzz"</span>
<span class="s2">"nap"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/naplps"</span>
<span class="s2">"naplps"</span>    <span class="o">-&gt;</span>      <span class="s2">"image/naplps"</span>
<span class="s2">"nc"</span>        <span class="o">-&gt;</span>      <span class="s2">"application/x-netcdf"</span>
<span class="s2">"ncm"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.nokia.configuration-message"</span>
<span class="s2">"nif"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/x-niff"</span>
<span class="s2">"niff"</span>      <span class="o">-&gt;</span>      <span class="s2">"image/x-niff"</span>
<span class="s2">"nix"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-mix-transfer"</span>
<span class="s2">"nsc"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-conference"</span>
<span class="s2">"nvd"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-navidoc"</span>
<span class="s2">"o"</span>         <span class="o">-&gt;</span>      <span class=
"s2">"application/octet-stream"</span>
<span class="s2">"oda"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/oda"</span>
<span class="s2">"odg"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.oasis.opendocument.graphics"</span>
<span class="s2">"odp"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.oasis.opendocument.presentation"</span>
<span class="s2">"ods"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.oasis.opendocument.spreadsheet"</span>
<span class="s2">"odt"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.oasis.opendocument.text"</span>
<span class="s2">"ogg"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/ogg"</span>
<span class="s2">"omc"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-omc"</span>
<span class="s2">"omcd"</span>      <span class="o">-&gt;</span>      <span class=
"s2">"application/x-omcdatamaker"</span>
<span class="s2">"omcr"</span>      <span class="o">-&gt;</span>      <span class=
"s2">"application/x-omcregerator"</span>
<span class="s2">"p"</span>         <span class="o">-&gt;</span>      <span class="s2">"text/x-pascal"</span>
<span class="s2">"p10"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-pkcs10"</span>
<span class="s2">"p12"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-pkcs12"</span>
<span class="s2">"p7c"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-pkcs7-mime"</span>
<span class="s2">"p7m"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-pkcs7-mime"</span>
<span class="s2">"p7r"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-pkcs7-certreqresp"</span>
<span class="s2">"p7s"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/pkcs7-signature"</span>
<span class="s2">"part"</span>      <span class="o">-&gt;</span>      <span class="s2">"application/pro_eng"</span>
<span class="s2">"pas"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/pascal"</span>
<span class="s2">"pbm"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/x-portable-bitmap"</span>
<span class="s2">"pcl"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-pcl"</span>
<span class="s2">"pct"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/x-pict"</span>
<span class="s2">"pcx"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/x-pcx"</span>
<span class="s2">"pdb"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-pilot"</span>
<span class="s2">"pdf"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/pdf"</span>
<span class="s2">"pem"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-x509-ca-cert"</span>
<span class="s2">"pfunk"</span>     <span class="o">-&gt;</span>      <span class="s2">"audio/make"</span>
<span class="s2">"pgm"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"image/x-portable-graymap"</span>
<span class="s2">"pic"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/pict"</span>
<span class="s2">"pict"</span>      <span class="o">-&gt;</span>      <span class="s2">"image/pict"</span>
<span class="s2">"pkg"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-newton-compatible-pkg"</span>
<span class="s2">"pko"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.ms-pki.pko"</span>
<span class="s2">"pl"</span>        <span class="o">-&gt;</span>      <span class="s2">"application/x-perl"</span>
<span class="s2">"plx"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-pixclscript"</span>
<span class="s2">"pm"</span>        <span class="o">-&gt;</span>      <span class="s2">"application/x-perl"</span>
<span class="s2">"pm4"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-pagemaker"</span>
<span class="s2">"pm5"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-pagemaker"</span>
<span class="s2">"png"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/png"</span>
<span class="s2">"pnm"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/x-portable-anymap"</span>
<span class="s2">"pot"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/mspowerpoint"</span>
<span class="s2">"pov"</span>       <span class="o">-&gt;</span>      <span class="s2">"model/x-pov"</span>
<span class="s2">"ppa"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.ms-powerpoint"</span>
<span class="s2">"ppm"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/x-portable-pixmap"</span>
<span class="s2">"pps"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/mspowerpoint"</span>
<span class="s2">"ppt"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.ms-powerpoint"</span>
<span class="s2">"pptx"</span>      <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.openxmlformats-officedocument.presentationml.presentation"</span>
<span class="s2">"ppz"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/mspowerpoint"</span>
<span class="s2">"prc"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-pilot"</span>
<span class="s2">"pre"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-freelance"</span>
<span class="s2">"prt"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/pro_eng"</span>
<span class="s2">"ps"</span>        <span class="o">-&gt;</span>      <span class="s2">"application/postscript"</span>
<span class="s2">"psd"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/octet-stream"</span>
<span class="s2">"pvu"</span>       <span class="o">-&gt;</span>      <span class="s2">"paleovu/x-pv"</span>
<span class="s2">"pwz"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.ms-powerpoint"</span>
<span class="s2">"py"</span>        <span class="o">-&gt;</span>      <span class="s2">"text/x-script.phyton"</span>
<span class="s2">"pyc"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-bytecode.python"</span>
<span class="s2">"qcp"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/vnd.qcelp"</span>
<span class="s2">"qd3"</span>       <span class="o">-&gt;</span>      <span class="s2">"x-world/x-3dmf"</span>
<span class="s2">"qd3d"</span>      <span class="o">-&gt;</span>      <span class="s2">"x-world/x-3dmf"</span>
<span class="s2">"qif"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/x-quicktime"</span>
<span class="s2">"qt"</span>        <span class="o">-&gt;</span>      <span class="s2">"video/quicktime"</span>
<span class="s2">"qtc"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/x-qtc"</span>
<span class="s2">"qti"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/x-quicktime"</span>
<span class="s2">"qtif"</span>      <span class="o">-&gt;</span>      <span class="s2">"image/x-quicktime"</span>
<span class="s2">"ra"</span>        <span class="o">-&gt;</span>      <span class="s2">"audio/x-realaudio"</span>
<span class="s2">"ram"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/x-pn-realaudio"</span>
<span class="s2">"rar"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-rar-compressed"</span>
<span class="s2">"ras"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/x-cmu-raster"</span>
<span class="s2">"rast"</span>      <span class="o">-&gt;</span>      <span class="s2">"image/cmu-raster"</span>
<span class="s2">"rexx"</span>      <span class="o">-&gt;</span>      <span class="s2">"text/x-script.rexx"</span>
<span class="s2">"rf"</span>        <span class="o">-&gt;</span>      <span class="s2">"image/vnd.rn-realflash"</span>
<span class="s2">"rgb"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/x-rgb"</span>
<span class="s2">"rm"</span>        <span class="o">-&gt;</span>      <span class="s2">"audio/x-pn-realaudio"</span>
<span class="s2">"rmi"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/mid"</span>
<span class="s2">"rmm"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/x-pn-realaudio"</span>
<span class="s2">"rmp"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/x-pn-realaudio"</span>
<span class="s2">"rng"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/ringing-tones"</span>
<span class="s2">"rnx"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.rn-realplayer"</span>
<span class="s2">"roff"</span>      <span class="o">-&gt;</span>      <span class="s2">"application/x-troff"</span>
<span class="s2">"rp"</span>        <span class="o">-&gt;</span>      <span class="s2">"image/vnd.rn-realpix"</span>
<span class="s2">"rpm"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-redhat-package-manager"</span>
<span class="s2">"rss"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/rss+xml"</span>
<span class="s2">"rt"</span>        <span class="o">-&gt;</span>      <span class="s2">"text/richtext"</span>
<span class="s2">"rtf"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/rtf"</span>
<span class="s2">"rtx"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/richtext"</span>
<span class="s2">"run"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-makeself"</span>
<span class="s2">"rv"</span>        <span class="o">-&gt;</span>      <span class="s2">"video/vnd.rn-realvideo"</span>
<span class="s2">"s"</span>         <span class="o">-&gt;</span>      <span class="s2">"text/x-asm"</span>
<span class="s2">"s3m"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/s3m"</span>
<span class="s2">"saveme"</span>    <span class="o">-&gt;</span>      <span class=
"s2">"application/octet-stream"</span>
<span class="s2">"sbk"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-tbook"</span>
<span class="s2">"scm"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/x-script.scheme"</span>
<span class="s2">"sdml"</span>      <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"sdp"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-sdp"</span>
<span class="s2">"sdr"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/sounder"</span>
<span class="s2">"sea"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-sea"</span>
<span class="s2">"set"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/set"</span>
<span class="s2">"sgm"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/sgml"</span>
<span class="s2">"sgml"</span>      <span class="o">-&gt;</span>      <span class="s2">"text/sgml"</span>
<span class="s2">"sh"</span>        <span class="o">-&gt;</span>      <span class="s2">"text/x-script.sh"</span>
<span class="s2">"shar"</span>      <span class="o">-&gt;</span>      <span class="s2">"application/x-shar"</span>
<span class="s2">"shtml"</span>     <span class="o">-&gt;</span>      <span class="s2">"text/html"</span>
<span class="s2">"sid"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/x-psid"</span>
<span class="s2">"sit"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-stuffit"</span>
<span class="s2">"skd"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-koan"</span>
<span class="s2">"skm"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-koan"</span>
<span class="s2">"skp"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-koan"</span>
<span class="s2">"skt"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-koan"</span>
<span class="s2">"sl"</span>        <span class="o">-&gt;</span>      <span class="s2">"application/x-seelogo"</span>
<span class="s2">"smi"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/smil"</span>
<span class="s2">"smil"</span>      <span class="o">-&gt;</span>      <span class="s2">"application/smil"</span>
<span class="s2">"snd"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/basic"</span>
<span class="s2">"sol"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/solids"</span>
<span class="s2">"spc"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/x-speech"</span>
<span class="s2">"spl"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/futuresplash"</span>
<span class="s2">"spr"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-sprite"</span>
<span class="s2">"sprite"</span>    <span class="o">-&gt;</span>      <span class="s2">"application/x-sprite"</span>
<span class="s2">"src"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-wais-source"</span>
<span class="s2">"ssi"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"text/x-server-parsed-html"</span>
<span class="s2">"ssm"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/streamingmedia"</span>
<span class="s2">"sst"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.ms-pki.certstore"</span>
<span class="s2">"step"</span>      <span class="o">-&gt;</span>      <span class="s2">"application/step"</span>
<span class="s2">"stl"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/sla"</span>
<span class="s2">"stp"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/step"</span>
<span class="s2">"sv4cpio"</span>   <span class="o">-&gt;</span>      <span class="s2">"application/x-sv4cpio"</span>
<span class="s2">"sv4crc"</span>    <span class="o">-&gt;</span>      <span class="s2">"application/x-sv4crc"</span>
<span class="s2">"svf"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/x-dwg"</span>
<span class="s2">"svg"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/svg+xml"</span>
<span class="s2">"svgz"</span>      <span class="o">-&gt;</span>      <span class="s2">"image/svg+xml"</span>
<span class="s2">"svr"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-world"</span>
<span class="s2">"swf"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/x-shockwave-flash"</span>
<span class="s2">"t"</span>         <span class="o">-&gt;</span>      <span class="s2">"application/x-troff"</span>
<span class="s2">"talk"</span>      <span class="o">-&gt;</span>      <span class="s2">"text/x-speech"</span>
<span class="s2">"tar"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-tar"</span>
<span class="s2">"tbk"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-tbook"</span>
<span class="s2">"tcl"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-tcl"</span>
<span class="s2">"tcsh"</span>      <span class="o">-&gt;</span>      <span class="s2">"text/x-script.tcsh"</span>
<span class="s2">"tex"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-tex"</span>
<span class="s2">"texi"</span>      <span class="o">-&gt;</span>      <span class="s2">"application/x-texinfo"</span>
<span class="s2">"texinfo"</span>   <span class="o">-&gt;</span>      <span class="s2">"application/x-texinfo"</span>
<span class="s2">"text"</span>      <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"tgz"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/gnutar"</span>
<span class="s2">"tif"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/tiff"</span>
<span class="s2">"tiff"</span>      <span class="o">-&gt;</span>      <span class="s2">"image/tiff"</span>
<span class="s2">"tk"</span>        <span class="o">-&gt;</span>      <span class="s2">"application/x-tcl"</span>
<span class="s2">"tr"</span>        <span class="o">-&gt;</span>      <span class="s2">"application/x-troff"</span>
<span class="s2">"ts"</span>        <span class="o">-&gt;</span>      <span class="s2">"video/mp2t"</span>
<span class="s2">"tsi"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/tsp-audio"</span>
<span class="s2">"tsp"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/tsplayer"</span>
<span class="s2">"tsv"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"text/tab-separated-values"</span>
<span class="s2">"turbot"</span>    <span class="o">-&gt;</span>      <span class="s2">"image/florian"</span>
<span class="s2">"txt"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/plain"</span>
<span class="s2">"uni"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/uri-list"</span>
<span class="s2">"unis"</span>      <span class="o">-&gt;</span>      <span class="s2">"text/uri-list"</span>
<span class="s2">"unv"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/i-deas"</span>
<span class="s2">"uri"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/uri-list"</span>
<span class="s2">"uris"</span>      <span class="o">-&gt;</span>      <span class="s2">"text/uri-list"</span>
<span class="s2">"ustar"</span>     <span class="o">-&gt;</span>      <span class="s2">"application/x-ustar"</span>
<span class="s2">"uu"</span>        <span class="o">-&gt;</span>      <span class="s2">"text/x-uuencode"</span>
<span class="s2">"uue"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/x-uuencode"</span>
<span class="s2">"vcd"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-cdlink"</span>
<span class="s2">"vcs"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/x-vcalendar"</span>
<span class="s2">"vda"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/vda"</span>
<span class="s2">"vdo"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/vdo"</span>
<span class="s2">"vew"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/groupwise"</span>
<span class="s2">"viv"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/vivo"</span>
<span class="s2">"vivo"</span>      <span class="o">-&gt;</span>      <span class="s2">"video/vivo"</span>
<span class="s2">"vmd"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/vocaltec-media-desc"</span>
<span class="s2">"vmf"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/vocaltec-media-file"</span>
<span class="s2">"voc"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/voc"</span>
<span class="s2">"vos"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/vosaic"</span>
<span class="s2">"vox"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/voxware"</span>
<span class="s2">"vqe"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/x-twinvq-plugin"</span>
<span class="s2">"vqf"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/x-twinvq"</span>
<span class="s2">"vql"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/x-twinvq-plugin"</span>
<span class="s2">"vrml"</span>      <span class="o">-&gt;</span>      <span class="s2">"application/x-vrml"</span>
<span class="s2">"vrt"</span>       <span class="o">-&gt;</span>      <span class="s2">"x-world/x-vrt"</span>
<span class="s2">"vsd"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-visio"</span>
<span class="s2">"vst"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-visio"</span>
<span class="s2">"vsw"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-visio"</span>
<span class="s2">"w60"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/wordperfect6.0"</span>
<span class="s2">"w61"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/wordperfect6.1"</span>
<span class="s2">"w6w"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/msword"</span>
<span class="s2">"war"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/java-archive"</span>
<span class="s2">"wav"</span>       <span class="o">-&gt;</span>      <span class="s2">"audio/wav"</span>
<span class="s2">"wb1"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-qpro"</span>
<span class="s2">"wbmp"</span>      <span class="o">-&gt;</span>      <span class="s2">"image/vnd.wap.wbmp"</span>
<span class="s2">"web"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/vnd.xara"</span>
<span class="s2">"webm"</span>      <span class="o">-&gt;</span>      <span class="s2">"video/webm"</span>
<span class="s2">"webp"</span>      <span class="o">-&gt;</span>      <span class="s2">"image/webp"</span>
<span class="s2">"wiz"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/msword"</span>
<span class="s2">"wk1"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-123"</span>
<span class="s2">"wmf"</span>       <span class="o">-&gt;</span>      <span class="s2">"windows/metafile"</span>
<span class="s2">"wml"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/vnd.wap.wml"</span>
<span class="s2">"wmlc"</span>      <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.wap.wmlc"</span>
<span class="s2">"wmls"</span>      <span class="o">-&gt;</span>      <span class="s2">"text/vnd.wap.wmlscript"</span>
<span class="s2">"wmlsc"</span>     <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.wap.wmlscriptc"</span>
<span class="s2">"wmv"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/x-ms-wmv"</span>
<span class="s2">"woff"</span>      <span class="o">-&gt;</span>      <span class="s2">"font/woff"</span>
<span class="s2">"woff2"</span>     <span class="o">-&gt;</span>      <span class="s2">"font/woff2"</span>
<span class="s2">"word"</span>      <span class="o">-&gt;</span>      <span class="s2">"application/msword"</span>
<span class="s2">"wp"</span>        <span class="o">-&gt;</span>      <span class="s2">"application/wordperfect"</span>
<span class="s2">"wp5"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/wordperfect"</span>
<span class="s2">"wp6"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/wordperfect"</span>
<span class="s2">"wpd"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/wordperfect"</span>
<span class="s2">"wq1"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-lotus"</span>
<span class="s2">"wri"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-wri"</span>
<span class="s2">"wrl"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-world"</span>
<span class="s2">"wrz"</span>       <span class="o">-&gt;</span>      <span class="s2">"model/vrml"</span>
<span class="s2">"wsc"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/scriplet"</span>
<span class="s2">"wsrc"</span>      <span class="o">-&gt;</span>      <span class=
"s2">"application/x-wais-source"</span>
<span class="s2">"wtk"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-wintalk"</span>
<span class="s2">"x-png"</span>     <span class="o">-&gt;</span>      <span class="s2">"image/png"</span>
<span class="s2">"xbm"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/x-xbitmap"</span>
<span class="s2">"xdr"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/x-amt-demorun"</span>
<span class="s2">"xgz"</span>       <span class="o">-&gt;</span>      <span class="s2">"xgl/drawing"</span>
<span class="s2">"xhtml"</span>     <span class="o">-&gt;</span>      <span class="s2">"application/xhtml+xml"</span>
<span class="s2">"xif"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/vnd.xiff"</span>
<span class="s2">"xl"</span>        <span class="o">-&gt;</span>      <span class="s2">"application/excel"</span>
<span class="s2">"xla"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/excel"</span>
<span class="s2">"xlb"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/excel"</span>
<span class="s2">"xlc"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/excel"</span>
<span class="s2">"xld"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/excel"</span>
<span class="s2">"xlk"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/excel"</span>
<span class="s2">"xll"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/excel"</span>
<span class="s2">"xlm"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/excel"</span>
<span class="s2">"xls"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.ms-excel"</span>
<span class="s2">"xlsx"</span>      <span class="o">-&gt;</span>      <span class=
"s2">"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"</span>
<span class="s2">"xlt"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/excel"</span>
<span class="s2">"xlv"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/excel"</span>
<span class="s2">"xlw"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/excel"</span>
<span class="s2">"xm"</span>        <span class="o">-&gt;</span>      <span class="s2">"audio/xm"</span>
<span class="s2">"xml"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/xml"</span>
<span class="s2">"xmz"</span>       <span class="o">-&gt;</span>      <span class="s2">"xgl/movie"</span>
<span class="s2">"xpi"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/x-xpinstall"</span>
<span class="s2">"xpix"</span>      <span class="o">-&gt;</span>      <span class=
"s2">"application/x-vnd.ls-xpix"</span>
<span class="s2">"xpm"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/xpm"</span>
<span class="s2">"xspf"</span>      <span class="o">-&gt;</span>      <span class="s2">"application/xspf+xml"</span>
<span class="s2">"xsr"</span>       <span class="o">-&gt;</span>      <span class="s2">"video/x-amt-showrun"</span>
<span class="s2">"xwd"</span>       <span class="o">-&gt;</span>      <span class="s2">"image/x-xwd"</span>
<span class="s2">"xyz"</span>       <span class="o">-&gt;</span>      <span class="s2">"chemical/x-pdb"</span>
<span class="s2">"z"</span>         <span class="o">-&gt;</span>      <span class=
"s2">"application/x-compressed"</span>
<span class="s2">"zip"</span>       <span class="o">-&gt;</span>      <span class="s2">"application/zip"</span>
<span class="s2">"zoo"</span>       <span class="o">-&gt;</span>      <span class=
"s2">"application/octet-stream"</span>
<span class="s2">"zsh"</span>       <span class="o">-&gt;</span>      <span class="s2">"text/x-script.zsh"</span>
</pre>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <footer>
              <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
                <a href="rampart-html.html" class="btn btn-neutral float-right" title="The rampart-html module"
                accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a> <a href="sql-utils.html" class=
                "btn btn-neutral" title="The rampart-sql Command Line Utilities" accesskey="p"><span class=
                "fa fa-arrow-circle-left"></span> Previous</a>
              </div>
              <hr>
              <div role="contentinfo">
                <p>
                  © Copyright 2022, Moat Crossing Systems.
                </p>
              </div>Built with <a href="http://sphinx-doc.org/">Sphinx</a> and ❤️ using a custom <a href=
              "https://github.com/LinxiFan/Sphinx-theme">theme</a> based on <a href="https://readthedocs.org">Read the
              Docs</a>.
            </footer>
          </div>
        </div>
      </section>
    </div>
    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script> 
    <script type="text/javascript" src="_static/jquery.js"></script> 
    <script type="text/javascript" src="_static/underscore.js"></script> 
    <script type="text/javascript" src="_static/doctools.js"></script> 
    <script type="text/javascript" src="_static/language_data.js"></script> 
    <script type="text/javascript" src=
    "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script> 
    <script type="text/javascript" src="_static/js/theme.js"></script> 
    <script type="text/javascript">

      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
    </script>
    <script src=
    "https://cdnjs.cloudflare.com/ajax/libs/jquery.devbridge-autocomplete/1.4.11/jquery.autocomplete.min.js"></script>
    <script id="rampart-search" src="_static/client_search.js"></script>
  </body>
</html>
